<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>avg on Noboru Saito's page</title><link>https://noborus.github.io/tags/avg/</link><description>Recent content in avg on Noboru Saito's page</description><generator>Hugo -- gohugo.io</generator><language>ja</language><lastBuildDate>Fri, 06 Dec 2019 00:00:00 +0000</lastBuildDate><atom:link href="https://noborus.github.io/tags/avg/index.xml" rel="self" type="application/rss+xml"/><item><title>trdsql 集計計算</title><link>https://noborus.github.io/blog/06_calculation/</link><pubDate>Fri, 06 Dec 2019 00:00:00 +0000</pubDate><guid>https://noborus.github.io/blog/06_calculation/</guid><description>集計計算 集計には、COUNT()だけでなく集計計算することも当然できます。SQLには数値に対して計算をおこなう集計関数があらかじめ揃っています。
ここでは以下のようなCSVファイルを例に説明します。
name,price apple,100 orange,50 melon,500 apple,90 apple,90 orange,40 orange,40 SUM 合計を計算します。price列をすべて足します。
trdsql -ih &amp;quot;SELECT SUM(price) FROM sample.csv&amp;quot; 910 前にも書いたようにtrdsqlは列をテキスト型として扱いますので、本来はCASTして数値型にしてから計算する必要があります。ただ、集計の関数を使用する場合は、暗黙のCASTがされて省略できる場合があります（使用するデータベースによります）。
明示的にCASTする場合は以下のようにします。
trdsql -ih &amp;quot;SELECT SUM(CAST(price AS int)) FROM sample.csv&amp;quot; 910 AVG 平均を計算します。合計/件数で計算できますが、関数が用意されているので、使用したほうがわかりやすく書けます。この例では、平均の意味はそれほどないかもしれませんが。
trdsql -ih &amp;quot;SELECT AVG(CAST(price AS int)) FROM sample.csv&amp;quot; 130 MIN,MAX 最小値や最大値を出力します。
trdsql -ih -oh &amp;quot;SELECT MIN(CAST(price AS INT)),MAX(CAST(price AS INT)) FROM sample.csv&amp;quot; MIN(CAST(price AS INT)),MAX(CAST(price AS INT)) 40,500 MINやMAXはテキスト型でも使用できるため、明示的にCASTする必要があります。
（MINやMAXのnameを知りたくなるところですが、SQLだとちょっと複雑になるので後に回します）。
前回書いたように、集計関数は一度に実行できます。
trdsql -ih -oat \ &amp;quot;SELECT COUNT(name) as count, &amp;quot; \ &amp;quot; COUNT(DISTINCT name) as uniq, &amp;quot; \ &amp;quot; MIN(CAST(price AS INT)) AS min, &amp;quot; \ &amp;quot; MAX(CAST(price AS INT)) as max, &amp;quot; \ &amp;quot; SUM(CAST(price AS INT)) as sum, &amp;quot; \ &amp;quot; AVG(CAST(price AS INT)) as avg &amp;quot; \ &amp;quot;FROM sample.</description></item></channel></rss>