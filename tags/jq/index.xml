<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>jq on Noboru Saito's page</title><link>https://noborus.github.io/tags/jq/</link><description>Recent content in jq on Noboru Saito's page</description><generator>Hugo -- gohugo.io</generator><language>ja</language><lastBuildDate>Sat, 18 Dec 2021 15:40:00 +0900</lastBuildDate><atom:link href="https://noborus.github.io/tags/jq/index.xml" rel="self" type="application/rss+xml"/><item><title>trdsql+PostgreSQL 14でJSONを処理する</title><link>https://noborus.github.io/blog/trdsql_jq/</link><pubDate>Sat, 18 Dec 2021 15:40:00 +0900</pubDate><guid>https://noborus.github.io/blog/trdsql_jq/</guid><description>trdsql はCSVやLTSVと共にJSONに対してもSQLを実行できるツールですが、SQLを使用するため得意な対象はフラットなJSONです。 ただし、v0.9.0からjqの構文が使え、SQL内でもSQLの関数が使えるため、内容によっては簡単に書くことができる場合があります。
デフォルトのsqlite3にもJSON関数がありますが、ここではよりJSON関数が充実しているPostgreSQL 14を使用します。
基本的な使用法 SQLを実行する対象として複数の列のリストの形になっているものが対象です。 以下のように{``}で囲まれた複数の名前: 値が,で並べられたJSONが基本的な形です。 改行で区切られた（実際には）複数のJSONが並べられたLDJSONやJSONLと呼ばれるものは一番SQLで実行しやすい形です。
{ &amp;quot;name&amp;quot;: &amp;quot;Tanaka&amp;quot;, &amp;quot;age&amp;quot;: 26 } { &amp;quot;name&amp;quot;: &amp;quot;Suzuki&amp;quot;, &amp;quot;age&amp;quot;: 32 } 一つのJSONの場合は上記を配列化します。
[ { &amp;quot;age&amp;quot;: &amp;quot;26&amp;quot;, &amp;quot;name&amp;quot;: &amp;quot;Tanaka&amp;quot; }, { &amp;quot;age&amp;quot;: &amp;quot;32&amp;quot;, &amp;quot;name&amp;quot;: &amp;quot;Suzuki&amp;quot; } ] どちらもそのままSELECT name, age FROM example0.jsonのようにtrdsqlのSQLとして実行できます。
JSONはオブジェクトや配列で入れ子に出来るため、ルートが対象とならない場合があります。以下の場合は、そのまま実行すると menu 列が一つに中身がすべて入っていることになります。
{ &amp;quot;menu&amp;quot;: { &amp;quot;id&amp;quot;: &amp;quot;file&amp;quot;, &amp;quot;value&amp;quot;: &amp;quot;File&amp;quot;, &amp;quot;popup&amp;quot;: { &amp;quot;menuitem&amp;quot;: [ { &amp;quot;value&amp;quot;: &amp;quot;New&amp;quot;, &amp;quot;onclick&amp;quot;: &amp;quot;CreateDoc()&amp;quot; }, { &amp;quot;value&amp;quot;: &amp;quot;Open&amp;quot;, &amp;quot;onclick&amp;quot;: &amp;quot;OpenDoc()&amp;quot; }, { &amp;quot;value&amp;quot;: &amp;quot;Save&amp;quot;, &amp;quot;onclick&amp;quot;: &amp;quot;SaveDoc()&amp;quot; } ] } } } SQLのJSON関数を使用することで内部のオブジェクトにアクセスできますが、ほとんどがJSON関数の記述になってしまうのでSQLで実行するメリットが感じられません。</description></item></channel></rss>