<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>CREATE PROCEDURE</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="sql-createpolicy.html" title="CREATE POLICY" /><link rel="next" href="sql-createpublication.html" title="CREATE PUBLICATION" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="4" align="center"><a accesskey="h" href="index.html">PostgreSQL 11.4文書</a></th></tr><tr><td width="10%" align="left"></td><td width="10%" align="left"></td><td width="60%" align="center"><a href="sql-commands.html" title="SQLコマンド">SQLコマンド</a></td><td width="20%" align="right"></td></tr><tr><td width="10%" align="left"><a accesskey="p" href="sql-createpolicy.html" title="CREATE POLICY">前へ</a> </td><td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="SQLコマンド">上へ</a></td><td width="60%" align="center">CREATE PROCEDURE</td><td width="20%" align="right"> <a accesskey="n" href="sql-createpublication.html" title="CREATE PUBLICATION">次へ</a></td></tr></table><hr /></div><div class="refentry" id="SQL-CREATEPROCEDURE"><div class="titlepage"></div><a id="id-1.9.3.76.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">CREATE PROCEDURE</span></h2><p>CREATE PROCEDURE<!--
  <refpurpose>define a new procedure</refpurpose>
--> — 新しいプロシージャを定義する</p></div><div class="refsynopsisdiv"><h2>概要</h2><pre class="synopsis">
CREATE [ OR REPLACE ] PROCEDURE
    <em class="replaceable"><code>name</code></em> ( [ [ <em class="replaceable"><code>argmode</code></em> ] [ <em class="replaceable"><code>argname</code></em> ] <em class="replaceable"><code>argtype</code></em> [ { DEFAULT | = } <em class="replaceable"><code>default_expr</code></em> ] [, ...] ] )
  { LANGUAGE <em class="replaceable"><code>lang_name</code></em>
    | TRANSFORM { FOR TYPE <em class="replaceable"><code>type_name</code></em> } [, ... ]
    | [ EXTERNAL ] SECURITY INVOKER | [ EXTERNAL ] SECURITY DEFINER
    | SET <em class="replaceable"><code>configuration_parameter</code></em> { TO <em class="replaceable"><code>value</code></em> | = <em class="replaceable"><code>value</code></em> | FROM CURRENT }
    | AS '<em class="replaceable"><code>definition</code></em>'
    | AS '<em class="replaceable"><code>obj_file</code></em>', '<em class="replaceable"><code>link_symbol</code></em>'
  } ...
</pre></div><div class="refsect1" id="SQL-CREATEPROCEDURE-DESCRIPTION"><h2>説明</h2><!--
  <title>Description</title>
--><p>
<!--
   <command>CREATE PROCEDURE</command> defines a new procedure.
   <command>CREATE OR REPLACE PROCEDURE</command> will either create a
   new procedure, or replace an existing definition.
   To be able to define a procedure, the user must have the
   <literal>USAGE</literal> privilege on the language.
-->
<code class="command">CREATE PROCEDURE</code>は新たなプロシージャを定義します。
<code class="command">CREATE OR REPLACE PROCEDURE</code>は新たなプロシージャを作るか、既存の定義を置きかえます。
プロシージャを定義するにはユーザは言語に<code class="literal">USAGE</code>権限が必要です。
  </p><p>
<!--
   If a schema name is included, then the procedure is created in the
   specified schema.  Otherwise it is created in the current schema.
   The name of the new procedure must not match any existing procedure or function
   with the same input argument types in the same schema.  However,
   procedures and functions of different argument types can share a name (this is
   called <firstterm>overloading</firstterm>).
-->
スキーマ名が含まれている場合、プロシージャは指定されたスキーマに作られます。
そうでなければ現在のスキーマに作られます。
同スキーマ内で新たなプロシージャ名と入力引数型が既存のプロシージャや関数と一致してはなりません。
しかしながら、プロシージャや関数が異なる引数型であれば同じ名前を共有できます（これは<em class="firstterm">オーバーロード</em>と呼ばれます）。
  </p><p>
<!--
   To replace the current definition of an existing procedure, use
   <command>CREATE OR REPLACE PROCEDURE</command>.  It is not possible
   to change the name or argument types of a procedure this way (if you
   tried, you would actually be creating a new, distinct procedure).
-->
既存プロシージャの現在の定義を置き換えるには、<code class="command">CREATE OR REPLACE PROCEDURE</code>を使用してください。
この方法でプロシージャの名前や引数型を変更することはできません（試みれば、実際は新たな別プロシージャを作ることになるでしょう）。
  </p><p>
<!--
   When <command>CREATE OR REPLACE PROCEDURE</command> is used to replace an
   existing procedure, the ownership and permissions of the procedure
   do not change.  All other procedure properties are assigned the
   values specified or implied in the command.  You must own the procedure
   to replace it (this includes being a member of the owning role).
-->
既存プロシージャの置き換えに<code class="command">CREATE OR REPLACE PROCEDURE</code>が使われたとき、プロシージャの所有者と権限設定は変更されません。
その他全てのプロシージャ属性は、コマンドで指定された値または暗黙の値に設定されます。
プロシージャを置き換えるには所有者（所有するロールのメンバであることも含みます）でなければなりません。
  </p><p>
<!--
   The user that creates the procedure becomes the owner of the procedure.
-->
プロシージャを作ったユーザはプロシージャの所有者になります。
  </p><p>
<!--
   To be able to create a procedure, you must have <literal>USAGE</literal>
   privilege on the argument types.
-->
プロシージャを作るには、引数型に対して<code class="literal">USAGE</code>権限を持っていなければなりません。
  </p></div><div class="refsect1" id="id-1.9.3.76.6"><h2>パラメータ</h2><!--
  <title>Parameters</title>
--><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>name</code></em></span></dt><dd><p>
<!--
       The name (optionally schema-qualified) of the procedure to create.
-->
作成するプロシージャ名（スキーマ修飾も可）。
      </p></dd><dt><span class="term"><em class="replaceable"><code>argmode</code></em></span></dt><dd><p>
<!--
       The mode of an argument: <literal>IN</literal>,
       <literal>INOUT</literal>, or <literal>VARIADIC</literal>.  If omitted,
       the default is <literal>IN</literal>.  (<literal>OUT</literal>
       arguments are currently not supported for procedures.  Use
       <literal>INOUT</literal> instead.)
-->
引数モードで、<code class="literal">IN</code>、<code class="literal">INOUT</code>、あるいは、<code class="literal">VARIADIC</code>のいずれかです。
省略した場合のデフォルトは<code class="literal">IN</code>です。
（<code class="literal">OUT</code>引数は今のところプロシージャに対してサポートされません。<code class="literal">INOUT</code>を代わりに使ってください。）
      </p></dd><dt><span class="term"><em class="replaceable"><code>argname</code></em></span></dt><dd><p>
<!--
       The name of an argument.
-->
引数名。
      </p></dd><dt><span class="term"><em class="replaceable"><code>argtype</code></em></span></dt><dd><p>
<!--
       The data type(s) of the procedure's arguments (optionally
       schema-qualified), if any. The argument types can be base, composite,
       or domain types, or can reference the type of a table column.
-->
プロシージャ引数があるなら、そのデータ型（スキーマ修飾も可）です。
引数型には基本型、複合型、ドメイン型、あるいは、テーブル列の型の参照が使えます。
      </p><p>
<!--
       Depending on the implementation language it might also be allowed
       to specify <quote>pseudo-types</quote> such as <type>cstring</type>.
       Pseudo-types indicate that the actual argument type is either
       incompletely specified, or outside the set of ordinary SQL data types.
-->
実装言語によっては、<code class="type">cstring</code>などの<span class="quote">「<span class="quote">擬似データ型</span>」</span>を指定することができます。
擬似データ型は実際の引数型が完全には特定されていないか、通常のSQLデータ型の枠外にあることを示しています。
      </p><p>
<!--
       The type of a column is referenced by writing
-->
列の型は以下のように参照されます。
       <code class="literal"><em class="replaceable"><code>table_name</code></em>.<em class="replaceable"><code>column_name</code></em>%TYPE</code>.
<!--
       Using this feature can sometimes help make a procedure independent of
       changes to the definition of a table.
-->
この機能を使うことは時にプロシージャをテーブル定義の変更から独立させる助けとなります。
      </p></dd><dt><span class="term"><em class="replaceable"><code>default_expr</code></em></span></dt><dd><p>
<!--
       An expression to be used as default value if the parameter is
       not specified.  The expression has to be coercible to the
       argument type of the parameter.
       All input parameters following a
       parameter with a default value must have default values as well.
-->
パラメータが指定されなかった場合のデフォルト値として使用される式です。
この式はパラメータの引数型と変換可能でなければなりません。
デフォルト値を持つパラメータの後ろにあるパラメータはすべて、同様にデフォルト値を持たなければなりません。
      </p></dd><dt><span class="term"><em class="replaceable"><code>lang_name</code></em></span></dt><dd><p>
<!--
       The name of the language that the procedure is implemented in.
       It can be <literal>sql</literal>, <literal>c</literal>,
       <literal>internal</literal>, or the name of a user-defined
       procedural language, e.g. <literal>plpgsql</literal>.  Enclosing the
       name in single quotes is deprecated and requires matching case.
-->
プロシージャを実装している言語の名前です。
このパラメータには、<code class="literal">sql</code>、<code class="literal">c</code>、<code class="literal">internal</code>、もしくはユーザ定義手続き言語（例：<code class="literal">plpgsql</code>）の名前を指定可能です。
名前を単一引用符で囲むのは廃止予定で、大文字小文字の一致が必要になります。
      </p></dd><dt><span class="term"><code class="literal">TRANSFORM { FOR TYPE <em class="replaceable"><code>type_name</code></em> } [, ... ] }</code></span></dt><dd><p>
<!--
       Lists which transforms a call to the procedure should apply.  Transforms
       convert between SQL types and language-specific data types;
       see <xref linkend="sql-createtransform"/>.  Procedural language
       implementations usually have hardcoded knowledge of the built-in types,
       so those don't need to be listed here.  If a procedural language
       implementation does not know how to handle a type and no transform is
       supplied, it will fall back to a default behavior for converting data
       types, but this depends on the implementation.
-->
プロシージャ呼び出しにどの変換を適用すべきかのリストです。
変換はSQLの型と言語独自のデータ型の間の変換を行います（<a class="xref" href="sql-createtransform.html" title="CREATE TRANSFORM"><span class="refentrytitle">CREATE TRANSFORM</span></a>を参照）。
手続言語の実装では、通常、ビルトインの型についてハードコードされた知識があるので、それらをこのリストに含める必要はありません。
手続言語の実装が型の処理について定めておらず、変換が提供されない場合は、データ型変換のデフォルトの動作によることになりますが、これは実装に依存します。
      </p></dd><dt><span class="term"><code class="literal">[<span class="optional">EXTERNAL</span>] SECURITY INVOKER</code><br /></span><span class="term"><code class="literal">[<span class="optional">EXTERNAL</span>] SECURITY DEFINER</code></span></dt><dd><p>
<!--
      <literal>SECURITY INVOKER</literal> indicates that the procedure
      is to be executed with the privileges of the user that calls it.
      That is the default.  <literal>SECURITY DEFINER</literal>
      specifies that the procedure is to be executed with the
      privileges of the user that owns it.
-->
<code class="literal">SECURITY INVOKER</code>を指定すると、プロシージャを呼び出したユーザの権限で、そのプロシージャが実行されます。
これがデフォルトです。
<code class="literal">SECURITY DEFINER</code>を指定すると、プロシージャを所有するユーザの権限で、そのプロシージャが実行されます。
     </p><p>
<!--
      The key word <literal>EXTERNAL</literal> is allowed for SQL
      conformance, but it is optional since, unlike in SQL, this feature
      applies to all procedures not only external ones.
-->
<code class="literal">EXTERNAL</code>キーワードは、SQLとの互換性を保つために許されています。
しかし、SQLとは異なり、この機能は外部プロシージャだけではなくすべてのプロシージャに適用されるため、このキーワードは省略可能です。
     </p><p>
<!--
      A <literal>SECURITY DEFINER</literal> procedure cannot execute
      transaction control statements (for example, <command>COMMIT</command>
      and <command>ROLLBACK</command>, depending on the language).
-->
<code class="literal">SECURITY DEFINER</code>プロシージャではトランザクション制御文（言語によりますが例えば<code class="command">COMMIT</code>や<code class="command">ROLLBACK</code>）は実行できません。
     </p></dd><dt><span class="term"><em class="replaceable"><code>configuration_parameter</code></em><br /></span><span class="term"><em class="replaceable"><code>value</code></em></span></dt><dd><p>
<!--
       The <literal>SET</literal> clause causes the specified configuration
       parameter to be set to the specified value when the procedure is
       entered, and then restored to its prior value when the procedure exits.
       <literal>SET FROM CURRENT</literal> saves the value of the parameter that
       is current when <command>CREATE PROCEDURE</command> is executed as the value
       to be applied when the procedure is entered.
-->
<code class="literal">SET</code>句により、プロシージャが始まった時に指定した設定パラメータを指定した値に設定し、プロシージャの終了時にそれを以前の値に戻すことができます。
<code class="literal">SET FROM CURRENT</code>は、<code class="command">CREATE PROCEDURE</code>の実行時点でのパラメータ値を、プロシージャに入る時に適用する値として保管します。
      </p><p>
<!--
       If a <literal>SET</literal> clause is attached to a procedure, then
       the effects of a <command>SET LOCAL</command> command executed inside the
       procedure for the same variable are restricted to the procedure: the
       configuration parameter's prior value is still restored at procedure exit.
       However, an ordinary
       <command>SET</command> command (without <literal>LOCAL</literal>) overrides the
       <literal>SET</literal> clause, much as it would do for a previous <command>SET
       LOCAL</command> command: the effects of such a command will persist after
       procedure exit, unless the current transaction is rolled back.
-->
プロシージャに<code class="literal">SET</code>句が付いている場合、プロシージャ内部で実行される<code class="command">SET LOCAL</code>コマンドの同一変数に対する効果はそのプロシージャに制限されます。
つまり、設定パラメータの前の値はプロシージャが終了する時に元に戻ります。
しかし、通常の（<code class="literal">LOCAL</code>がない）<code class="command">SET</code>コマンドは<code class="literal">SET</code>句を上書きします。
これは過去に行われた<code class="command">SET LOCAL</code>コマンドに対してもほぼ同じです。
つまり、このコマンドの効果は、現在のトランザクションがロールバックされない限り、プロシージャが終了した後も永続化されます。
      </p><p>
<!--
       If a <literal>SET</literal> clause is attached to a procedure, then
       that procedure cannot execute transaction control statements (for
       example, <command>COMMIT</command> and <command>ROLLBACK</command>,
       depending on the language).
-->
プロシージャに<code class="literal">SET</code>句が付いている場合、そのプロシージャではトランザクション制御文（言語によりますが例えば<code class="command">COMMIT</code>と<code class="command">ROLLBACK</code>）を実行できません。
      </p><p>
<!--
       See <xref linkend="sql-set"/> and
       <xref linkend="runtime-config"/>
       for more information about allowed parameter names and values.
-->
使用できるパラメータ名と値についての詳細は<a class="xref" href="sql-set.html" title="SET"><span class="refentrytitle">SET</span></a>と<a class="xref" href="runtime-config.html" title="第19章 サーバの設定">第19章</a>を参照してください。
      </p></dd><dt><span class="term"><em class="replaceable"><code>definition</code></em></span></dt><dd><p>
<!--
       A string constant defining the procedure; the meaning depends on the
       language.  It can be an internal procedure name, the path to an
       object file, an SQL command, or text in a procedural language.
-->
プロシージャを定義する文字列定数です。
このパラメータの意味は言語に依存します。
内部的なプロシージャ名、オブジェクトファイルへのパス、SQLコマンド、あるいは、手続き言語で記述されたテキストを指定できます。
      </p><p>
<!--
       It is often helpful to use dollar quoting (see <xref
       linkend="sql-syntax-dollar-quoting"/>) to write the procedure definition
       string, rather than the normal single quote syntax.  Without dollar
       quoting, any single quotes or backslashes in the procedure definition must
       be escaped by doubling them.
-->
プロシージャを定義する文字列を記述する際に、通常の単一引用符ではなく、ドル引用符（<a class="xref" href="sql-syntax-lexical.html#SQL-SYNTAX-DOLLAR-QUOTING" title="4.1.2.4. ドル記号で引用符付けされた文字列定数">4.1.2.4</a>参照）を使用すると便利なことが多くあります。
ドル引用符を使用しなければ、プロシージャ定義内の単一引用符やバックスラッシュは必ず二重にしてエスケープしなければなりません。
      </p></dd><dt><span class="term"><code class="literal"><em class="replaceable"><code>obj_file</code></em>, <em class="replaceable"><code>link_symbol</code></em></code></span></dt><dd><p>
<!--
       This form of the <literal>AS</literal> clause is used for
       dynamically loadable C language procedures when the procedure name
       in the C language source code is not the same as the name of
       the SQL procedure. The string <replaceable
       class="parameter">obj_file</replaceable> is the name of the shared
       library file containing the compiled C procedure, and is interpreted
       as for the <xref linkend="sql-load"/> command.  The string
       <replaceable class="parameter">link_symbol</replaceable> is the
       procedure's link symbol, that is, the name of the procedure in the C
       language source code.  If the link symbol is omitted, it is assumed
       to be the same as the name of the SQL procedure being defined.
-->
この構文の<code class="literal">AS</code>句は、動的にロードされるC言語プロシージャにおいて、C言語のソースコード中のプロシージャ名がSQLプロシージャの名前と同じでない場合に使われます。
<em class="replaceable"><code>obj_file</code></em>という文字列はコンパイルされたCプロシージャを含む共有ライブラリファイルの名前で、<a class="xref" href="sql-load.html" title="LOAD"><span class="refentrytitle">LOAD</span></a>コマンドの場合と同じように解釈されます。
文字列<em class="replaceable"><code>link_symbol</code></em>はそのプロシージャのリンクシンボル、つまり、C言語ソースコード中のプロシージャの名前です。
リンクシンボルが省略された場合、定義されるSQLプロシージャの名前と同じものであるとみなされます。
      </p><p>
<!--
       When repeated <command>CREATE PROCEDURE</command> calls refer to
       the same object file, the file is only loaded once per session.
       To unload and
       reload the file (perhaps during development), start a new session.
-->
同じオブジェクトファイルを参照する<code class="command">CREATE PROCEDURE</code>呼び出しが繰り返される場合、ファイルがセッションにつき一度だけロードされます。
（おそらく開発中に）ファイルのアンロードと再ロードを行うには、新たなセッションを開始してください。
      </p></dd></dl></div></div><div class="refsect1" id="SQL-CREATEPROCEDURE-NOTES"><h2>注釈</h2><!--
  <title>Notes</title>
--><p>
<!--
   See <xref linkend="sql-createfunction"/> for more details on function
   creation that also apply to procedures.
-->
プロシージャにも該当する関数の作成についての詳細は<a class="xref" href="sql-createfunction.html" title="CREATE FUNCTION"><span class="refentrytitle">CREATE FUNCTION</span></a>を参照してください。
  </p><p>
<!--
   Use <xref linkend="sql-call"/> to execute a procedure.
-->
プロシージャを実行するには<a class="xref" href="sql-call.html" title="CALL"><span class="refentrytitle">CALL</span></a>を使います。
  </p></div><div class="refsect1" id="SQL-CREATEPROCEDURE-EXAMPLES"><h2>例</h2><!--
  <title>Examples</title>
--><pre class="programlisting">
CREATE PROCEDURE insert_data(a integer, b integer)
LANGUAGE SQL
AS $$
INSERT INTO tbl VALUES (a);
INSERT INTO tbl VALUES (b);
$$;

CALL insert_data(1, 2);
</pre></div><div class="refsect1" id="SQL-CREATEPROCEDURE-COMPAT"><h2>互換性</h2><!--
  <title>Compatibility</title>
--><p>
<!--
   A <command>CREATE PROCEDURE</command> command is defined in the SQL
   standard.  The <productname>PostgreSQL</productname> version is similar but
   not fully compatible.  For details see
   also <xref linkend="sql-createfunction"/>.
-->
<code class="command">CREATE PROCEDURE</code>コマンドはSQL標準で定義されています。
<span class="productname">PostgreSQL</span>のものは似ていますが、完全な互換ではありません。
詳しくは<a class="xref" href="sql-createfunction.html" title="CREATE FUNCTION"><span class="refentrytitle">CREATE FUNCTION</span></a>も参照してください。
  </p></div><div class="refsect1" id="id-1.9.3.76.10"><h2>関連項目</h2><!--
  <title>See Also</title>
--><span class="simplelist"><a class="xref" href="sql-alterprocedure.html" title="ALTER PROCEDURE"><span class="refentrytitle">ALTER PROCEDURE</span></a>, <a class="xref" href="sql-dropprocedure.html" title="DROP PROCEDURE"><span class="refentrytitle">DROP PROCEDURE</span></a>, <a class="xref" href="sql-call.html" title="CALL"><span class="refentrytitle">CALL</span></a>, <a class="xref" href="sql-createfunction.html" title="CREATE FUNCTION"><span class="refentrytitle">CREATE FUNCTION</span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-createpolicy.html">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="sql-commands.html">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="sql-createpublication.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">CREATE POLICY </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> CREATE PUBLICATION</td></tr></table></div></body></html>