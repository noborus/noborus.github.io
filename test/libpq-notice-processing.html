<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>34.13. 警告処理</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="libpq-misc.html" title="34.12. 雑多な関数" /><link rel="next" href="libpq-events.html" title="34.14. イベントシステム" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /></head><body id="docContent" class="container-fluid col-10"><div class="other_version"><a href="https://www.postgresql.jp/document/">バージョンごとのドキュメント一覧</a></div><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="4" align="center"><a accesskey="h" href="index.html">PostgreSQL 15.0文書</a></th></tr><tr><td width="10%" align="left"></td><td width="10%" align="left"></td><td width="60%" align="center"><a href="libpq.html" title="第34章 libpq — C ライブラリ">第34章 <span class="application">libpq</span> — C ライブラリ</a></td><td width="20%" align="right"><div class="actions"><a class="issue" title="github" href="https://github.com/pgsql-jp/jpug-doc/issues/new?template=bug_report.yml&amp;what-happened=version 15.0 : libpq-notice-processing.html">誤訳等の報告
                    </a></div></td></tr><tr><td width="10%" align="left"><a accesskey="p" href="libpq-misc.html" title="34.12. 雑多な関数">前へ</a> </td><td width="10%" align="left"><a accesskey="u" href="libpq.html" title="第34章 libpq — C ライブラリ">上へ</a></td><td width="60%" align="center">34.13. 警告処理</td><td width="20%" align="right"> <a accesskey="n" href="libpq-events.html" title="34.14. イベントシステム">次へ</a></td></tr></table><hr /></div><div class="sect1" id="LIBPQ-NOTICE-PROCESSING"><div class="titlepage"><div><div><h2 class="title" style="clear: both">34.13. 警告処理</h2></div></div></div><span class="original">
  &lt;title&gt;Notice Processing&lt;/title&gt;
</span><a id="id-1.7.3.20.2" class="indexterm"></a><a id="id-1.7.3.20.3" class="indexterm"></a><p>
<span class="original">
   Notice and warning messages generated by the server are not returned
   by the query execution functions, since they do not imply failure of
   the query.  Instead they are passed to a notice handling function, and
   execution continues normally after the handler returns.  The default
   notice handling function prints the message on
   &lt;filename&gt;stderr&lt;/filename&gt;, but the application can override this
   behavior by supplying its own handling function.
</span>
問い合わせ実行関数では、サーバにより生成された通知と警告メッセージは、問い合わせの失敗を意味していないので返されません。
その代わり、それらは通知処理関数に渡され、ハンドラから返った後も実行は通常通り継続します。
デフォルトの通知処理関数は<code class="filename">stderr</code>にメッセージを出力しますが、アプリケーションは自身の処理関数を提供することでこの動作を書き換えることができます。
  </p><p>
<span class="original">
   For historical reasons, there are two levels of notice handling, called
   the notice receiver and notice processor.  The default behavior is for
   the notice receiver to format the notice and pass a string to the notice
   processor for printing.  However, an application that chooses to provide
   its own notice receiver will typically ignore the notice processor
   layer and just do all the work in the notice receiver.
</span>
歴史的理由で、通知レシーバと通知プロセッサと呼ばれる２階層の通知処理が存在します。
デフォルトの動作は、通知レシーバが通知を書式化し、出力のため通知プロセッサに文字列を渡します。
しかし、独自の通知レシーバを提供することを選んだアプリケーションでは、通常、通知プロセッサ層を無視し、すべての作業を単に通知レシーバで行います。
  </p><p>
<span class="original">
   The function &lt;function id="libpq-PQsetNoticeReceiver"&gt;PQsetNoticeReceiver&lt;/function&gt;
   &lt;indexterm&gt;&lt;primary&gt;notice receiver&lt;/primary&gt;&lt;/indexterm&gt;
   &lt;indexterm&gt;&lt;primary&gt;PQsetNoticeReceiver&lt;/primary&gt;&lt;/indexterm&gt; sets or
   examines the current notice receiver for a connection object.
   Similarly, &lt;function id="libpq-PQsetNoticeProcessor"&gt;PQsetNoticeProcessor&lt;/function&gt;
   &lt;indexterm&gt;&lt;primary&gt;notice processor&lt;/primary&gt;&lt;/indexterm&gt;
   &lt;indexterm&gt;&lt;primary&gt;PQsetNoticeProcessor&lt;/primary&gt;&lt;/indexterm&gt; sets or
   examines the current notice processor.
</span>
関数<code class="function" id="LIBPQ-PQSETNOTICERECEIVER">PQsetNoticeReceiver</code><a id="id-1.7.3.20.6.2" class="indexterm"></a><a id="id-1.7.3.20.6.3" class="indexterm"></a>は接続オブジェクトに対し現在の通知レシーバを設定もしくは確認します。
同様に、<code class="function" id="LIBPQ-PQSETNOTICEPROCESSOR">PQsetNoticeProcessor</code>は現在の通知プロセッサの設定もしくは確認を行います。
<a id="id-1.7.3.20.6.5" class="indexterm"></a><a id="id-1.7.3.20.6.6" class="indexterm"></a>

</p><pre class="synopsis">
typedef void (*PQnoticeReceiver) (void *arg, const PGresult *res);

PQnoticeReceiver
PQsetNoticeReceiver(PGconn *conn,
                    PQnoticeReceiver proc,
                    void *arg);

typedef void (*PQnoticeProcessor) (void *arg, const char *message);

PQnoticeProcessor
PQsetNoticeProcessor(PGconn *conn,
                     PQnoticeProcessor proc,
                     void *arg);
</pre><p>

<span class="original">
   Each of these functions returns the previous notice receiver or
   processor function pointer, and sets the new value.  If you supply a
   null function pointer, no action is taken, but the current pointer is
   returned.
</span>
各関数は、以前の通知レシーバもしくは通知プロセッサ用の関数へのポインタを返し、新しい値を設定します。
関数ポインタにNULLを渡した場合、何も変更されず、現在のポインタが返されるだけです。
  </p><p>
<span class="original">
   When a notice or warning message is received from the server, or
   generated internally by &lt;application&gt;libpq&lt;/application&gt;, the notice
   receiver function is called.  It is passed the message in the form of
   a &lt;symbol&gt;PGRES_NONFATAL_ERROR&lt;/symbol&gt;
   &lt;structname&gt;PGresult&lt;/structname&gt;.  (This allows the receiver to extract
   individual fields using &lt;xref linkend="libpq-PQresultErrorField"/&gt;, or obtain a
   complete preformatted message using &lt;xref linkend="libpq-PQresultErrorMessage"/&gt;
   or &lt;xref linkend="libpq-PQresultVerboseErrorMessage"/&gt;.)  The same
   void pointer passed to &lt;function&gt;PQsetNoticeReceiver&lt;/function&gt; is also
   passed.  (This pointer can be used to access application-specific state
   if needed.)
</span>
サーバから注意/警告メッセージを受け取ると、あるいは、<span class="application">libpq</span>内部で注意/警告メッセージが生成されると、通知レシーバ関数が呼び出されます。
<code class="symbol">PGRES_NONFATAL_ERROR</code> <code class="structname">PGresult</code>という形でメッセージが渡されます。
（これにより、レシーバは<a class="xref" href="libpq-exec.html#LIBPQ-PQRESULTERRORFIELD"><code class="function">PQresultErrorField</code></a>を使用して個々のフィールドを取り出すことや、<a class="xref" href="libpq-exec.html#LIBPQ-PQRESULTERRORMESSAGE"><code class="function">PQresultErrorMessage</code></a>あるいは<a class="xref" href="libpq-exec.html#LIBPQ-PQRESULTVERBOSEERRORMESSAGE"><code class="function">PQresultVerboseErrorMessage</code></a>を使用して事前に整形された完全なメッセージを取得することができます。）
<code class="function">PQsetNoticeReceiver</code>に渡されたvoidポインタと同じものも渡されます。
（このポインタを使用して、必要に応じてアプリケーション特有の状態にアクセスすることができます。）
  </p><p>
<span class="original">
   The default notice receiver simply extracts the message (using
   &lt;xref linkend="libpq-PQresultErrorMessage"/&gt;) and passes it to the notice
   processor.
</span>
デフォルトの通知レシーバは単に（<a class="xref" href="libpq-exec.html#LIBPQ-PQRESULTERRORMESSAGE"><code class="function">PQresultErrorMessage</code></a>を使用して）メッセージを取り出し、それを通知プロセッサに渡すだけです。
  </p><p>
<span class="original">
   The notice processor is responsible for handling a notice or warning
   message given in text form.  It is passed the string text of the message
   (including a trailing newline), plus a void pointer that is the same
   one passed to &lt;function&gt;PQsetNoticeProcessor&lt;/function&gt;.  (This pointer
   can be used to access application-specific state if needed.)
</span>
通知プロセッサは、テキスト形式で与えられた注意/警告メッセージの取扱いに責任を持ちます。
メッセージは（最後の改行を含む）文字列テキストで渡され、更に、<code class="function">PQsetNoticeProcessor</code>に渡したものと同じvoidポインタも渡されます。
（このポインタを使用して、必要に応じてアプリケーション特有の状態にアクセスすることができます。）
  </p><p>
<span class="original">
   The default notice processor is simply:
</span>
デフォルトの通知プロセッサは以下のような単純なものです。
</p><pre class="programlisting">
static void
defaultNoticeProcessor(void *arg, const char *message)
{
    fprintf(stderr, "%s", message);
}
</pre><p>
  </p><p>
<span class="original">
   Once you have set a notice receiver or processor, you should expect
   that that function could be called as long as either the
   &lt;structname&gt;PGconn&lt;/structname&gt; object or &lt;structname&gt;PGresult&lt;/structname&gt; objects made
   from it exist.  At creation of a &lt;structname&gt;PGresult&lt;/structname&gt;, the
   &lt;structname&gt;PGconn&lt;/structname&gt;'s current notice handling pointers are copied
   into the &lt;structname&gt;PGresult&lt;/structname&gt; for possible use by functions like
   &lt;xref linkend="libpq-PQgetvalue"/&gt;.
</span>
一旦通知レシーバや通知プロセッサを設定したら、<code class="structname">PGconn</code>オブジェクトか、それから生成された<code class="structname">PGresult</code>オブジェクトが存在している間は、その関数が呼び出される可能性があると考えておくべきです。
<code class="structname">PGresult</code>の生成時には、<code class="structname">PGconn</code>の現在の警告処理用のポインタが、<a class="xref" href="libpq-exec.html#LIBPQ-PQGETVALUE"><code class="function">PQgetvalue</code></a>のような関数で使用可能であるように、<code class="structname">PGresult</code>へコピーされます。
  </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="libpq-misc.html" title="34.12. 雑多な関数">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="libpq.html" title="第34章 libpq — C ライブラリ">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="libpq-events.html" title="34.14. イベントシステム">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">34.12. 雑多な関数 </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 15.0文書">ホーム</a></td><td width="40%" align="right" valign="top"> 34.14. イベントシステム</td></tr></table></div></body></html>