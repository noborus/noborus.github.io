<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>F.38. postgres_fdw — access data stored in external PostgreSQL servers</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="pgwalinspect.html" title="F.37. pg_walinspect — low-level WAL inspection" /><link rel="next" href="seg.html" title="F.39. seg — 線分または浮動小数点区間のためのデータ型" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="4" align="center"><a accesskey="h" href="index.html">PostgreSQL 16.0文書</a></th></tr><tr><td width="10%" align="left"></td><td width="10%" align="left"></td><td width="60%" align="center"><a href="contrib.html" title="付録F 追加で提供されるモジュールと拡張">付録F 追加で提供されるモジュールと拡張</a></td><td width="20%" align="right"></td></tr><tr><td width="10%" align="left"><a accesskey="p" href="pgwalinspect.html" title="F.37. pg_walinspect — low-level WAL inspection">前へ</a> </td><td width="10%" align="left"><a accesskey="u" href="contrib.html" title="付録F 追加で提供されるモジュールと拡張">上へ</a></td><td width="60%" align="center">F.38. postgres_fdw —
   access data stored in external <span class="productname">PostgreSQL</span>
   servers</td><td width="20%" align="right"> <a accesskey="n" href="seg.html" title="F.39. seg — 線分または浮動小数点区間のためのデータ型">次へ</a></td></tr></table><hr /></div><div class="sect1" id="POSTGRES-FDW"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.38. postgres_fdw —
   access data stored in external <span class="productname">PostgreSQL</span>
   servers <a href="#POSTGRES-FDW" class="id_link">#</a></h2></div></div></div><a id="id-1.11.7.48.2" class="indexterm"></a><p>
<!--
  The <filename>postgres_fdw</filename> module provides the foreign-data wrapper
  <literal>postgres_fdw</literal>, which can be used to access data
  stored in external <productname>PostgreSQL</productname> servers.
-->
<code class="filename">postgres_fdw</code>モジュールは、外部の<span class="productname">PostgreSQL</span>サーバに格納されたデータをアクセスするために使用する、<code class="literal">postgres_fdw</code>外部データラッパーを提供します。
 </p><p>
<!--
  The functionality provided by this module overlaps substantially
  with the functionality of the older <xref linkend="dblink"/> module.
  But <filename>postgres_fdw</filename> provides more transparent and
  standards-compliant syntax for accessing remote tables, and can give
  better performance in many cases.
-->
実質上、本モジュールの提供する機能は以前の<a class="xref" href="dblink.html" title="F.12. dblink — 他のPostgreSQLデータベースへ接続する">dblink</a>モジュールが提供する機能と重複していますが、<code class="filename">postgres_fdw</code>はリモートのテーブルにアクセスするためにより透過的で標準に準拠した構文を利用できるほか、多くの場合においてより良い性能を得る事ができます。
 </p><p>
<!--
  To prepare for remote access using <filename>postgres_fdw</filename>:
-->
<code class="filename">postgres_fdw</code>を使用したリモートアクセスを準備するには:
  </p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>
<!--
     Install the  <filename>postgres_fdw</filename> extension using <xref
     linkend="sql-createextension"/>.
-->
<a class="xref" href="sql-createextension.html" title="CREATE EXTENSION"><span class="refentrytitle">CREATE EXTENSION</span></a>を使用して<code class="filename">postgres_fdw</code>拡張をインストールします。
    </p></li><li class="listitem"><p>
<!--
     Create a foreign server object, using <xref linkend="sql-createserver"/>,
     to represent each remote database you want to connect to.
     Specify connection information, except <literal>user</literal> and
     <literal>password</literal>, as options of the server object.
-->
<a class="xref" href="sql-createserver.html" title="CREATE SERVER"><span class="refentrytitle">CREATE SERVER</span></a>を使用して、接続しようとする各リモートデータベースを定義する外部サーバオブジェクトを作成します。
<code class="literal">user</code>および<code class="literal">password</code>を除く接続パラメータを、外部サーバオブジェクトのオプションとして指定します。
    </p></li><li class="listitem"><p>
<!--
     Create a user mapping, using <xref linkend="sql-createusermapping"/>, for
     each database user you want to allow to access each foreign server.
     Specify the remote user name and password to use as
     <literal>user</literal> and <literal>password</literal> options of the
     user mapping.
-->
<a class="xref" href="sql-createusermapping.html" title="CREATE USER MAPPING"><span class="refentrytitle">CREATE USER MAPPING</span></a>を使用して、外部サーバへのアクセスを許可するデータベースユーザごとにユーザマッピングを作成します。
ユーザマッピングの<code class="literal">user</code>および<code class="literal">password</code>オプションを使用してリモートユーザのためのユーザ名とパスワードを指定します。
    </p></li><li class="listitem"><p>
<!--
     Create a foreign table, using <xref linkend="sql-createforeigntable"/>
     or <xref linkend="sql-importforeignschema"/>,
     for each remote table you want to access.  The columns of the foreign
     table must match the referenced remote table.  You can, however, use
     table and/or column names different from the remote table's, if you
     specify the correct remote names as options of the foreign table object.
-->
<a class="xref" href="sql-createforeigntable.html" title="CREATE FOREIGN TABLE"><span class="refentrytitle">CREATE FOREIGN TABLE</span></a>もしくは<a class="xref" href="sql-importforeignschema.html" title="IMPORT FOREIGN SCHEMA"><span class="refentrytitle">IMPORT FOREIGN SCHEMA</span></a>を使用して、アクセスしたいリモートテーブルごとに外部テーブルを作成します。
外部テーブルのカラム定義は被参照側のリモートテーブルに一致していなければなりません。
しかしながら、外部テーブルのオプションとして正しいリモートの名前を外部テーブルのオプションに指定すれば、テーブルおよびカラム名はリモートのものと異なった名前を付ける事ができます。
    </p></li></ol></div><p>
 </p><p>
<!--
  Now you need only <command>SELECT</command> from a foreign table to access
  the data stored in its underlying remote table.  You can also modify
  the remote table using <command>INSERT</command>, <command>UPDATE</command>,
  <command>DELETE</command>, <command>COPY</command>, or
  <command>TRUNCATE</command>.
  (Of course, the remote user you have specified in your user mapping must
  have privileges to do these things.)
-->
今のところ、リモートテーブルに格納されているデータにアクセスするには少なくとも外部テーブルに対する<code class="command">SELECT</code>権限が必要です。
また、<code class="command">INSERT</code>や<code class="command">UPDATE</code>、<code class="command">DELETE</code>、<code class="command">COPY</code>、<code class="command">TRUNCATE</code>を使用してリモートテーブルを操作する事もできます。
（もちろん、ユーザマッピングで指定されたリモートユーザは、これらの操作を実行する権限を有している必要があります）
 </p><p>
<!--
  Note that the <literal>ONLY</literal> option specified in
  <command>SELECT</command>, <command>UPDATE</command>,
  <command>DELETE</command> or <command>TRUNCATE</command>
  has no effect when accessing or modifying the remote table.
-->
リモートテーブルをアクセスあるいは変更する際、<code class="command">SELECT</code>、<code class="command">UPDATE</code>、<code class="command">DELETE</code>、<code class="command">TRUNCATE</code>に対して<code class="literal">ONLY</code>オプションを指定しても効果はありません。
 </p><p>
<!--
  Note that <filename>postgres_fdw</filename> currently lacks support for
  <command>INSERT</command> statements with an <literal>ON CONFLICT DO
  UPDATE</literal> clause.  However, the <literal>ON CONFLICT DO NOTHING</literal>
  clause is supported, provided a unique index inference specification
  is omitted.
  Note also that <filename>postgres_fdw</filename> supports row movement
  invoked by <command>UPDATE</command> statements executed on partitioned
  tables, but it currently does not handle the case where a remote partition
  chosen to insert a moved row into is also an <command>UPDATE</command>
  target partition that will be updated elsewhere in the same command.
-->
<code class="filename">postgres_fdw</code>は今のところ、<code class="literal">ON CONFLICT DO UPDATE</code>句のある<code class="command">INSERT</code>文をサポートしていないことに注意して下さい。
しかし、一意インデックスの推定の指定を省略しているならば、<code class="literal">ON CONFLICT DO NOTHING</code>句はサポートされます。
<code class="filename">postgres_fdw</code>は、パーティションテーブルで実行された<code class="command">UPDATE</code>文により引き起こされる行の移動をサポートしますが、移動した行を挿入するよう選択されたリモートパーティションが同じコマンド内で別の場所で更新される<code class="command">UPDATE</code>対象のパーティションでもある場合は、今のところ扱わないことにも注意してください。
 </p><p>
<!--
  It is generally recommended that the columns of a foreign table be declared
  with exactly the same data types, and collations if applicable, as the
  referenced columns of the remote table.  Although <filename>postgres_fdw</filename>
  is currently rather forgiving about performing data type conversions at
  need, surprising semantic anomalies may arise when types or collations do
  not match, due to the remote server interpreting query conditions
  differently from the local server.
-->
一般的な推奨事項として、可能であれば外部テーブルのカラムを、被参照側のリモートテーブル側のカラムと全く同一のデータ型および照合順序によって定義してください。
<code class="filename">postgres_fdw</code>は必要に応じてデータ型の変換を行いますが、リモートサーバがローカルサーバとは異なる問い合わせ条件の解釈を行うため、データ型や照合順序が一致していないと、時には予期しない意味論的に異常な結果を得る事があるかもしれません。
 </p><p>
<!--
  Note that a foreign table can be declared with fewer columns, or with a
  different column order, than its underlying remote table has.  Matching
  of columns to the remote table is by name, not position.
-->
リモートテーブルより少ないカラム数で、あるいは異なった順序であっても外部テーブルを定義できる事に留意してください。
リモートテーブル側のカラムとの対応付けは、その位置ではなく、名前によって行われます。
 </p><div class="sect2" id="POSTGRES-FDW-OPTIONS"><div class="titlepage"><div><div><h3 class="title">F.38.1. postgres_fdwの外部データラッパーオプション <a href="#POSTGRES-FDW-OPTIONS" class="id_link">#</a></h3></div></div></div><!--
  <title>FDW Options of postgres_fdw</title>
--><div class="sect3" id="POSTGRES-FDW-OPTIONS-CONNECTION"><div class="titlepage"><div><div><h4 class="title">F.38.1.1. 接続オプション <a href="#POSTGRES-FDW-OPTIONS-CONNECTION" class="id_link">#</a></h4></div></div></div><!--
   <title>Connection Options</title>
--><p>
<!--
    A foreign server using the <filename>postgres_fdw</filename> foreign data wrapper
    can have the same options that <application>libpq</application> accepts in
    connection strings, as described in <xref linkend="libpq-paramkeywords"/>,
    except that these options are not allowed or have special handling:
-->
<code class="filename">postgres_fdw</code>外部データラッパーを使用する外部サーバは、以下に記す許されていないものや特別な取り扱いのものを除き、<a class="xref" href="libpq-connect.html#LIBPQ-PARAMKEYWORDS" title="34.1.2. パラメータキーワード">34.1.2</a>に記載されている<span class="application">libpq</span>が接続文字列としてサポートするものと同一のオプションを使用する事ができます。

    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
<!--
       <literal>user</literal>, <literal>password</literal> and <literal>sslpassword</literal> (specify these
       in a user mapping, instead, or use a service file)
-->
<code class="literal">user</code>、<code class="literal">password</code>および<code class="literal">sslpassword</code>（これらは代わりにユーザマッピングのオプションの中で指定するか、サービスファイルを使用します）
      </p></li><li class="listitem"><p>
<!--
       <literal>client_encoding</literal> (this is automatically set from the local
       server encoding)
-->
<code class="literal">client_encoding</code>（これはローカルサーバのエンコーディングが自動的にセットされます）
      </p></li><li class="listitem"><p>
<!--
       <literal>application_name</literal> - this may appear in
       <emphasis>either or both</emphasis> a connection and
       <xref linkend="guc-pgfdw-application-name"/>.
       If both are present, <varname>postgres_fdw.application_name</varname>
       overrides the connection setting.
       Unlike <application>libpq</application>,
       <filename>postgres_fdw</filename> allows
       <varname>application_name</varname> to include
       <quote>escape sequences</quote>.
       See <xref linkend="guc-pgfdw-application-name"/> for details.
-->
<code class="literal">application_name</code>-これは接続と<a class="xref" href="postgres-fdw.html#GUC-PGFDW-APPLICATION-NAME">postgres_fdw.application_name</a><span class="emphasis"><em>のいずれかまたは両方</em></span>に現れる可能性があります。
両方が存在する場合、<code class="varname">postgres_fdw.application_name</code>は接続設定を上書きします。
<span class="application">libpq</span>とは異なり、<code class="filename">postgres_fdw</code>は<code class="varname">application_name</code>に<span class="quote">「<span class="quote">エスケープシーケンス</span>」</span>を含めることを許可します。
詳細は<a class="xref" href="postgres-fdw.html#GUC-PGFDW-APPLICATION-NAME">postgres_fdw.application_name</a>を参照してください。
      </p></li><li class="listitem"><p>
<!--
       <literal>fallback_application_name</literal> (always set to
       <literal>postgres_fdw</literal>)
-->
<code class="literal">fallback_application_name</code>（自動的に<code class="literal">postgres_fdw</code>とセットされます）
      </p></li><li class="listitem"><p>
<!--
       <literal>sslkey</literal> and <literal>sslcert</literal> - these may
       appear in <emphasis>either or both</emphasis> a connection and a user
       mapping. If both are present, the user mapping setting overrides the
       connection setting.
-->
<code class="literal">sslkey</code>と<code class="literal">sslcert</code> - これは、接続とユーザマッピングの<span class="emphasis"><em>どちらか一方、または両方</em></span>に現れます。
両方に存在する場合、ユーザマッピングの設定が接続設定に優先します。
      </p></li></ul></div><p>
   </p><p>
<!--
    Only superusers may create or modify user mappings with the
    <literal>sslcert</literal> or <literal>sslkey</literal> settings.
-->
スーパーユーザのみが<code class="literal">sslcert</code>や<code class="literal">sslkey</code>の設定のあるユーザマッピングを作成したり修正したりできます。
   </p><p>
<!--
    Non-superusers may connect to foreign servers using password
    authentication or with GSSAPI delegated credentials, so specify the
    <literal>password</literal> option for user mappings belonging to
    non-superusers where password authentication is required.
-->
《マッチ度[59.920635]》スーパーユーザのみが外部サーバに対してパスワードなしの認証で接続できます。
したがって、非特権ユーザのユーザマッピングには<code class="literal">password</code>を必ず指定するようにして下さい。
《機械翻訳》非スーパーユーザはパスワード認証またはGSSAPI委任資格を使用して外部サーバに接続できるため、パスワード認証が必要な非スーパーユーザに属するユーザマッピングに対して<code class="literal">password</code>オプションを指定します。
   </p><p>
<!--
    A superuser may override this check on a per-user-mapping basis by setting
    the user mapping option <literal>password_required 'false'</literal>, e.g.,
-->
ユーザマッピングオプション<code class="literal">password_required 'false'</code>を設定することで、スーパーユーザはこのユーザマッピング単位の検査を無効にできます。例えば以下の通りです。
</p><pre class="programlisting">
ALTER USER MAPPING FOR some_non_superuser SERVER loopback_nopw
OPTIONS (ADD password_required 'false');
</pre><p>
<!--
    To prevent unprivileged users from exploiting the authentication rights
    of the unix user the postgres server is running as to escalate to superuser
    rights, only the superuser may set this option on a user mapping.
-->
非特権ユーザが、postgresサーバが動作しているunixユーザの認証権限を悪用して、スーパーユーザ権限へ昇格するのを防ぐため、スーパーユーザのみがユーザーマッピングでこのオプションを設定できます。
    </p><p>
<!--
    Care is required to ensure that this does not allow the mapped
    user the ability to connect as superuser to the mapped database per
    CVE-2007-3278 and CVE-2007-6601. Don't set
    <literal>password_required=false</literal>
    on the <literal>public</literal> role. Keep in mind that the mapped
    user can potentially use any client certificates,
    <filename>.pgpass</filename>,
    <filename>.pg_service.conf</filename> etc. in the unix home directory of the
    system user the postgres server runs as. They can also use any trust
    relationship granted by authentication modes like <literal>peer</literal>
    or <literal>ident</literal> authentication.
-->
CVE-2007-3278やCVE-2007-6601により、マップされたユーザがマップされたデータベースにスーパーユーザとして接続するのを許可しないことを確実にするよう注意が必要です。
<code class="literal">public</code>ロールでは<code class="literal">password_required=false</code>を設定しないでください。
postgresサーバが動作しているシステムユーザのunixのホームディレクトリにある、任意のクライアント証明書や<code class="filename">.pgpass</code>、<code class="filename">.pg_service.conf</code>などをマップされたユーザは潜在的には利用可能なことを心に留めておいてください。
<code class="literal">peer</code>や<code class="literal">ident</code>認証のような認証モードで付与された信頼関係を使うこともできます。
   </p></div><div class="sect3" id="POSTGRES-FDW-OPTIONS-OBJECT-NAME"><div class="titlepage"><div><div><h4 class="title">F.38.1.2. オブジェクト名オプション <a href="#POSTGRES-FDW-OPTIONS-OBJECT-NAME" class="id_link">#</a></h4></div></div></div><!--
   <title>Object Name Options</title>
--><p>
<!--
    These options can be used to control the names used in SQL statements
    sent to the remote <productname>PostgreSQL</productname> server.  These
    options are needed when a foreign table is created with names different
    from the underlying remote table's names.
-->
これらのオプションによりリモートの<span class="productname">PostgreSQL</span>サーバに送出されるSQL文で使用される名前を制御する事ができます。
外部テーブルがリモートテーブルとは異なった名前で定義されている場合、これらのオプションは必須です。
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">schema_name</code> (<code class="type">string</code>)</span></dt><dd><p>
<!--
       This option, which can be specified for a foreign table, gives the
       schema name to use for the foreign table on the remote server.  If this
       option is omitted, the name of the foreign table's schema is used.
-->
外部テーブルに対して指定できるこのオプションは、リモートサーバ上のリモートテーブルのスキーマ名を与えます。
省略された場合、外部テーブルのスキーマ名が使用されます。
      <!-- (訳注: to use for the foreign table on... は remote table の間違い。) -->
      </p></dd><dt><span class="term"><code class="literal">table_name</code> (<code class="type">string</code>)</span></dt><dd><p>
<!--
       This option, which can be specified for a foreign table, gives the
       table name to use for the foreign table on the remote server.  If this
       option is omitted, the foreign table's name is used.
-->
外部テーブルに対して指定できるこのオプションは、リモートサーバ上のリモートテーブル名を与えます。
省略された場合、外部テーブルのテーブル名が使用されます。
      </p></dd><dt><span class="term"><code class="literal">column_name</code> (<code class="type">string</code>)</span></dt><dd><p>
<!--
       This option, which can be specified for a column of a foreign table,
       gives the column name to use for the column on the remote server.
       If this option is omitted, the column's name is used.
-->
外部テーブルのカラムに対して指定できるこのオプションは、リモートサーバ上のカラム名を与えます。
省略された場合、外部テーブルのカラム名が使用されます。
      </p></dd></dl></div></div><div class="sect3" id="POSTGRES-FDW-OPTIONS-COST-ESTIMATION"><div class="titlepage"><div><div><h4 class="title">F.38.1.3. コスト推定オプション <a href="#POSTGRES-FDW-OPTIONS-COST-ESTIMATION" class="id_link">#</a></h4></div></div></div><!--
   <title>Cost Estimation Options</title>
--><p>
<!--
    <filename>postgres_fdw</filename> retrieves remote data by executing queries
    against remote servers, so ideally the estimated cost of scanning a
    foreign table should be whatever it costs to be done on the remote
    server, plus some overhead for communication.  The most reliable way to
    get such an estimate is to ask the remote server and then add something
    for overhead &mdash; but for simple queries, it may not be worth the cost
    of an additional remote query to get a cost estimate.
    So <filename>postgres_fdw</filename> provides the following options to control
    how cost estimation is done:
-->
<code class="filename">postgres_fdw</code>はリモートサーバに対するクエリを実行しリモートのデータを受信します。したがって、理想的には外部テーブルをスキャンする推定コストは、それをリモートサーバで実行するコストと通信オーバーヘッドの和となります。
この推定を行うための最も信頼できる方法は、リモートサーバに問い合わせを行い、その結果にオーバーヘッド分を加算する事ですが、小さいクエリではコスト推定を得るための追加的な問い合わせに要するコストに見合わないかもしれません。
そこで、どのようにコスト推定を行うかを制御するため、<code class="filename">postgres_fdw</code>は以下のようなオプションを提供します。
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">use_remote_estimate</code> (<code class="type">boolean</code>)</span></dt><dd><p>
<!--
       This option, which can be specified for a foreign table or a foreign
       server, controls whether <filename>postgres_fdw</filename> issues remote
       <command>EXPLAIN</command> commands to obtain cost estimates.
       A setting for a foreign table overrides any setting for its server,
       but only for that table.
       The default is <literal>false</literal>.
-->
外部テーブルまたは外部サーバに指定できるこのオプションは、コスト推定を得るために<code class="filename">postgres_fdw</code>がリモートの<code class="command">EXPLAIN</code>コマンドを発行するかどうかを制御します。
外部テーブルに対する設定は、関連付けられた外部サーバに対する設定を上書きしますが、その効果は当該外部テーブルに限定されます。
デフォルト値は<code class="literal">false</code>です。
      </p></dd><dt><span class="term"><code class="literal">fdw_startup_cost</code> (<code class="type">floating point</code>)</span></dt><dd><p>
<!--
       This option, which can be specified for a foreign server, is a floating
       point value that is added to the estimated startup cost of any
       foreign-table scan on that server.  This represents the additional
       overhead of establishing a connection, parsing and planning the query on
       the remote side, etc.
       The default value is <literal>100</literal>.
-->
外部テーブルまたは外部サーバに指定できるこのオプションは、当該外部サーバに関連付けられた全ての外部テーブルスキャンの推定開始コストに加算される浮動小数点値です。
これは、接続の確立、リモート側でのクエリのパース・最適化など、追加的なオーバーヘッドを表現します。
デフォルト値は<code class="literal">100</code>です。
      </p></dd><dt><span class="term"><code class="literal">fdw_tuple_cost</code> (<code class="type">floating point</code>)</span></dt><dd><p>
<!--
       This option, which can be specified for a foreign server, is a floating
       point value that is used as extra cost per-tuple for foreign-table
       scans on that server.  This represents the additional overhead of
       data transfer between servers.  You might increase or decrease this
       number to reflect higher or lower network delay to the remote server.
       The default value is <literal>0.01</literal>.
-->
外部サーバに指定できるこのオプションは、このサーバでの外部テーブルのスキャンにおいて、各タプル毎に発生する追加的なコストとして使用される浮動小数点値です。
これは、サーバ間のデータ転送における追加的なオーバーヘッドを表現し、リモートサーバへのネットワーク遅延の高低を反映するためにこの数値を増減することができます。
デフォルト値は<code class="literal">0.01</code>です。
      </p></dd></dl></div><p>
<!--
    When <literal>use_remote_estimate</literal> is true,
    <filename>postgres_fdw</filename> obtains row count and cost estimates from the
    remote server and then adds <literal>fdw_startup_cost</literal> and
    <literal>fdw_tuple_cost</literal> to the cost estimates.  When
    <literal>use_remote_estimate</literal> is false,
    <filename>postgres_fdw</filename> performs local row count and cost estimation
    and then adds <literal>fdw_startup_cost</literal> and
    <literal>fdw_tuple_cost</literal> to the cost estimates.  This local
    estimation is unlikely to be very accurate unless local copies of the
    remote table's statistics are available.  Running
    <xref linkend="sql-analyze"/> on the foreign table is the way to update
    the local statistics; this will perform a scan of the remote table and
    then calculate and store statistics just as though the table were local.
    Keeping local statistics can be a useful way to reduce per-query planning
    overhead for a remote table &mdash; but if the remote table is
    frequently updated, the local statistics will soon be obsolete.
-->
<code class="literal">use_remote_estimate</code>が<code class="literal">true</code>の時、<code class="filename">postgres_fdw</code>はリモートサーバから行数とコスト推定値を取得し、それを<code class="literal">fdw_startup_cost</code>と<code class="literal">fdw_tuple_cost</code>に加算します。
一方、<code class="literal">use_remote_estimate</code>が<code class="literal">false</code>の時、<code class="filename">postgres_fdw</code>はローカルの行数とコスト推定値を取得し<code class="literal">fdw_startup_cost</code>と<code class="literal">fdw_tuple_cost</code>をコスト推定値に加算します。
このローカルな推定は、リモートテーブルの統計情報のローカルコピーが利用可能でないと、正確である見込みはほとんどありません。
ローカルな統計情報を更新するには外部テーブルに対する<a class="xref" href="sql-analyze.html" title="ANALYZE"><span class="refentrytitle">ANALYZE</span></a>を実行します。これはリモートテーブルに対するスキャンを実行し、あたかもローカルなテーブルであるかのように統計情報の計算と保存を行います。
ローカルな統計情報を保存する事で、クエリの度にリモートテーブルの実行計画を作成するオーバーヘッドを削減する事ができます。
しかしながら、リモートテーブルの更新頻度が高ければローカルの統計情報はすぐに実態を反映しなくなるでしょう。
   </p><p>
<!--
    The following option controls how such an <command>ANALYZE</command>
    operation behaves:
-->
《機械翻訳》以下のオプションは、このような<code class="command">ANALYZE</code>操作の動作を制御します。
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">analyze_sampling</code> (<code class="type">text</code>)</span></dt><dd><p>
<!--
       This option, which can be specified for a foreign table or a foreign
       server, determines if <command>ANALYZE</command> on a foreign table
       samples the data on the remote side, or reads and transfers all data
       and performs the sampling locally. The supported values
       are <literal>off</literal>, <literal>random</literal>,
       <literal>system</literal>, <literal>bernoulli</literal>
       and <literal>auto</literal>. <literal>off</literal> disables remote
       sampling, so all data are transferred and sampled locally.
       <literal>random</literal> performs remote sampling using the
       <literal>random()</literal> function to choose returned rows,
       while <literal>system</literal> and <literal>bernoulli</literal> rely
       on the built-in <literal>TABLESAMPLE</literal> methods of those
       names. <literal>random</literal> works on all remote server versions,
       while <literal>TABLESAMPLE</literal> is supported only since 9.5.
       <literal>auto</literal> (the default) picks the recommended sampling
       method automatically; currently it means
       either <literal>bernoulli</literal> or <literal>random</literal>
       depending on the remote server version.
-->
《機械翻訳》このオプションは、外部テーブルまたはリモートサーバに対して指定できます。 外部テーブルのサンプリングがリモート側で行われるか、すべてのデータを読み取ってローカルでサンプリングするかを決定します。
サポートされている値は、<code class="literal">off</code>、<code class="literal">random</code>、<code class="literal">system</code>、<code class="literal">bernoulli</code>、<code class="literal">auto</code>です。 <code class="literal">off</code>はリモートサンプリングを無効にし、すべてのデータが転送されてローカルでサンプリングされます。
<code class="literal">random</code>は<code class="literal">random()</code>関数を使用してリモートサンプリングを実行し、返された行を選択します。一方、<code class="literal">system</code>と<code class="literal">bernoulli</code>はそれらの名前の組込み<code class="literal">TABLESAMPLE</code>メソッドに依存します。
<code class="literal">random</code>はすべてのリモートサーババージョンで動作し、<code class="literal">TABLESAMPLE</code>は9.5以降でのみサポートされます。
<code class="literal">auto</code>(デフォルト)は推奨されるサンプリング方法を自動的に選択します。現在はリモートサーバのバージョンに応じて<code class="literal">bernoulli</code>または<code class="literal">random</code>のいずれかを意味します。
      </p></dd></dl></div></div><div class="sect3" id="POSTGRES-FDW-OPTIONS-REMOTE-EXECUTION"><div class="titlepage"><div><div><h4 class="title">F.38.1.4. リモート実行オプション <a href="#POSTGRES-FDW-OPTIONS-REMOTE-EXECUTION" class="id_link">#</a></h4></div></div></div><!--
   <title>Remote Execution Options</title>
--><p>
<!--
    By default, only <literal>WHERE</literal> clauses using built-in operators and
    functions will be considered for execution on the remote server.  Clauses
    involving non-built-in functions are checked locally after rows are
    fetched.  If such functions are available on the remote server and can be
    relied on to produce the same results as they do locally, performance can
    be improved by sending such <literal>WHERE</literal> clauses for remote
    execution.  This behavior can be controlled using the following option:
-->
デフォルトでは、組み込みの演算子および関数を使った<code class="literal">WHERE</code>句のみがリモートサーバでの実行を考慮されます。
組み込みでない関数を含む句は、行が取得された後、ローカルで検査されます。
そのような関数がリモートサーバで利用でき、かつローカルで実行するのと同じ結果を生成すると信頼できるときは、そのような<code class="literal">WHERE</code>句をリモートでの実行のために送出することでパフォーマンスを向上することができます。
この動作は以下のオプションを使うことで制御できます。
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">extensions</code> (<code class="type">string</code>)</span></dt><dd><p>
<!--
       This option is a comma-separated list of names
       of <productname>PostgreSQL</productname> extensions that are installed, in
       compatible versions, on both the local and remote servers.  Functions
       and operators that are immutable and belong to a listed extension will
       be considered shippable to the remote server.
       This option can only be specified for foreign servers, not per-table.
-->
このオプションは、<span class="productname">PostgreSQL</span>の拡張で、ローカルとリモートの両方に、互換のバージョンがインストールされているものの名前のリストです。
IMMUTABLEで、列挙された拡張に属する関数と演算子は、リモートサーバに送出可能とみなされます。
このオプションは外部サーバについてのみ指定可能で、テーブル毎の指定ではありません。
      </p><p>
<!--
       When using the <literal>extensions</literal> option, <emphasis>it is the
       user's responsibility</emphasis> that the listed extensions exist and behave
       identically on both the local and remote servers.  Otherwise, remote
       queries may fail or behave unexpectedly.
-->
<code class="literal">extensions</code>オプションを使用する場合、列挙する拡張が存在し、かつローカルとリモートのサーバで同一の動作をするようにすることは<span class="emphasis"><em>ユーザの責任です</em></span>。
そうでない場合、リモートの問い合わせは失敗したり、期待と異なる動作をするかもしれません。
      </p></dd><dt><span class="term"><code class="literal">fetch_size</code> (<code class="type">integer</code>)</span></dt><dd><p>
<!--
       This option specifies the number of rows <filename>postgres_fdw</filename>
       should get in each fetch operation. It can be specified for a foreign
       table or a foreign server. The option specified on a table overrides
       an option specified for the server.
       The default is <literal>100</literal>.
-->
このオプションは、<code class="filename">postgres_fdw</code>が1回のフェッチの動作で何行のデータを取得するかを指定します。
これは外部テーブルあるいは外部サーバに対して指定できます。
テーブルに対して指定されたオプションは、サーバに対して指定されたオプションよりも優先します。
デフォルトは<code class="literal">100</code>です。
      </p></dd><dt><span class="term"><code class="literal">batch_size</code> (<code class="type">integer</code>)</span></dt><dd><p>
<!--
       This option specifies the number of rows <filename>postgres_fdw</filename>
       should insert in each insert operation. It can be specified for a
       foreign table or a foreign server. The option specified on a table
       overrides an option specified for the server.
       The default is <literal>1</literal>.
-->
このオプションは、<code class="filename">postgres_fdw</code>が個々のINSERT操作で挿入する行数を指定します。
外部テーブルあるいは外部サーバに対して指定することができます。
テーブルに対してこのオプションを指定すると、サーバに対して指定されたオプションを上書きします。
デフォルトは<code class="literal">1</code>です。
      </p><p>
<!--
       Note the actual number of rows <filename>postgres_fdw</filename> inserts at
       once depends on the number of columns and the provided
       <literal>batch_size</literal> value. The batch is executed as a single
       query, and the libpq protocol (which <filename>postgres_fdw</filename>
       uses to connect to a remote server) limits the number of parameters in a
       single query to 65535. When the number of columns * <literal>batch_size</literal>
       exceeds the limit, the <literal>batch_size</literal> will be adjusted to
       avoid an error.
-->
<code class="filename">postgres_fdw</code>が実際に一度に挿入する行数は、列の数と指定された<code class="literal">batch_size</code>値に依存することに注意してください。
一つのバッチは単一の問い合わせとして実行され、libpqプロトコル（<code class="filename">postgres_fdw</code>がリモートサーバに接続するために使用します）は単一の問い合わせにおけるパラメータ数を65535に制限していることに注意してください。
列数 * <code class="literal">batch_size</code>がその上限を超えると、エラーを回避するために<code class="literal">batch_size</code>が調整されます。
      </p><p>
<!--
       This option also applies when copying into foreign tables.  In that case
       the actual number of rows <filename>postgres_fdw</filename> copies at
       once is determined in a similar way to the insert case, but it is
       limited to at most 1000 due to implementation restrictions of the
       <command>COPY</command> command.
-->
《機械翻訳》このオプションは、外部テーブルにコピーする場合にも適用されます。
その場合、<code class="filename">postgres_fdw</code>が一度にコピーする実際の行数は、<code class="command">COPY</code>コマンドの実装上の制限により、<code class="filename">postgres_fdw</code>が一度にコピーする行数と同様に決定されますが、1000以下に制限されます。
      </p></dd></dl></div></div><div class="sect3" id="POSTGRES-FDW-OPTIONS-ASYNCHRONOUS-EXECUTION"><div class="titlepage"><div><div><h4 class="title">F.38.1.5. 非同期実行オプション <a href="#POSTGRES-FDW-OPTIONS-ASYNCHRONOUS-EXECUTION" class="id_link">#</a></h4></div></div></div><!--
   <title>Asynchronous Execution Options</title>
--><p>
<!--
    <filename>postgres_fdw</filename> supports asynchronous execution, which
    runs multiple parts of an <structname>Append</structname> node
    concurrently rather than serially to improve performance.
    This execution can be controlled using the following option:
-->
<code class="filename">postgres_fdw</code>は非同期実行をサポートします。
これは性能を向上するために、複数の<code class="structname">Append</code>ノードの部分を順番にではなく、並行して実行します。
この実行は以下のオプションで制御できます。
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">async_capable</code> (<code class="type">boolean</code>)</span></dt><dd><p>
<!--
       This option controls whether <filename>postgres_fdw</filename> allows
       foreign tables to be scanned concurrently for asynchronous execution.
       It can be specified for a foreign table or a foreign server.
       A table-level option overrides a server-level option.
       The default is <literal>false</literal>.
-->
このオプションは、<code class="filename">postgres_fdw</code>が非同期実行の際に外部テーブルの並列走査を許すかどうかを制御します。
外部テーブルあるいは外部サーバに対して指定できます。
テーブルレベルのオプションはサーバレベルのオプションを上書きします。
デフォルトは<code class="literal">false</code>です。
      </p><p>
<!--
       In order to ensure that the data being returned from a foreign server
       is consistent, <filename>postgres_fdw</filename> will only open one
       connection for a given foreign server and will run all queries against
       that server sequentially even if there are multiple foreign tables
       involved, unless those tables are subject to different user mappings.
       In such a case, it may be more performant to disable this option to
       eliminate the overhead associated with running queries asynchronously.
-->
外部サーバから返却されるデータの一貫性を保証するために、<code class="filename">postgres_fdw</code>は一つの外部サーバに対して一つの接続だけを開きます。
そして、テーブルが異なるユーザマッピングの対象でない限り、複数の外部テーブルが存在してもすべての問い合わせをサーバに対して順番に実行します。
この場合、問い合わせを非同期に実行することによるオーバーヘッドをなくすためにこのオプションを使用しないほうが性能が良くなるかもしれません。
      </p><p>
<!--
       Asynchronous execution is applied even when an
       <structname>Append</structname> node contains subplan(s) executed
       synchronously as well as subplan(s) executed asynchronously.
       In such a case, if the asynchronous subplans are ones processed using
       <filename>postgres_fdw</filename>, tuples from the asynchronous
       subplans are not returned until after at least one synchronous subplan
       returns all tuples, as that subplan is executed while the asynchronous
       subplans are waiting for the results of asynchronous queries sent to
       foreign servers.
       This behavior might change in a future release.
-->
<code class="structname">Append</code>ノードに順次実行されるサブプランが含まれていても、あるいは非同期実行されるサブプランが含まれていても、非同期実行は適用されます。
このような場合では、非同期実行のサブプランが<code class="filename">postgres_fdw</code>を用いて処理されると、外部サーバに送信される非同期問い合わせの結果を非同期サブプランが待っている間に順次実行サブプランが実行されるため、少なくとも１つの順次実行サブプランがすべてのタプルを返すまでは、非同期実行サブプランによるタプルは返りません。
このふるまいは将来のリリースでは変更されるかもしれません。
      </p></dd></dl></div></div><div class="sect3" id="POSTGRES-FDW-OPTIONS-TRANSACTION-MANAGEMENT"><div class="titlepage"><div><div><h4 class="title">F.38.1.6. トランザクション管理オプション <a href="#POSTGRES-FDW-OPTIONS-TRANSACTION-MANAGEMENT" class="id_link">#</a></h4></div></div></div><!--
   <title>Transaction Management Options</title>
--><p>
<!--
    As described in the Transaction Management section, in
    <filename>postgres_fdw</filename> transactions are managed by creating
    corresponding remote transactions, and subtransactions are managed by
    creating corresponding remote subtransactions. When multiple remote
    transactions are involved in the current local transaction, by default
    <filename>postgres_fdw</filename> commits or aborts those remote
    transactions serially when the local transaction is committed or aborted.
    When multiple remote subtransactions are involved in the current local
    subtransaction, by default <filename>postgres_fdw</filename> commits or
    aborts those remote subtransactions serially when the local subtransaction
    is committed or aborted.
    Performance can be improved with the following options:
-->
《マッチ度[89.248705]》「トランザクション管理」セクションで説明されているように、<code class="filename">postgres_fdw</code>では、トランザクションは対応するリモートトランザクションを作成することで管理され、サブトランザクションは対応するリモートサブトランザクションを作成することで管理されます。
現在のローカルトランザクションに複数のリモートトランザクションが含まれている場合、デフォルトでは<code class="filename">postgres_fdw</code>はローカルトランザクションがコミットされたときに、これらのリモートサブトランザクションを順番にコミットします。
現在のローカルサブトランザクションに複数のリモートサブトランザクションが含まれている場合、デフォルトでは<code class="filename">postgres_fdw</code>はローカルサブトランザクションがコミットされたときに、これらのリモートサブトランザクションを順番にコミットします。
次のオプションでパフォーマンスを向上させることができます。
《機械翻訳》トランザクション管理のセクションで説明したように、<code class="filename">postgres_fdw</code>トランザクションは対応するリモートトランザクションを作成することによって管理され、サブトランザクションは対応するリモートサブトランザクションを作成することによって管理されます。
複数のリモートトランザクションが現在のローカルトランザクションに関係している場合、デフォルトでは<code class="filename">postgres_fdw</code>はローカルトランザクションがコミットまたは中断されたときにそれらのリモートトランザクションを連続的にコミットまたは中断します。
複数のリモートサブトランザクションが現在のローカルサブトランザクションに関係している場合、デフォルトでは<code class="filename">postgres_fdw</code>はローカルサブトランザクションがコミットまたは中断されたときにそれらのリモートサブトランザクションを連続的にコミットまたは中断します。
次のオプションを使用すると、パフォーマンスを向上させることができます。
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">parallel_commit</code> (<code class="type">boolean</code>)</span></dt><dd><p>
<!--
       This option controls whether <filename>postgres_fdw</filename> commits,
       in parallel, remote transactions opened on a foreign server in a local
       transaction when the local transaction is committed. This setting also
       applies to remote and local subtransactions. This option can only be
       specified for foreign servers, not per-table. The default is
       <literal>false</literal>.
-->
《マッチ度[88.346883]》このオプションは、ローカルトランザクションがコミットされたときに、ローカルトランザクション内の外部サーバで開かれたリモートトランザクションを<code class="filename">postgres_fdw</code>が並行してコミットするかどうかを制御します。
この設定は、リモートサブトランザクションとローカルサブトランザクションにも適用されます。
このオプションは外部サーバに対してのみ指定でき、テーブル単位では指定できません。
デフォルトは<code class="literal">false</code>です。
《機械翻訳》このオプションは、ローカルトランザクションがコミットされたときに、<code class="filename">postgres_fdw</code>がローカルトランザクションで開かれたリモートトランザクションを、並列に外部サーバ上でコミットするかどうかを制御します。
この設定は、リモートとローカルのサブトランザクションにも適用されます。
このオプションは、テーブルごとではなく、リモート・サーバに対してのみ指定できます。
デフォルトは<code class="literal">false</code>です。
      </p></dd><dt><span class="term"><code class="literal">parallel_abort</code> (<code class="type">boolean</code>)</span></dt><dd><p>
<!--
       This option controls whether <filename>postgres_fdw</filename> aborts,
       in parallel, remote transactions opened on a foreign server in a local
       transaction when the local transaction is aborted. This setting also
       applies to remote and local subtransactions. This option can only be
       specified for foreign servers, not per-table. The default is
       <literal>false</literal>.
-->
《マッチ度[85.245902]》このオプションは、ローカルトランザクションがコミットされたときに、ローカルトランザクション内の外部サーバで開かれたリモートトランザクションを<code class="filename">postgres_fdw</code>が並行してコミットするかどうかを制御します。
この設定は、リモートサブトランザクションとローカルサブトランザクションにも適用されます。
このオプションは外部サーバに対してのみ指定でき、テーブル単位では指定できません。
デフォルトは<code class="literal">false</code>です。
《機械翻訳》このオプションは、ローカルトランザクションがコミットされたときに、<code class="filename">postgres_fdw</code>がローカルトランザクションで開かれたリモートトランザクションを、並列に外部サーバ上でコミットするかどうかを制御します。
この設定は、リモートとローカルのサブトランザクションにも適用されます。
このオプションは、テーブルごとではなく、リモート・サーバに対してのみ指定できます。
デフォルトは<code class="literal">false</code>です
      </p></dd></dl></div><p>
<!--
    If multiple foreign servers with these options enabled are involved in a
    local transaction, multiple remote transactions on those foreign servers
    are committed or aborted in parallel across those foreign servers when
    the local transaction is committed or aborted.
-->
《マッチ度[79.847909]》このオプションが有効になっている複数の外部サーバがローカルトランザクションに関与している場合、これらの外部サーバ上の複数のリモートトランザクションは、ローカルトランザクションがコミットされるときに、これらの外部サーバ間で並列にコミットされます。
《機械翻訳》これらのオプションが有効な複数のリモート・サーバがローカル・トランザクションに関与している場合、ローカル・トランザクションがコミットまたは中断されると、これらのリモート・サーバ上の複数のリモート・トランザクションが、それらのリモート・サーバ上で並列にコミットまたは中断されます。
   </p><p>
<!--
    When these options are enabled, a foreign server with many remote
    transactions may see a negative performance impact when the local
    transaction is committed or aborted.
-->
《マッチ度[77.380952]》このオプションを有効にすると、多数のリモート・トランザクションを持つ外部サーバは、ローカル・トランザクションがコミットされたときにパフォーマンスに悪影響を与える可能性があります。
《機械翻訳》これらのオプションを有効にすると、多数のリモート・トランザクションがあるリモート・サーバは、ローカル・トランザクションがコミットまたは中断されたときに、パフォーマンスに悪影響を受ける可能性があります。
   </p></div><div class="sect3" id="POSTGRES-FDW-OPTIONS-UPDATABILITY"><div class="titlepage"><div><div><h4 class="title">F.38.1.7. 更新機能オプション <a href="#POSTGRES-FDW-OPTIONS-UPDATABILITY" class="id_link">#</a></h4></div></div></div><!--
   <title>Updatability Options</title>
--><p>
<!--
    By default all foreign tables using <filename>postgres_fdw</filename> are assumed
    to be updatable.  This may be overridden using the following option:
-->
デフォルトでは<code class="filename">postgres_fdw</code>を使用する全ての外部テーブルは更新可能であると想定されます。以下のオプションにより、この挙動を上書きする事ができます。
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">updatable</code> (<code class="type">boolean</code>)</span></dt><dd><p>
<!--
       This option controls whether <filename>postgres_fdw</filename> allows foreign
       tables to be modified using <command>INSERT</command>, <command>UPDATE</command> and
       <command>DELETE</command> commands.  It can be specified for a foreign table
       or a foreign server.  A table-level option overrides a server-level
       option.
       The default is <literal>true</literal>.
-->
このオプションは、<code class="filename">postgres_fdw</code>が<code class="command">INSERT</code>、<code class="command">UPDATE</code>あるいは<code class="command">DELETE</code>コマンドを使用して外部テーブルを操作する事を許可するかどうかを規定します。
外部テーブルで指定されたオプションは、外部サーバにおいて指定されたオプションを上書きします。
デフォルト値は<code class="literal">true</code>です。
      </p><p>
<!--
       Of course, if the remote table is not in fact updatable, an error
       would occur anyway.  Use of this option primarily allows the error to
       be thrown locally without querying the remote server.  Note however
       that the <literal>information_schema</literal> views will report a
       <filename>postgres_fdw</filename> foreign table to be updatable (or not)
       according to the setting of this option, without any check of the
       remote server.
-->
もちろん、リモートテーブルが実際には更新可能ではなかった場合、いずれにしてもエラーが発生するでしょう。このオプションを使用することで、リモートサーバへの問い合わせを行う事なくローカルでエラーを発生させることができます。
また、<code class="literal">information_schema</code>ビューは、このオプションの値に従って<code class="filename">postgres_fdw</code>管理下の外部テーブルを更新可能（あるいは不可能）であるとレポートする事に留意してください。
リモートサーバ側のチェックは一切行われません。
      </p></dd></dl></div></div><div class="sect3" id="POSTGRES-FDW-OPTIONS-TRUNCATABILITY"><div class="titlepage"><div><div><h4 class="title">F.38.1.8. 切り詰めオプション <a href="#POSTGRES-FDW-OPTIONS-TRUNCATABILITY" class="id_link">#</a></h4></div></div></div><!--
   <title>Truncatability Options</title>
--><p>
<!--
    By default all foreign tables using <filename>postgres_fdw</filename> are assumed
    to be truncatable.  This may be overridden using the following option:
-->
デフォルトでは<code class="filename">postgres_fdw</code>を使用する外部テーブルは切り詰め可能であると見なされます。
これは以下のオプションで変更が可能です。
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">truncatable</code> (<code class="type">boolean</code>)</span></dt><dd><p>
<!--
       This option controls whether <filename>postgres_fdw</filename> allows
       foreign tables to be truncated using the <command>TRUNCATE</command>
       command. It can be specified for a foreign table or a foreign server.
       A table-level option overrides a server-level option.
       The default is <literal>true</literal>.
-->
このオプションは<code class="filename">postgres_fdw</code>が外部テーブルを<code class="command">TRUNCATE</code>を使って切り詰めることができるかどうかを制御します。
外部テーブルあるいは外部サーバに対して指定できます。
外部テーブルで指定されたオプションは、外部サーバにおいて指定されたオプションを上書きします。
デフォルトは<code class="literal">true</code>です。
      </p><p>
<!--
       Of course, if the remote table is not in fact truncatable, an error
       would occur anyway.  Use of this option primarily allows the error to
       be thrown locally without querying the remote server.
-->
もちろん外部テーブルが切り詰め不可能なら、結局エラーが生じます。
このオプションを使用することにより、リモートサーバに問い合わせることなくエラーをローカルで起こすことができるのが主な用途です。
      </p></dd></dl></div></div><div class="sect3" id="POSTGRES-FDW-OPTIONS-IMPORTING"><div class="titlepage"><div><div><h4 class="title">F.38.1.9. インポートのオプション <a href="#POSTGRES-FDW-OPTIONS-IMPORTING" class="id_link">#</a></h4></div></div></div><!--
   <title>Importing Options</title>
--><p>
<!--
    <filename>postgres_fdw</filename> is able to import foreign table definitions
    using <xref linkend="sql-importforeignschema"/>.  This command creates
    foreign table definitions on the local server that match tables or
    views present on the remote server.  If the remote tables to be imported
    have columns of user-defined data types, the local server must have
    compatible types of the same names.
-->
<code class="filename">postgres_fdw</code>は<a class="xref" href="sql-importforeignschema.html" title="IMPORT FOREIGN SCHEMA"><span class="refentrytitle">IMPORT FOREIGN SCHEMA</span></a>を使って、外部テーブルの定義をインポートすることができます。
このコマンドは、リモートのサーバ上に存在するテーブルあるいはビューとマッチする外部テーブルの定義をローカルサーバ上に作成します。
インポートするリモートのテーブルにユーザ定義のデータ型の列がある場合、ローカルサーバにも同じ名前の互換性のある型がなければなりません。
   </p><p>
<!--
    Importing behavior can be customized with the following options
    (given in the <command>IMPORT FOREIGN SCHEMA</command> command):
-->
インポートの動作は以下のオプションでカスタマイズできます（<code class="command">IMPORT FOREIGN SCHEMA</code>コマンドで指定します）。
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">import_collate</code> (<code class="type">boolean</code>)</span></dt><dd><p>
<!--
       This option controls whether column <literal>COLLATE</literal> options
       are included in the definitions of foreign tables imported
       from a foreign server. The default is <literal>true</literal>.  You might
       need to turn this off if the remote server has a different set of
       collation names than the local server does, which is likely to be the
       case if it's running on a different operating system.
       If you do so, however, there is a very severe risk that the imported
       table columns' collations will not match the underlying data, resulting
       in anomalous query behavior.
-->
このオプションは、列の<code class="literal">COLLATE</code>オプションが、外部サーバからインポートする外部テーブルの定義に含まれているかどうかを制御します。
デフォルトは<code class="literal">true</code>です。
リモートサーバとローカルサーバで照合順序の名前の集合が異なる場合は、この設定を無効にする必要があるでしょう。
リモートサーバが異なるOSで動作しているなら、そういうことがありそうです。
しかし、そうした時には、インポートしたテーブルの列の照合順序が実際のデータと一致せず、問い合わせの振る舞いが結果として異常になる大きなリスクがあります。
      </p><p>
<!--
       Even when this parameter is set to <literal>true</literal>, importing
       columns whose collation is the remote server's default can be risky.
       They will be imported with <literal>COLLATE "default"</literal>, which
       will select the local server's default collation, which could be
       different.
-->
このパラメータが<code class="literal">true</code>のときでさえ、照合順序がリモートサーバのデフォルトである列をインポートするのは危険性があります。
これらの列は<code class="literal">COLLATE "default"</code>としてインポートされますが、ローカルサーバのデフォルトの照合順序は異なるかもしれません。
      </p></dd><dt><span class="term"><code class="literal">import_default</code> (<code class="type">boolean</code>)</span></dt><dd><p>
<!--
       This option controls whether column <literal>DEFAULT</literal> expressions
       are included in the definitions of foreign tables imported
       from a foreign server. The default is <literal>false</literal>.  If you
       enable this option, be wary of defaults that might get computed
       differently on the local server than they would be on the remote
       server; <function>nextval()</function> is a common source of problems.
       The <command>IMPORT</command> will fail altogether if an imported default
       expression uses a function or operator that does not exist locally.
-->
このオプションは、列の<code class="literal">DEFAULT</code>式が外部サーバからインポートされる外部テーブルの定義に含まれているかどうかを制御します。
デフォルトは<code class="literal">false</code>です。
このオプションを有効にする場合は、ローカルサーバとリモートサーバで異なる計算をされるデフォルトに注意して下さい。
<code class="function">nextval()</code>はよくある問題の一つです。
インポートされるデフォルト式がローカルには存在しない関数または演算子を使っていた場合、<code class="command">IMPORT</code>は失敗します。
      </p></dd><dt><span class="term"><code class="literal">import_generated</code> (<code class="type">boolean</code>)</span></dt><dd><p>
<!--
       This option controls whether column <literal>GENERATED</literal> expressions
       are included in the definitions of foreign tables imported
       from a foreign server. The default is <literal>true</literal>.
       The <command>IMPORT</command> will fail altogether if an imported generated
       expression uses a function or operator that does not exist locally.
-->
このオプションは、外部サーバからインポートされた外部テーブルの定義に<code class="literal">GENERATED</code>列式が含まれるかどうかを制御します。
デフォルトは<code class="literal">true</code>です。
インポートされる生成式がローカルには存在しない関数あるいは演算子を使っていた場合、<code class="command">IMPORT</code>は失敗します。
      </p></dd><dt><span class="term"><code class="literal">import_not_null</code> (<code class="type">boolean</code>)</span></dt><dd><p>
<!--
       This option controls whether column <literal>NOT NULL</literal>
       constraints are included in the definitions of foreign tables imported
       from a foreign server. The default is <literal>true</literal>.
-->
このオプションは、列の<code class="literal">NOT NULL</code>制約が、外部サーバからインポートされる外部テーブルの定義に含まれているかどうかを制御します。
デフォルトは<code class="literal">true</code>です。
      </p></dd></dl></div><p>
<!--
    Note that constraints other than <literal>NOT NULL</literal> will never be
    imported from the remote tables.  Although <productname>PostgreSQL</productname>
    does support check constraints on foreign tables, there is no
    provision for importing them automatically, because of the risk that a
    constraint expression could evaluate differently on the local and remote
    servers.  Any such inconsistency in the behavior of a check
    constraint could lead to hard-to-detect errors in query optimization.
    So if you wish to import check constraints, you must do so
    manually, and you should verify the semantics of each one carefully.
    For more detail about the treatment of check constraints on
    foreign tables, see <xref linkend="sql-createforeigntable"/>.
-->
<code class="literal">NOT NULL</code>以外の制約は決してリモートのテーブルからインポートされないことに注意して下さい。
<span class="productname">PostgreSQL</span>は外部テーブルのcheck制約をサポートしていますが、それを自動的にインポートする予定はありません。
なぜなら、制約の式はローカルとリモートのサーバで異なる評価をされる危険があるからです。
check制約でそのような一貫しない動作があると、問い合わせの最適化で検知するのが難しい誤りが発生するかもしれません。
そのため、check制約をインポートしたい場合は、それを手作業で実行する必要があり、またその一つ一つの意味を注意深く確認するべきです。
外部テーブルのcheck制約の取扱いについて、詳しくは<a class="xref" href="sql-createforeigntable.html" title="CREATE FOREIGN TABLE"><span class="refentrytitle">CREATE FOREIGN TABLE</span></a>を参照して下さい。
   </p><p>
<!--
    Tables or foreign tables which are partitions of some other table are
    imported only when they are explicitly specified in
    <literal>LIMIT TO</literal> clause.  Otherwise they are automatically
    excluded from <xref linkend="sql-importforeignschema"/>.
    Since all data can be accessed through the partitioned table
    which is the root of the partitioning hierarchy, importing only
    partitioned tables should allow access to all the data without
    creating extra objects.
-->
他のテーブルのパーティションであるテーブルや外部テーブルは、明示的な<code class="literal">LIMIT TO</code>句が指定されている場合にのみインポートされます。
そうでなければそれらは、<a class="xref" href="sql-importforeignschema.html" title="IMPORT FOREIGN SCHEMA"><span class="refentrytitle">IMPORT FOREIGN SCHEMA</span></a>から自動的に除外されます。
パーティショニング化階層のルートであるパーティションテーブルを介してすべてのデータにアクセスできるため、パーティション化テーブルのみをインポートすることで余分なオブジェクトを作成せずにすべてのデータにアクセスできます。
   </p></div><div class="sect3" id="POSTGRES-FDW-OPTIONS-CONNECTION-MANAGEMENT"><div class="titlepage"><div><div><h4 class="title">F.38.1.10. 接続管理オプション <a href="#POSTGRES-FDW-OPTIONS-CONNECTION-MANAGEMENT" class="id_link">#</a></h4></div></div></div><!--
    <title>Connection Management Options</title>
--><p>
<!--
     By default, all connections that <filename>postgres_fdw</filename>
     establishes to foreign servers are kept open in the local session
     for re-use.
-->
デフォルトでは<code class="filename">postgres_fdw</code>が外部サーバに確立した接続は、再利用のためにローカルセッションにおいて開いたまま維持されます。
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">keep_connections</code> (<code class="type">boolean</code>)</span></dt><dd><p>
<!--
        This option controls whether <filename>postgres_fdw</filename> keeps
        the connections to the foreign server open so that subsequent
        queries can re-use them. It can only be specified for a foreign server.
        The default is <literal>on</literal>. If set to <literal>off</literal>,
        all connections to this foreign server will be discarded at the end of
        each transaction.
-->
このオプションは、後の再利用のために<code class="filename">postgres_fdw</code>が外部サーバに対する接続を保持したままにしておくかどうかを制御します。
外部サーバに対してのみ指定ができます。
デフォルトは<code class="literal">on</code>です。
<code class="literal">off</code>に設定すると、この外部サーバに対するすべての接続は個々のトランザクションの終了時に破棄されます。
      </p></dd></dl></div></div></div><div class="sect2" id="POSTGRES-FDW-FUNCTIONS"><div class="titlepage"><div><div><h3 class="title">F.38.2. 関数 <a href="#POSTGRES-FDW-FUNCTIONS" class="id_link">#</a></h3></div></div></div><!--
  <title>Functions</title>
--><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="function">postgres_fdw_get_connections(OUT server_name text, OUT valid boolean) returns setof record</code></span></dt><dd><p>
<!--
      This function returns the foreign server names of all the open
      connections that <filename>postgres_fdw</filename> established from
      the local session to the foreign servers. It also returns whether
      each connection is valid or not. <literal>false</literal> is returned
      if the foreign server connection is used in the current local
      transaction but its foreign server or user mapping is changed or
      dropped (Note that server name of an invalid connection will be
      <literal>NULL</literal> if the server is dropped),
      and then such invalid connection will be closed at
      the end of that transaction. <literal>true</literal> is returned
      otherwise. If there are no open connections, no record is returned.
      Example usage of the function:
-->
この関数は、<code class="filename">postgres_fdw</code>によってローカルセッションから外部サーバに確立されたすべての開いている接続の外部サーバ名を返します。
個々の接続が有効かどうかも返します。
外部サーバの接続が現在のローカルトランザクションで使用されていても、外部サーバあるいはユーザマッピングが変更あるいは削除されると<code class="literal">false</code>が返り（無効な接続のサーバ名は、サーバが削除されると<code class="literal">NULL</code>になることに注意してください）、そうした無効な接続はトランザクションの終了時に閉じられます。
そうでなければ<code class="literal">true</code>が返ります。
開いた接続がなければレコードは返りません。
関数の使用例を示します。
</p><pre class="screen">
postgres=# SELECT * FROM postgres_fdw_get_connections() ORDER BY 1;
 server_name | valid
-------------+-------
 loopback1   | t
 loopback2   | f
</pre><p>
     </p></dd><dt><span class="term"><code class="function">postgres_fdw_disconnect(server_name text) returns boolean</code></span></dt><dd><p>
<!--
      This function discards the open connections that are established by
      <filename>postgres_fdw</filename> from the local session to
      the foreign server with the given name.  Note that there can be
      multiple connections to the given server using different user mappings.
      If the connections are used in the current local transaction,
      they are not disconnected and warning messages are reported.
      This function returns <literal>true</literal> if it disconnects
      at least one connection, otherwise <literal>false</literal>.
      If no foreign server with the given name is found, an error is reported.
      Example usage of the function:
-->
この関数は、<code class="filename">postgres_fdw</code>によってローカルセッションから指定された名前の外部サーバに確立された開いている接続を破棄します。
異なるユーザマッピングを使用することにより、指定されたサーバに複数の接続が存在する可能性があることに注意してください。
現在のローカルトランザクションで接続が使われている場合は、接続は切断されず、警告メッセージが報告されます。
少なくとも１つの接続が切断されると、この関数は<code class="literal">true</code>を返し、そうでない場合は<code class="literal">false</code>を返します。
指定した名前の外部サーバが存在しなければ、エラーが報告されます。
この関数の使用例を示します。
</p><pre class="screen">
postgres=# SELECT postgres_fdw_disconnect('loopback1');
 postgres_fdw_disconnect
-------------------------
 t
</pre><p>
     </p></dd><dt><span class="term"><code class="function">postgres_fdw_disconnect_all() returns boolean</code></span></dt><dd><p>
<!--
      This function discards all the open connections that are established by
      <filename>postgres_fdw</filename> from the local session to
      foreign servers.  If the connections are used in the current local
      transaction, they are not disconnected and warning messages are reported.
      This function returns <literal>true</literal> if it disconnects
      at least one connection, otherwise <literal>false</literal>.
      Example usage of the function:
-->
この関数は、<code class="filename">postgres_fdw</code>によってローカルセッションから外部サーバに確立されたすべての開いている接続を破棄します。
現在のローカルトランザクションで接続が使われている場合は、接続は切断されず、警告メッセージが報告されます。
少なくとも１つの接続が切断されると、この関数は<code class="literal">true</code>を返します。
さもなければ<code class="literal">false</code>が返ります。
この関数の使用例を示します。
</p><pre class="screen">
postgres=# SELECT postgres_fdw_disconnect_all();
 postgres_fdw_disconnect_all
-----------------------------
 t
</pre><p>
     </p></dd></dl></div></div><div class="sect2" id="POSTGRES-FDW-CONNECTION-MANAGEMENT"><div class="titlepage"><div><div><h3 class="title">F.38.3. 接続管理 <a href="#POSTGRES-FDW-CONNECTION-MANAGEMENT" class="id_link">#</a></h3></div></div></div><!--
  <title>Connection Management</title>
--><p>
<!--
   <filename>postgres_fdw</filename> establishes a connection to a
   foreign server during the first query that uses a foreign table
   associated with the foreign server.  By default this connection
   is kept and re-used for subsequent queries in the same session.
   This behavior can be controlled using
   <literal>keep_connections</literal> option for a foreign server. If
   multiple user identities (user mappings) are used to access the foreign
   server, a connection is established for each user mapping.
-->
<code class="filename">postgres_fdw</code>は、外部サーバに関連付けられた外部テーブルを参照するクエリを最初に実行する際に、外部サーバへの接続を確立します。
デフォルトではこの接続は保持され、同じセッションで以降の問い合わせのために再利用されます。
この振る舞いは外部サーバの<code class="literal">keep_connections</code>オプションを使って制御できます。
しかし、外部サーバへのアクセスに対して複数のユーザ識別子（ユーザマッピング）が使用される場合には、接続はユーザマッピング毎に確立される事になります。
  </p><p>
<!--
   When changing the definition of or removing a foreign server or
   a user mapping, the associated connections are closed.
   But note that if any connections are in use in the current local transaction,
   they are kept until the end of the transaction.
   Closed connections will be re-established when they are necessary
   by future queries using a foreign table.
-->
外部サーバあるいはユーザマッピングの定義を変更ないし削除している場合は、関連する接続は閉じられます。
しかし、現在のローカルトランザクションが接続を使っていると、接続はトランザクションが終了するまでは維持されることに注意してください。
このあと外部テーブルを使用する問い合わせで必要になれば、閉じた接続は再び確立されます。
  </p><p>
<!--
   Once a connection to a foreign server has been established,
   it's by default kept until the local or corresponding remote
   session exits.  To disconnect a connection explicitly,
   <literal>keep_connections</literal> option for a foreign server
   may be disabled, or
   <function>postgres_fdw_disconnect</function> and
   <function>postgres_fdw_disconnect_all</function> functions
   may be used.  For example, these are useful to close
   connections that are no longer necessary, thereby releasing
   connections on the foreign server.
-->
ひとたび外部サーバに接続が確立されると、デフォルトではローカルあるいは関連するリモートセッションが終了するまで接続は維持されます。
明示的に接続を切断するには外部サーバの<code class="literal">keep_connections</code>オプションを無効にするか、<code class="function">postgres_fdw_disconnect</code>関数あるいは<code class="function">postgres_fdw_disconnect_all</code>関数を使用します。
たとえば、必要がなくなった接続を切断し、それによって外部サーバの接続を開放するのにこれらの関数が役に立ちます。
  </p></div><div class="sect2" id="POSTGRES-FDW-TRANSACTION-MANAGEMENT"><div class="titlepage"><div><div><h3 class="title">F.38.4. トランザクション管理 <a href="#POSTGRES-FDW-TRANSACTION-MANAGEMENT" class="id_link">#</a></h3></div></div></div><!--
  <title>Transaction Management</title>
--><p>
<!--
   During a query that references any remote tables on a foreign server,
   <filename>postgres_fdw</filename> opens a transaction on the
   remote server if one is not already open corresponding to the current
   local transaction.  The remote transaction is committed or aborted when
   the local transaction commits or aborts.  Savepoints are similarly
   managed by creating corresponding remote savepoints.
-->
外部サーバ上のリモートテーブルを参照する際に、まだトランザクションが開始されていなければ<code class="filename">postgres_fdw</code>はリモートサーバ上でトランザクションを開始します。
ローカルのトランザクションがコミット、あるいはアボートした時、リモートのトランザクションも同様にコミット、あるいはアボートします。
セーブポイントも同様に管理され、リモート側に関連付けられたセーブポイントが作成されます。
  </p><p>
<!--
   The remote transaction uses <literal>SERIALIZABLE</literal>
   isolation level when the local transaction has <literal>SERIALIZABLE</literal>
   isolation level; otherwise it uses <literal>REPEATABLE READ</literal>
   isolation level.  This choice ensures that if a query performs multiple
   table scans on the remote server, it will get snapshot-consistent results
   for all the scans.  A consequence is that successive queries within a
   single transaction will see the same data from the remote server, even if
   concurrent updates are occurring on the remote server due to other
   activities.  That behavior would be expected anyway if the local
   transaction uses <literal>SERIALIZABLE</literal> or <literal>REPEATABLE READ</literal>
   isolation level, but it might be surprising for a <literal>READ
   COMMITTED</literal> local transaction.  A future
   <productname>PostgreSQL</productname> release might modify these rules.
-->
ローカルトランザクションが<code class="literal">SERIALIZABLE</code>分離レベルを用いている時、リモートトランザクションも<code class="literal">SERIALIZABLE</code>分離レベルを使用します。
それ以外の場合には<code class="literal">REPEATABLE READ</code>分離レベルを使用します。
これは、あるクエリが複数のテーブルスキャンをリモート側で行う際に、確実に全てのスキャンにおいて一貫したスナップショットで結果を取り出すためです。
その結果、別の要求によってリモートサーバ側で競合する更新が発生したとしても、あるトランザクション内の問い合わせはリモートサーバからの一貫したデータを参照する事となります。
ローカルのトランザクションが<code class="literal">SERIALIZABLE</code>あるいは<code class="literal">REPEATABLE READ</code>分離レベルを用いている場合、この動作は期待通りのものでしょう。
一方、ローカルのトランザクションが<code class="literal">READ COMMITTED</code>分離レベルを使用している場合には、予想外の動作かもしれません。
将来の<span class="productname">PostgreSQL</span>リリースではこれらのルールに変更が加えられるかもしれません。
  </p><p>
<!--
   Note that it is currently not supported by
   <filename>postgres_fdw</filename> to prepare the remote transaction for
   two-phase commit.
-->
<code class="filename">postgres_fdw</code>は今のところ、二相コミットのためのリモートトランザクションの準備をサポートしていないことに注意して下さい。
  </p></div><div class="sect2" id="POSTGRES-FDW-REMOTE-QUERY-OPTIMIZATION"><div class="titlepage"><div><div><h3 class="title">F.38.5. リモート問い合わせの最適化 <a href="#POSTGRES-FDW-REMOTE-QUERY-OPTIMIZATION" class="id_link">#</a></h3></div></div></div><!--
  <title>Remote Query Optimization</title>
--><p>
<!--
   <filename>postgres_fdw</filename> attempts to optimize remote queries to reduce
   the amount of data transferred from foreign servers.  This is done by
   sending query <literal>WHERE</literal> clauses to the remote server for
   execution, and by not retrieving table columns that are not needed for
   the current query.  To reduce the risk of misexecution of queries,
   <literal>WHERE</literal> clauses are not sent to the remote server unless they use
   only data types, operators, and functions that are built-in or belong to an
   extension that's listed in the foreign server's <literal>extensions</literal>
   option.  Operators and functions in such clauses must
   be <literal>IMMUTABLE</literal> as well.
   For an <command>UPDATE</command> or <command>DELETE</command> query,
   <filename>postgres_fdw</filename> attempts to optimize the query execution by
   sending the whole query to the remote server if there are no query
   <literal>WHERE</literal> clauses that cannot be sent to the remote server,
   no local joins for the query, no row-level local <literal>BEFORE</literal> or
   <literal>AFTER</literal> triggers or stored generated columns on the target
   table, and no <literal>CHECK OPTION</literal> constraints from parent
   views.  In <command>UPDATE</command>,
   expressions to assign to target columns must use only built-in data types,
   <literal>IMMUTABLE</literal> operators, or <literal>IMMUTABLE</literal> functions,
   to reduce the risk of misexecution of the query.
-->
外部サーバからのデータ転送量を削減するため、<code class="filename">postgres_fdw</code>はリモート問い合わせを最適化しようと試みます。
これは問い合わせの<code class="literal">WHERE</code>句をリモートサーバに送出する事、およびクエリで必要とされていないカラムを取得しない事により行われます。
問い合わせの誤作動のリスクを下げるため、組み込みあるいは外部サーバの<code class="literal">extensions</code>オプションに列挙されている拡張に属するデータ型、演算子、関数だけを用いたものでない限り、リモートサーバに<code class="literal">WHERE</code>句は送出されません。
また、そのような<code class="literal">WHERE</code>句で使われる演算子と関数は<code class="literal">IMMUTABLE</code>でなければなりません。
<code class="command">UPDATE</code>あるいは<code class="command">DELETE</code>の問い合わせについては、リモートサーバに送出できない<code class="literal">WHERE</code>句がなく、問い合わせにローカルな結合がなく、対象のテーブルにローカルな行レベルの<code class="literal">BEFORE</code>あるいは<code class="literal">AFTER</code>トリガーや格納された生成列がなく、親ビューからの<code class="literal">CHECK OPTION</code>制約がないのであれば、<code class="filename">postgres_fdw</code>は問い合わせ全体をリモートサーバに送出することで、問い合わせの実行の最適化を図ります。
<code class="command">UPDATE</code>では、問い合わせの誤った実行のリスクを低減するため、対象列への代入式では組み込みのデータ型、<code class="literal">IMMUTABLE</code>演算子、<code class="literal">IMMUTABLE</code>関数のみを使わなければなりません。
  </p><p>
<!--
   When <filename>postgres_fdw</filename> encounters a join between foreign tables on
   the same foreign server, it sends the entire join to the foreign server,
   unless for some reason it believes that it will be more efficient to fetch
   rows from each table individually, or unless the table references involved
   are subject to different user mappings.  While sending the <literal>JOIN</literal>
   clauses, it takes the same precautions as mentioned above for the
   <literal>WHERE</literal> clauses.
-->
同一の外部サーバ上の外部テーブルの間の結合がある場合、<code class="filename">postgres_fdw</code>はその結合全体を外部サーバに送出します。
ただし、何らかの理由で各テーブルから個別に行を取得する方が効率的だと思われる場合、あるいは結合に含まれるテーブルの参照が異なるユーザマッピングに従う場合を除きます。
<code class="literal">JOIN</code>句を送出するにあたり、<code class="literal">WHERE</code>句に関して上で説明したことと同じ注意が払われます。
  </p><p>
<!--
   The query that is actually sent to the remote server for execution can
   be examined using <command>EXPLAIN VERBOSE</command>.
-->
リモートサーバでの実行のために実際に送出される問い合わせは<code class="command">EXPLAIN VERBOSE</code>を用いて調べる事ができます。
  </p></div><div class="sect2" id="POSTGRES-FDW-REMOTE-QUERY-EXECUTION-ENVIRONMENT"><div class="titlepage"><div><div><h3 class="title">F.38.6. リモート問い合わせ実行環境 <a href="#POSTGRES-FDW-REMOTE-QUERY-EXECUTION-ENVIRONMENT" class="id_link">#</a></h3></div></div></div><!--
  <title>Remote Query Execution Environment</title>
--><p>
<!--
   In the remote sessions opened by <filename>postgres_fdw</filename>,
   the <xref linkend="guc-search-path"/> parameter is set to
   just <literal>pg_catalog</literal>, so that only built-in objects are visible
   without schema qualification.  This is not an issue for queries
   generated by <filename>postgres_fdw</filename> itself, because it always
   supplies such qualification.  However, this can pose a hazard for
   functions that are executed on the remote server via triggers or rules
   on remote tables.  For example, if a remote table is actually a view,
   any functions used in that view will be executed with the restricted
   search path.  It is recommended to schema-qualify all names in such
   functions, or else attach <literal>SET search_path</literal> options
   (see <xref linkend="sql-createfunction"/>) to such functions
   to establish their expected search path environment.
-->
<code class="filename">postgres_fdw</code>が開いたリモートセッションでは、<a class="xref" href="runtime-config-client.html#GUC-SEARCH-PATH">search_path</a>パラメータは<code class="literal">pg_catalog</code>にだけ設定されますので、スキーマで修飾しなければ組み込みオブジェクトだけが可視です。
<code class="filename">postgres_fdw</code>自身が生成した問い合わせでは、常にそのような修飾を行ないますので、これは問題になりません。
しかし、リモートテーブルのトリガやルールによってリモートサーバ上で実行された関数にとっては問題の原因となり得ます。
例えば、リモートテーブルが実際にはビューであれば、そのビューで使われている関数はすべて制限された検索パスで実行されるでしょう。
期待される検索パス環境を確立できるよう、そのような関数では名前はすべてスキーマ修飾するか、そのような関数に<code class="literal">SET search_path</code>オプション(<a class="xref" href="sql-createfunction.html" title="CREATE FUNCTION"><span class="refentrytitle">CREATE FUNCTION</span></a>参照)を付けることをお薦めします。
  </p><p>
<!--
   <filename>postgres_fdw</filename> likewise establishes remote session settings
   for various parameters:
-->
<code class="filename">postgres_fdw</code>は、同様に様々なパラメータでリモートセッション設定を確立します。
   </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
<!--
      <xref linkend="guc-timezone"/> is set to <literal>UTC</literal>
-->
<a class="xref" href="runtime-config-client.html#GUC-TIMEZONE">TimeZone</a>は<code class="literal">UTC</code>に設定されます。
     </p></li><li class="listitem"><p>
<!--
      <xref linkend="guc-datestyle"/> is set to <literal>ISO</literal>
-->
<a class="xref" href="runtime-config-client.html#GUC-DATESTYLE">DateStyle</a>は<code class="literal">ISO</code>に設定されます。
     </p></li><li class="listitem"><p>
<!--
      <xref linkend="guc-intervalstyle"/> is set to <literal>postgres</literal>
-->
<a class="xref" href="runtime-config-client.html#GUC-INTERVALSTYLE">IntervalStyle</a>は<code class="literal">postgres</code>に設定されます。
     </p></li><li class="listitem"><p>
<!--
      <xref linkend="guc-extra-float-digits"/> is set to <literal>3</literal> for remote
      servers 9.0 and newer and is set to <literal>2</literal> for older versions
-->
<a class="xref" href="runtime-config-client.html#GUC-EXTRA-FLOAT-DIGITS">extra_float_digits</a>はリモートサーバが9.0以上では<code class="literal">3</code>に設定され、それより古いバージョンでは<code class="literal">2</code>に設定されます。
     </p></li></ul></div><p>
<!--
   These are less likely to be problematic than <varname>search_path</varname>, but
   can be handled with function <literal>SET</literal> options if the need arises.
-->
これは<code class="varname">search_path</code>ほど問題にはならないでしょうが、もし必要になったら関数の<code class="literal">SET</code>オプションで処理してください。
  </p><p>
<!--
   It is <emphasis>not</emphasis> recommended that you override this behavior by
   changing the session-level settings of these parameters; that is likely
   to cause <filename>postgres_fdw</filename> to malfunction.
-->
上のパラメータのセッションレベルの設定を変更することで、この振舞いを覆すことはお薦め<span class="emphasis"><em>しません</em></span>。
<code class="filename">postgres_fdw</code>が正常に動作しない原因となるでしょう。
  </p></div><div class="sect2" id="POSTGRES-FDW-CROSS-VERSION-COMPATIBILITY"><div class="titlepage"><div><div><h3 class="title">F.38.7. バージョン間互換性 <a href="#POSTGRES-FDW-CROSS-VERSION-COMPATIBILITY" class="id_link">#</a></h3></div></div></div><!--
  <title>Cross-Version Compatibility</title>
--><p>
<!--
   <filename>postgres_fdw</filename> can be used with remote servers dating back
   to <productname>PostgreSQL</productname> 8.3.  Read-only capability is available
   back to 8.1.  A limitation however is that <filename>postgres_fdw</filename>
   generally assumes that immutable built-in functions and operators are
   safe to send to the remote server for execution, if they appear in a
   <literal>WHERE</literal> clause for a foreign table.  Thus, a built-in
   function that was added since the remote server's release might be sent
   to it for execution, resulting in <quote>function does not exist</quote> or
   a similar error.  This type of failure can be worked around by
   rewriting the query, for example by embedding the foreign table
   reference in a sub-<literal>SELECT</literal> with <literal>OFFSET 0</literal> as an
   optimization fence, and placing the problematic function or operator
   outside the sub-<literal>SELECT</literal>.
-->
<code class="filename">postgres_fdw</code>のリモートサーバには<span class="productname">PostgreSQL</span> 8.3以降のバージョンを使用する事ができます。
読み取り専用であれば、8.1以降のバージョンまで可能です。
一方、<code class="filename">postgres_fdw</code>は<code class="literal">IMMUTABLE</code>属性を持った組み込みの演算子と関数が外部テーブルの<code class="literal">WHERE</code>句に含まれる場合、リモート側で実行しても安全であると仮定します。そのため、リモートサーバのリリース後に追加された関数が実行のために送出されるかもしれず、結果として<span class="quote">「<span class="quote">関数が見つかりません</span>」</span>あるいは類するエラーを発生させる事になります。
この種の問題は問い合わせの書き換えによって対処する事ができます。
例えば、最適化を妨げるため、外部テーブルへの参照を<code class="literal">OFFSET 0</code>を付けてsub-<code class="literal">SELECT</code>に埋め込み、問題のある関数や演算子をsub-<code class="literal">SELECT</code>の外に配置するなどの方法があります。
  </p></div><div class="sect2" id="POSTGRES-FDW-CONFIGURATION-PARAMETERS"><div class="titlepage"><div><div><h3 class="title">F.38.8. 設定パラメータ <a href="#POSTGRES-FDW-CONFIGURATION-PARAMETERS" class="id_link">#</a></h3></div></div></div><!--
  <title>Configuration Parameters</title>
--><div class="variablelist"><dl class="variablelist"><dt id="GUC-PGFDW-APPLICATION-NAME"><span class="term">
     <code class="varname">postgres_fdw.application_name</code> (<code class="type">string</code>)
     <a id="id-1.11.7.48.18.2.1.1.3" class="indexterm"></a>
    </span> <a href="#GUC-PGFDW-APPLICATION-NAME" class="id_link">#</a></dt><dd><p>
<!--
      Specifies a value for <xref linkend="guc-application-name"/>
      configuration parameter used when <filename>postgres_fdw</filename>
      establishes a connection to a foreign server.  This overrides
      <varname>application_name</varname> option of the server object.
      Note that change of this parameter doesn't affect any existing
      connections until they are re-established.
-->
<code class="filename">postgres_fdw</code>が外部サーバへの接続を確立する際に使用される<a class="xref" href="runtime-config-logging.html#GUC-APPLICATION-NAME">application_name</a>設定パラメータの値を指定します。
これにより、サーバオブジェクトの<code class="varname">application_name</code>オプションが上書きされます。
このパラメータを変更しても、再確立されるまで既存の接続には影響しません。
     </p><p>
<!--
      <varname>postgres_fdw.application_name</varname> can be any string
      of any length and contain even non-ASCII characters.  However when
      it's passed to and used as <varname>application_name</varname>
      in a foreign server, note that it will be truncated to less than
      <symbol>NAMEDATALEN</symbol> characters and anything other than
      printable ASCII characters will be replaced with question
      marks (<literal>?</literal>).
      See <xref linkend="guc-application-name"/> for details.
-->
<code class="varname">postgres_fdw.application_name</code>は任意の長さの文字列で、非ASCII文字も含むことさえできます。
しかし、外部サーバで<code class="varname">application_name</code>として渡されて使用される場合、<code class="symbol">NAMEDATALEN</code>文字未満に切り捨てられ、印字可能なASCII文字以外の文字は疑問符(<code class="literal">?</code>)に置き換えられることに注意してください。
詳細は<a class="xref" href="runtime-config-logging.html#GUC-APPLICATION-NAME">application_name</a>を参照してください。
     </p><p>
<!--
      <literal>%</literal> characters begin <quote>escape sequences</quote>
      that are replaced with status information as outlined below.
      Unrecognized escapes are ignored. Other characters are copied straight
      to the application name. Note that it's not allowed to specify a
      plus/minus sign or a numeric literal after the <literal>%</literal>
      and before the option, for alignment and padding.
-->
<code class="literal">%</code>文字は<span class="quote">「<span class="quote">エスケープシーケンス</span>」</span>を開始し、以下で説明するようにステータス情報に置き換えられます。
認識されないエスケープは無視されます。
他の文字はアプリケーション名に直接コピーされます。
位置合わせとパディングのために、<code class="literal">%</code>の後とオプションの前にプラス/マイナス記号または数値リテラルを指定することはできないことに注意してください。
     </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>エスケープ</th><th>効果</th></tr></thead><tbody><tr><td><code class="literal">%a</code></td><td>ローカルサーバ上のアプリケーション名</td></tr><tr><td><code class="literal">%c</code></td><td>
<!--
          Session ID on local server
          (see <xref linkend="guc-log-line-prefix"/> for details)
-->
ローカルサーバ上のセッションID（詳細は<a class="xref" href="runtime-config-logging.html#GUC-LOG-LINE-PREFIX">log_line_prefix</a>を参照）
         </td></tr><tr><td><code class="literal">%C</code></td><td>
<!--
          Cluster name on local server
          (see <xref linkend="guc-cluster-name"/> for details)
-->
ローカルサーバ上のクラスタ名（詳細は<a class="xref" href="runtime-config-logging.html#GUC-CLUSTER-NAME">cluster_name</a>を参照）
         </td></tr><tr><td><code class="literal">%u</code></td><td>ローカルサーバ上のユーザ名</td></tr><tr><td><code class="literal">%d</code></td><td>ローカルサーバ上のデータベース名</td></tr><tr><td><code class="literal">%p</code></td><td>ローカルサーバ上のバックエンドのプロセスID</td></tr><tr><td><code class="literal">%%</code></td><td>文字 %</td></tr></tbody></table></div><p>
<!--
      For example, suppose user <literal>local_user</literal> establishes
      a connection from database <literal>local_db</literal> to
      <literal>foreign_db</literal> as user <literal>foreign_user</literal>,
      the setting <literal>'db=%d, user=%u'</literal> is replaced with
      <literal>'db=local_db, user=local_user'</literal>.
-->
たとえば、ユーザー<code class="literal">local_user</code>がデータベース<code class="literal">local_db</code>から<code class="literal">foreign_db</code>への接続をユーザー<code class="literal">foreign_user</code>として確立するとします。
設定<code class="literal">'db=%d,user=%u'</code>は<code class="literal">'db=local_db,user=local_user'</code>に置き換えられます。
     </p></dd></dl></div></div><div class="sect2" id="POSTGRES-FDW-EXAMPLES"><div class="titlepage"><div><div><h3 class="title">F.38.9. 例 <a href="#POSTGRES-FDW-EXAMPLES" class="id_link">#</a></h3></div></div></div><!--
  <title>Examples</title>
--><p>
<!--
   Here is an example of creating a foreign table with
   <literal>postgres_fdw</literal>. First install the extension:
-->
これは<code class="literal">postgres_fdw</code>で外部テーブルを作成する例です。
まず、拡張をインストールします。
  </p><pre class="programlisting">
CREATE EXTENSION postgres_fdw;
</pre><p>
<!--
   Then create a foreign server using <xref linkend="sql-createserver"/>.
   In this example we wish to connect to a <productname>PostgreSQL</productname> server
   on host <literal>192.83.123.89</literal> listening on
   port <literal>5432</literal>.  The database to which the connection is made
   is named <literal>foreign_db</literal> on the remote server:
-->
次に、<a class="xref" href="sql-createserver.html" title="CREATE SERVER"><span class="refentrytitle">CREATE SERVER</span></a>を使って外部サーバを作成します。
この例では、ホスト<code class="literal">192.83.123.89</code>でポート<code class="literal">5432</code>を監視している<span class="productname">PostgreSQL</span>サーバに接続します。
接続されるデータベースはリモートサーバ上で<code class="literal">foreign_db</code>という名前です。

</p><pre class="programlisting">
CREATE SERVER foreign_server
        FOREIGN DATA WRAPPER postgres_fdw
        OPTIONS (host '192.83.123.89', port '5432', dbname 'foreign_db');
</pre><p>
  </p><p>
<!--
   A user mapping, defined with <xref linkend="sql-createusermapping"/>, is
   needed as well to identify the role that will be used on the remote
   server:
-->
リモートサーバで使われるロールを特定するためにユーザマッピングも必要です。ユーザマッピングは<a class="xref" href="sql-createusermapping.html" title="CREATE USER MAPPING"><span class="refentrytitle">CREATE USER MAPPING</span></a>で定義されます。

</p><pre class="programlisting">
CREATE USER MAPPING FOR local_user
        SERVER foreign_server
        OPTIONS (user 'foreign_user', password 'password');
</pre><p>
  </p><p>
<!--
   Now it is possible to create a foreign table with
   <xref linkend="sql-createforeigntable"/>.  In this example we
   wish to access the table named <structname>some_schema.some_table</structname>
   on the remote server.  The local name for it will
   be <structname>foreign_table</structname>:
-->
これで<a class="xref" href="sql-createforeigntable.html" title="CREATE FOREIGN TABLE"><span class="refentrytitle">CREATE FOREIGN TABLE</span></a>により外部テーブルが作成できるようになりました。
この例では、リモートサーバの<code class="structname">some_schema.some_table</code>という名前のテーブルにアクセスします。
対応するローカルの名前は<code class="structname">foreign_table</code>です。

</p><pre class="programlisting">
CREATE FOREIGN TABLE foreign_table (
        id integer NOT NULL,
        data text
)
        SERVER foreign_server
        OPTIONS (schema_name 'some_schema', table_name 'some_table');
</pre><p>

<!--
   It's essential that the data types and other properties of the columns
   declared in <command>CREATE FOREIGN TABLE</command> match the actual remote table.
   Column names must match as well, unless you attach <literal>column_name</literal>
   options to the individual columns to show how they are named in the remote
   table.
   In many cases, use of <link linkend="sql-importforeignschema"><command>IMPORT FOREIGN SCHEMA</command></link> is
   preferable to constructing foreign table definitions manually.
-->
<code class="command">CREATE FOREIGN TABLE</code>で宣言した列のデータ型やその他の属性は、実際のリモートテーブルと一致していることが必須です。
リモートテーブルでどのような名前なのかを個々の列に対して<code class="literal">column_name</code>オプションで指定しない限り、列名も一致していなければなりません。
多くの場合、外部テーブルの定義を手作業で作成するよりも、<a class="link" href="sql-importforeignschema.html" title="IMPORT FOREIGN SCHEMA"><code class="command">IMPORT FOREIGN SCHEMA</code></a>を使用する方が望ましいです。
  </p></div><div class="sect2" id="POSTGRES-FDW-AUTHOR"><div class="titlepage"><div><div><h3 class="title">F.38.10. 作者 <a href="#POSTGRES-FDW-AUTHOR" class="id_link">#</a></h3></div></div></div><!--
  <title>Author</title>
--><p>
<!--
   Shigeru Hanada <email>shigeru.hanada@gmail.com</email>
-->
花田 茂 <code class="email">&lt;<a class="email" href="mailto:shigeru.hanada@gmail.com">shigeru.hanada@gmail.com</a>&gt;</code>
  </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="pgwalinspect.html" title="F.37. pg_walinspect — low-level WAL inspection">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="contrib.html" title="付録F 追加で提供されるモジュールと拡張">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="seg.html" title="F.39. seg — 線分または浮動小数点区間のためのデータ型">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">F.37. pg_walinspect — low-level WAL inspection </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 16.0文書">ホーム</a></td><td width="40%" align="right" valign="top"> F.39. seg — 線分または浮動小数点区間のためのデータ型</td></tr></table></div></body></html>