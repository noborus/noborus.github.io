<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>F.32. pg_stat_statements — SQL文のプラン生成時と実行時の統計情報を記録する</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="pgrowlocks.html" title="F.31. pgrowlocks — テーブルの行ロックの情報を示す" /><link rel="next" href="pgstattuple.html" title="F.33. pgstattuple — タプルレベルの統計情報を入手する" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="4" align="center"><a accesskey="h" href="index.html">PostgreSQL 16.0文書</a></th></tr><tr><td width="10%" align="left"></td><td width="10%" align="left"></td><td width="60%" align="center"><a href="contrib.html" title="付録F 追加で提供されるモジュールと拡張">付録F 追加で提供されるモジュールと拡張</a></td><td width="20%" align="right"></td></tr><tr><td width="10%" align="left"><a accesskey="p" href="pgrowlocks.html" title="F.31. pgrowlocks — テーブルの行ロックの情報を示す">前へ</a> </td><td width="10%" align="left"><a accesskey="u" href="contrib.html" title="付録F 追加で提供されるモジュールと拡張">上へ</a></td><td width="60%" align="center">F.32. pg_stat_statements — SQL文のプラン生成時と実行時の統計情報を記録する</td><td width="20%" align="right"> <a accesskey="n" href="pgstattuple.html" title="F.33. pgstattuple — タプルレベルの統計情報を入手する">次へ</a></td></tr></table><hr /></div><div class="sect1" id="PGSTATSTATEMENTS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.32. pg_stat_statements — SQL文のプラン生成時と実行時の統計情報を記録する <a href="#PGSTATSTATEMENTS" class="id_link">#</a></h2></div></div></div><!--
 <title>pg_stat_statements &mdash; track statistics of SQL planning and execution</title>
--><a id="id-1.11.7.42.2" class="indexterm"></a><p>
<!--
  The <filename>pg_stat_statements</filename> module provides a means for
  tracking planning and execution statistics of all SQL statements executed by
  a server.
-->
<code class="filename">pg_stat_statements</code>モジュールは、サーバで実行されたすべてのSQL文のプラン生成時と実行時の統計情報を記録する手段を提供します。
 </p><p>
<!--
  The module must be loaded by adding <literal>pg_stat_statements</literal> to
  <xref linkend="guc-shared-preload-libraries"/> in
  <filename>postgresql.conf</filename>, because it requires additional shared memory.
  This means that a server restart is needed to add or remove the module.
  In addition, query identifier calculation must be enabled in order for the
  module to be active, which is done automatically if <xref linkend="guc-compute-query-id"/>
  is set to <literal>auto</literal> or <literal>on</literal>, or any third-party
  module that calculates query identifiers is loaded.
-->
このモジュールは追加の共有メモリを必要とするため、<code class="filename">postgresql.conf</code>の<a class="xref" href="runtime-config-client.html#GUC-SHARED-PRELOAD-LIBRARIES">shared_preload_libraries</a>に<code class="literal">pg_stat_statements</code>を追加してモジュールをロードしなければなりません。
このことは、このモジュールを追加もしくは削除するには、サーバを再起動する必要があるということを意味しています。
さらに、モジュールをアクティブにするには、問い合わせIDの計算を有効にする必要があります。これは<a class="xref" href="runtime-config-statistics.html#GUC-COMPUTE-QUERY-ID">compute_query_id</a>パラメータが<code class="literal">auto</code>か<code class="literal">on</code>に設定されているか、問い合わせIDを計算するサードパーティのモジュールがロードされている場合に自動的に実行されます。
 </p><p>
<!--
   When <filename>pg_stat_statements</filename> is active, it tracks
   statistics across all databases of the server.  To access and manipulate
   these statistics, the module provides views
   <structname>pg_stat_statements</structname> and
   <structname>pg_stat_statements_info</structname>,
   and the utility functions <function>pg_stat_statements_reset</function> and
   <function>pg_stat_statements</function>.  These are not available globally but
   can be enabled for a specific database with
   <command>CREATE EXTENSION pg_stat_statements</command>.
-->
<code class="filename">pg_stat_statements</code>はアクティブになると、サーバのデータベース全体に渡って統計情報を記録します。
この統計情報にアクセスしたり操作したりするために、このモジュールはビュー<code class="structname">pg_stat_statements</code>と<code class="structname">pg_stat_statements_info</code>とユーティリティ関数<code class="function">pg_stat_statements_reset</code>、<code class="function">pg_stat_statements</code>を提供します。
これらは大域的に利用可能ではなく、<code class="command">CREATE EXTENSION pg_stat_statements</code>で特定のデータベースで可能になります。
 </p><div class="sect2" id="PGSTATSTATEMENTS-PG-STAT-STATEMENTS"><div class="titlepage"><div><div><h3 class="title">F.32.1. <code class="structname">pg_stat_statements</code> ビュー <a href="#PGSTATSTATEMENTS-PG-STAT-STATEMENTS" class="id_link">#</a></h3></div></div></div><!--
  <title>The <structname>pg_stat_statements</structname> View</title>
--><p>
<!--
   The statistics gathered by the module are made available via a
   view named <structname>pg_stat_statements</structname>.  This view
   contains one row for each distinct combination of database ID, user
   ID, query ID and whether it's a top-level statement or not (up to
   the maximum number of distinct statements that the module can track).
   The columns of the view are shown in
   <xref linkend="pgstatstatements-columns"/>.
-->
このモジュールによって収集された統計情報は、<code class="structname">pg_stat_statements</code>というビューを通して利用することができます。
このビューは、1行に対して、それぞれ個々のデータベースID、ユーザID、問い合わせID、および最上位レベルの文かどうかの組み合わせを含んでいます（モジュールが記録できるSQL文の最大数まで）。
ビューの列は、<a class="xref" href="pgstatstatements.html#PGSTATSTATEMENTS-COLUMNS" title="表F.22 pg_stat_statementsの列">表 F.22</a>に示す通りです。
  </p><div class="table" id="PGSTATSTATEMENTS-COLUMNS"><p class="title"><strong>表F.22 <code class="structname">pg_stat_statements</code>の列</strong></p><div class="table-contents"><!--
   <title><structname>pg_stat_statements</structname> Columns</title>
--><table class="table" summary="pg_stat_statementsの列" border="1"><colgroup><col /></colgroup><thead><tr><th class="catalog_table_entry"><p class="column_definition">
<!--
       Column Type
-->
列 型
      </p>
      <p>
<!--
       Description
-->
説明
      </p></th></tr></thead><tbody><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">userid</code> <code class="type">oid</code>
<!--
       (references <link linkend="catalog-pg-authid"><structname>pg_authid</structname></link>.<structfield>oid</structfield>)
-->
（参照先 <a class="link" href="catalog-pg-authid.html" title="53.8. pg_authid"><code class="structname">pg_authid</code></a>.<code class="structfield">oid</code>）
      </p>
      <p>
<!--
       OID of user who executed the statement
-->
SQL文を実行したユーザのOID
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">dbid</code> <code class="type">oid</code>
<!--
       (references <link linkend="catalog-pg-database"><structname>pg_database</structname></link>.<structfield>oid</structfield>)
-->
（参照先 <a class="link" href="catalog-pg-database.html" title="53.15. pg_database"><code class="structname">pg_database</code></a>.<code class="structfield">oid</code>）
      </p>
      <p>
<!--
       OID of database in which the statement was executed
-->
SQL文が実行されたデータベースのOID
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">toplevel</code> <code class="type">bool</code>
      </p>
      <p>
<!--
       True if the query was executed as a top-level statement
       (always true if <varname>pg_stat_statements.track</varname> is set to
       <literal>top</literal>)
-->
問い合わせが最上位レベルのSQL文として実行された時は真
（<code class="varname">pg_stat_statements.track</code>が<code class="literal">top</code>に設定されている場合は常に真）
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">queryid</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Hash code to identify identical normalized queries.
-->
同一の正規化された問い合わせを識別するためのハッシュコード
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">query</code> <code class="type">text</code>
      </p>
      <p>
<!--
       Text of a representative statement
-->
代表的なSQL文の文字列
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">plans</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Number of times the statement was planned
       (if <varname>pg_stat_statements.track_planning</varname> is enabled,
       otherwise zero)
-->
SQL文がプラン生成された回数
（<code class="varname">pg_stat_statements.track_planning</code>が有効な場合。無効であればゼロ）
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">total_plan_time</code> <code class="type">double precision</code>
      </p>
      <p>
<!--
       Total time spent planning the statement, in milliseconds
       (if <varname>pg_stat_statements.track_planning</varname> is enabled,
       otherwise zero)
-->
SQL文のプラン生成に費やした総時間（ミリ秒単位）
（<code class="varname">pg_stat_statements.track_planning</code>が有効な場合。無効であればゼロ）
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">min_plan_time</code> <code class="type">double precision</code>
      </p>
      <p>
<!--
       Minimum time spent planning the statement, in milliseconds
       (if <varname>pg_stat_statements.track_planning</varname> is enabled,
       otherwise zero)
-->
SQL文のプラン生成に費やした最小時間（ミリ秒単位）
（<code class="varname">pg_stat_statements.track_planning</code>が有効な場合。無効であればゼロ）
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">max_plan_time</code> <code class="type">double precision</code>
      </p>
      <p>
<!--
       Maximum time spent planning the statement, in milliseconds
       (if <varname>pg_stat_statements.track_planning</varname> is enabled,
       otherwise zero)
-->
SQL文のプラン生成に費やした最大時間（ミリ秒単位）
（<code class="varname">pg_stat_statements.track_planning</code>が有効な場合。無効であればゼロ）
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">mean_plan_time</code> <code class="type">double precision</code>
      </p>
      <p>
<!--
       Mean time spent planning the statement, in milliseconds
       (if <varname>pg_stat_statements.track_planning</varname> is enabled,
       otherwise zero)
-->
SQL文のプラン生成に費やした平均時間（ミリ秒単位）
（<code class="varname">pg_stat_statements.track_planning</code>が有効な場合。無効であればゼロ）
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">stddev_plan_time</code> <code class="type">double precision</code>
      </p>
      <p>
<!--
       Population standard deviation of time spent planning the statement,
       in milliseconds
       (if <varname>pg_stat_statements.track_planning</varname> is enabled,
       otherwise zero)
-->
SQL文のプラン生成に費やした時間の母標準偏差（ミリ秒単位）
（<code class="varname">pg_stat_statements.track_planning</code>が有効な場合。無効であればゼロ）
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">calls</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Number of times the statement was executed
-->
SQL文が実行された回数
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">total_exec_time</code> <code class="type">double precision</code>
      </p>
      <p>
<!--
       Total time spent executing the statement, in milliseconds
-->
SQL文の実行に費やした総時間（ミリ秒単位）
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">min_exec_time</code> <code class="type">double precision</code>
      </p>
      <p>
<!--
       Minimum time spent executing the statement, in milliseconds
-->
SQL文の実行に費やした最小時間（ミリ秒単位）
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">max_exec_time</code> <code class="type">double precision</code>
      </p>
      <p>
<!--
       Maximum time spent executing the statement, in milliseconds
-->
SQL文の実行に費やした最大時間（ミリ秒単位）
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">mean_exec_time</code> <code class="type">double precision</code>
      </p>
      <p>
<!--
       Mean time spent executing the statement, in milliseconds
-->
SQL文の実行に費やした平均時間（ミリ秒単位）
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">stddev_exec_time</code> <code class="type">double precision</code>
      </p>
      <p>
<!--
       Population standard deviation of time spent executing the statement, in milliseconds
-->
SQL文の実行に費やした時間の母標準偏差（ミリ秒単位）
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">rows</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Total number of rows retrieved or affected by the statement
-->
SQL文によって取得された、あるいは影響を受けた行の総数
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">shared_blks_hit</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Total number of shared block cache hits by the statement
-->
SQL文によってヒットした共有ブロックキャッシュの総数
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">shared_blks_read</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Total number of shared blocks read by the statement
-->
SQL文によって読み込まれた共有ブロックの総数
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">shared_blks_dirtied</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Total number of shared blocks dirtied by the statement
-->
SQL文によってダーティ状態となった共有ブロックの総数
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">shared_blks_written</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Total number of shared blocks written by the statement
-->
SQL文によって書き込まれた共有ブロックの総数
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">local_blks_hit</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Total number of local block cache hits by the statement
-->
SQL文によってヒットしたローカルブロックキャッシュの総数
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">local_blks_read</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Total number of local blocks read by the statement
-->
SQL文によって読み込まれたローカルブロックの総数
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">local_blks_dirtied</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Total number of local blocks dirtied by the statement
-->
SQL文によってダーティ状態となったローカルブロックの総数
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">local_blks_written</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Total number of local blocks written by the statement
-->
SQL文によって書き込まれたローカルブロックの総数
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">temp_blks_read</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Total number of temp blocks read by the statement
-->
SQL文によって読み込まれた一時ブロックの総数
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">temp_blks_written</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Total number of temp blocks written by the statement
-->
SQL文によって書き込まれた一時ブロックの総数
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">blk_read_time</code> <code class="type">double precision</code>
      </p>
      <p>
<!--
       Total time the statement spent reading data file blocks, in milliseconds
       (if <xref linkend="guc-track-io-timing"/> is enabled, otherwise zero)
-->
SQL文がデータファイルブロックの読み取りに費やした総時間（ミリ秒単位）
（<a class="xref" href="runtime-config-statistics.html#GUC-TRACK-IO-TIMING">track_io_timing</a>が有効な場合。無効であればゼロ）
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">blk_write_time</code> <code class="type">double precision</code>
      </p>
      <p>
<!--
       Total time the statement spent writing data file blocks, in milliseconds
       (if <xref linkend="guc-track-io-timing"/> is enabled, otherwise zero)
-->
SQL文がデータファイルブロックの書き出しに費やした総時間（ミリ秒単位）
（<a class="xref" href="runtime-config-statistics.html#GUC-TRACK-IO-TIMING">track_io_timing</a>が有効な場合。無効であればゼロ）
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">temp_blk_read_time</code> <code class="type">double precision</code>
      </p>
      <p>
<!--
       Total time the statement spent reading temporary file blocks, in
       milliseconds (if <xref linkend="guc-track-io-timing"/> is enabled,
       otherwise zero)
-->
SQL文が一時ファイルブロックの読み取りに費やした総時間（ミリ秒単位）
（<a class="xref" href="runtime-config-statistics.html#GUC-TRACK-IO-TIMING">track_io_timing</a>が有効な場合。無効であればゼロ）
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">temp_blk_write_time</code> <code class="type">double precision</code>
      </p>
      <p>
<!--
       Total time the statement spent writing temporary file blocks, in
       milliseconds (if <xref linkend="guc-track-io-timing"/> is enabled,
       otherwise zero)
-->
SQL文が一時ファイルブロックの書き出しに費やした総時間（ミリ秒単位）
（<a class="xref" href="runtime-config-statistics.html#GUC-TRACK-IO-TIMING">track_io_timing</a>が有効な場合。無効であればゼロ）
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">wal_records</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Total number of WAL records generated by the statement
-->
SQL文により生成されたWALレコードの総数
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">wal_fpi</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Total number of WAL full page images generated by the statement
-->
SQL文により生成されたWALフルページイメージの総数
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">wal_bytes</code> <code class="type">numeric</code>
      </p>
      <p>
<!--
       Total amount of WAL generated by the statement in bytes
-->
SQL文により生成されたバイト単位のWAL総量
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">jit_functions</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Total number of functions JIT-compiled by the statement
-->
SQL文がJITコンパイルされた関数の総数
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">jit_generation_time</code> <code class="type">double precision</code>
      </p>
      <p>
<!--
       Total time spent by the statement on generating JIT code, in milliseconds
-->
SQL文のJITコードの生成に費やした総時間（ミリ秒単位）
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">jit_inlining_count</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Number of times functions have been inlined
-->
関数がインライン化された回数
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">jit_inlining_time</code> <code class="type">double precision</code>
      </p>
      <p>
<!--
       Total time spent by the statement on inlining functions, in milliseconds
-->
SQL文が関数のインライン化に費やした総時間（ミリ秒単位）
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">jit_optimization_count</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Number of times the statement has been optimized
-->
SQL文が最適化された回数
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">jit_optimization_time</code> <code class="type">double precision</code>
      </p>
      <p>
<!--
       Total time spent by the statement on optimizing, in milliseconds
-->
SQL文の最適化に費やした総時間（ミリ秒単位）
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">jit_emission_count</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Number of times code has been emitted
-->
コードが出力された回数
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">jit_emission_time</code> <code class="type">double precision</code>
      </p>
      <p>
<!--
       Total time spent by the statement on emitting code, in milliseconds
-->
SQL文のコードを出力するのに費やした総時間（ミリ秒単位）
      </p></td></tr></tbody></table></div></div><br class="table-break" /><p>
<!--
   For security reasons, only superusers and roles with privileges of the
   <literal>pg_read_all_stats</literal> role are allowed to see the SQL text and
   <structfield>queryid</structfield> of queries executed by other users.
   Other users can see the statistics, however, if the view has been installed
   in their database.
-->
セキュリティ上の理由から、スーパーユーザと<code class="literal">pg_read_all_stats</code>ロールの権限を持つメンバだけが、他のユーザによって実行されたSQLテキストや問い合わせの<code class="structfield">queryid</code>を見ることができます。
ただし、ユーザのデータベースにビューがインストールされている場合、統計情報については他のユーザから見ることができます。
  </p><p>
<!--
   Plannable queries (that is, <command>SELECT</command>, <command>INSERT</command>,
   <command>UPDATE</command>, <command>DELETE</command>, and <command>MERGE</command>)
   and utility commands are combined into a single
   <structname>pg_stat_statements</structname> entry whenever they have identical query
   structures according to an internal hash calculation.  Typically, two
   queries will be considered the same for this purpose if they are
   semantically equivalent except for the values of literal constants
   appearing in the query.
-->
計画作成が可能な問い合わせ（つまり<code class="command">SELECT</code>、<code class="command">INSERT</code>、<code class="command">UPDATE</code>、<code class="command">DELETE</code>、 <code class="command">MERGE</code>）とユーティリティコマンドは、内部のハッシュ計算に従った、同一の問い合わせ構造を持つ限り、１つの<code class="structname">pg_stat_statements</code>項目に組み合わせられます。
典型的には、２つの問い合わせは、問い合わせの中に現れるリテラル定数の値以外、意味的に等価である場合、この目的では同一とみなされます。
  </p><div class="note"><h3 class="title">注記</h3><p>
<!--
    The following details about constant replacement and
    <structfield>queryid</structfield> only apply when <xref
    linkend="guc-compute-query-id"/> is enabled.  If you use an external
    module instead to compute <structfield>queryid</structfield>, you
    should refer to its documentation for details.
-->
定数置換と<code class="structfield">queryid</code>に関する以下の詳細は、<a class="xref" href="runtime-config-statistics.html#GUC-COMPUTE-QUERY-ID">compute_query_id</a>が有効な場合のみ適用されます。
<code class="structfield">queryid</code>の計算に外部モジュールを使用する場合、詳細はその外部モジュールのドキュメントを参照する必要があります。
   </p></div><p>
<!--
   When a constant's value has been ignored for purposes of matching the query
   to other queries, the constant is replaced by a parameter symbol, such
   as <literal>$1</literal>, in the <structname>pg_stat_statements</structname>
   display.
   The rest of the query text is that of the first query that had the
   particular <structfield>queryid</structfield> hash value associated with the
   <structname>pg_stat_statements</structname> entry.
-->
他の問い合わせと合致させるために定数値が無視された場合、<code class="structname">pg_stat_statements</code>の表示の中で定数は<code class="literal">$1</code>のようなパラメータ記号に置換されます。
問い合わせの残りのテキストは、<code class="structname">pg_stat_statements</code>項目に関連付いた特定の<code class="structfield">queryid</code>ハッシュ値を持つ、１つ目の問い合わせのテキストです。
  </p><p>
<!--
   Queries on which normalization can be applied may be observed with constant
   values in <structname>pg_stat_statements</structname>, especially when there
   is a high rate of entry deallocations. To reduce the likelihood of this
   happening, consider increasing <varname>pg_stat_statements.max</varname>.
   The <structname>pg_stat_statements_info</structname> view, discussed below
   in <xref linkend="pgstatstatements-pg-stat-statements-info"/>,
   provides statistics about entry deallocations.
-->
正規化が適用できる問い合わせは、<code class="structname">pg_stat_statements</code>内で一定の値で観察されるでしょう。 特に、エントリの割り当て解除率が高い場合にそうです。
このような事態の発生を減らすためには、<code class="varname">pg_stat_statements.max</code>を増やすことを検討してください。
<code class="structname">pg_stat_statements_info</code>ビューは、後述の<a class="xref" href="pgstatstatements.html#PGSTATSTATEMENTS-PG-STAT-STATEMENTS-INFO" title="F.32.2. pg_stat_statements_infoビュー">F.32.2</a>で説明しますが、エントリの割り当て解除に関する統計情報を提供します。
  </p><p>
<!--
   In some cases, queries with visibly different texts might get merged into a
   single <structname>pg_stat_statements</structname> entry.  Normally this will happen
   only for semantically equivalent queries, but there is a small chance of
   hash collisions causing unrelated queries to be merged into one entry.
   (This cannot happen for queries belonging to different users or databases,
   however.)
-->
一部の状況では、見た目上異なるテキストを持つ問い合わせが１つの<code class="structname">pg_stat_statements</code>項目にまとめられることがあります。
通常これは意味的に等しい問い合わせでのみ発生しますが、関連がない問い合わせが１つの項目にまとめられるハッシュ競合の可能性がわずかながら存在します。
（しかしこれは別のユーザまたは別のデータベースに属する問い合わせでは発生することはあり得ません。）
  </p><p>
<!--
   Since the <structfield>queryid</structfield> hash value is computed on the
   post-parse-analysis representation of the queries, the opposite is
   also possible: queries with identical texts might appear as
   separate entries, if they have different meanings as a result of
   factors such as different <varname>search_path</varname> settings.
-->
<code class="structfield">queryid</code>ハッシュ値は問い合わせの解析後の表現に対して計算されますので、<code class="varname">search_path</code>の設定が異なる等の要因の結果として異なる意味を持つ場合、同じテキストを持つ問い合わせが別の項目として現れるという、反対もまたあり得ます。
  </p><p>
<!--
   Consumers of <structname>pg_stat_statements</structname> may wish to use
   <structfield>queryid</structfield> (perhaps in combination with
   <structfield>dbid</structfield> and <structfield>userid</structfield>) as a more stable
   and reliable identifier for each entry than its query text.
   However, it is important to understand that there are only limited
   guarantees around the stability of the <structfield>queryid</structfield> hash
   value.  Since the identifier is derived from the
   post-parse-analysis tree, its value is a function of, among other
   things, the internal object identifiers appearing in this representation.
   This has some counterintuitive implications.  For example,
   <filename>pg_stat_statements</filename> will consider two apparently-identical
   queries to be distinct, if they reference a table that was dropped
   and recreated between the executions of the two queries.
   The hashing process is also sensitive to differences in
   machine architecture and other facets of the platform.
   Furthermore, it is not safe to assume that <structfield>queryid</structfield>
   will be stable across major versions of <productname>PostgreSQL</productname>.
-->
<code class="structname">pg_stat_statements</code>の消費者は、問い合わせテキストよりもより安定で信頼できる各項目への識別子として（おそらく<code class="structfield">dbid</code>や<code class="structfield">userid</code>と組み合わせて）<code class="structfield">queryid</code>を使いたいかもしれません。
しかし、<code class="structfield">queryid</code>ハッシュ値の安定性には限定された保証しかないのを理解することは重要です。
識別子は解析後の木から得られますので、その値は、とりわけ、この表現に現れる内部オブジェクト識別子の関数です。
これは少々直観に反する結果です。
例えば、<code class="filename">pg_stat_statements</code>は見たところは同一の問い合わせを、それらが2つの問い合わせの実行の間に削除され再作成されたテーブルを参照しているのであれば、別個のものとみなします。
ハッシュ処理はプラットフォームのマシンアーキテクチャやその他の面の違いにも敏感です。
その上、<span class="productname">PostgreSQL</span>のメジャーバージョンをまたがって<code class="structfield">queryid</code>が安定であるとみなすのは安全ではありません。
  </p><p>
<!--
   As a rule of thumb, <structfield>queryid</structfield> values can be assumed to be
   stable and comparable only so long as the underlying server version and
   catalog metadata details stay exactly the same.  Two servers
   participating in replication based on physical WAL replay can be expected
   to have identical <structfield>queryid</structfield> values for the same query.
   However, logical replication schemes do not promise to keep replicas
   identical in all relevant details, so <structfield>queryid</structfield> will
   not be a useful identifier for accumulating costs across a set of logical
   replicas.  If in doubt, direct testing is recommended.
-->
経験上、<code class="structfield">queryid</code>値は、基礎となるサーバのバージョンとカタログメタデータの詳細が全く同じである限り、安定していて比較可能とみなすことができます。
物理WAL再生に基づくレプリケーションに参加する2つのサーバでは、同じ問い合わせに対して同一の<code class="structfield">queryid</code>値を持つことが期待できます。
しかし、論理レプリケーションの仕組みは、レプリカが対応する詳細すべてで同一であることを約束しません。そのため、論理レプリカの集まりで増えるコストを識別するのに<code class="structfield">queryid</code>は有用ではありません。
疑わしければ、直接テストすることを薦めます。
  </p><p>
<!--
   The parameter symbols used to replace constants in
   representative query texts start from the next number after the
   highest <literal>$</literal><replaceable>n</replaceable> parameter in the original query
   text, or <literal>$1</literal> if there was none.  It's worth noting that in
   some cases there may be hidden parameter symbols that affect this
   numbering.  For example, <application>PL/pgSQL</application> uses hidden parameter
   symbols to insert values of function local variables into queries, so that
   a <application>PL/pgSQL</application> statement like <literal>SELECT i + 1 INTO j</literal>
   would have representative text like <literal>SELECT i + $2</literal>.
-->
代表的な問い合わせテキストの定数を置き換えるのに使われたパラメータ記号は、元の問い合わせテキストの最も大きな<code class="literal">$</code><em class="replaceable"><code>n</code></em>パラメータの次の数字から、もしそれがなければ<code class="literal">$1</code>から始まります。
ある場合には、この番号付けに影響する隠れたパラメータ記号があるかもしれないことに言及しておく価値はあります。
例えば、<span class="application">PL/pgSQL</span>は関数の局所変数の値を問い合わせに挿入するために隠れたパラメータ記号を使います。そのため、<code class="literal">SELECT i + 1 INTO j</code>のような<span class="application">PL/pgSQL</span>文は<code class="literal">SELECT i + $2</code>のような代表的なテキストになります。
  </p><p>
<!--
   The representative query texts are kept in an external disk file, and do
   not consume shared memory.  Therefore, even very lengthy query texts can
   be stored successfully.  However, if many long query texts are
   accumulated, the external file might grow unmanageably large.  As a
   recovery method if that happens, <filename>pg_stat_statements</filename> may
   choose to discard the query texts, whereupon all existing entries in
   the <structname>pg_stat_statements</structname> view will show
   null <structfield>query</structfield> fields, though the statistics associated with
   each <structfield>queryid</structfield> are preserved.  If this happens, consider
   reducing <varname>pg_stat_statements.max</varname> to prevent
   recurrences.
-->
代表的な問い合わせテキストは外部ディスクファイルに保持され、共有メモリを消費しません。
そのため、非常に長い問い合わせテキストであっても保存に成功します。
しかし、数多くの長い問い合わせテキストが蓄積されると、外部ファイルは手に負えないくらい大きくなるかもしれません。
もしそのようなことが起きれば、回復手法として、<code class="filename">pg_stat_statements</code>は問い合わせテキストを破棄することを選ぶでしょう。その結果、各<code class="structfield">queryid</code>に関連する統計は保存されるものの、<code class="structname">pg_stat_statements</code>ビュー内に存在するエントリはすべて<code class="structfield">query</code>フィールドがヌルになります。
もしこのようなことが起きたら、再発防止のため<code class="varname">pg_stat_statements.max</code>を減らすことを検討してください。
  </p><p>
<!--
   <structfield>plans</structfield> and <structfield>calls</structfield> aren't
   always expected to match because planning and execution statistics are
   updated at their respective end phase, and only for successful operations.
   For example, if a statement is successfully planned but fails during
   the execution phase, only its planning statistics will be updated.
   If planning is skipped because a cached plan is used, only its execution
   statistics will be updated.
-->
プラン生成時と実行時の統計情報はそれぞれの終了フェーズで更新され、操作に成功した場合にのみ更新されるため、<code class="structfield">plans</code>と<code class="structfield">calls</code>は常に一致するとは限りません。
例えば、SQL文のプラン生成に成功しても実行フェーズの間に失敗した場合、そのプラン生成時の統計情報のみが更新されます。
キャッシュされたプランが使用されプラン生成がスキップされた場合、実行時の統計情報のみが更新されます。
  </p></div><div class="sect2" id="PGSTATSTATEMENTS-PG-STAT-STATEMENTS-INFO"><div class="titlepage"><div><div><h3 class="title">F.32.2. <code class="structname">pg_stat_statements_info</code>ビュー <a href="#PGSTATSTATEMENTS-PG-STAT-STATEMENTS-INFO" class="id_link">#</a></h3></div></div></div><!--
  <title>The <structname>pg_stat_statements_info</structname> View</title>
--><a id="id-1.11.7.42.7.2" class="indexterm"></a><p>
<!--
   The statistics of the <filename>pg_stat_statements</filename> module
   itself are tracked and made available via a view named
   <structname>pg_stat_statements_info</structname>.  This view contains
   only a single row.  The columns of the view are shown in
   <xref linkend="pgstatstatementsinfo-columns"/>.
-->
<code class="filename">pg_stat_statements</code>モジュール自体の統計は記録され、<code class="structname">pg_stat_statements_info</code>というビューを通して利用することができます。
このビューは、1行のみが含まれます。
ビューの列は、<a class="xref" href="pgstatstatements.html#PGSTATSTATEMENTSINFO-COLUMNS" title="表F.23 pg_stat_statements_infoの列">表 F.23</a>に示す通りです。
  </p><div class="table" id="PGSTATSTATEMENTSINFO-COLUMNS"><p class="title"><strong>表F.23 <code class="structname">pg_stat_statements_info</code>の列</strong></p><div class="table-contents"><!--
   <title><structname>pg_stat_statements_info</structname> Columns</title>
--><table class="table" summary="pg_stat_statements_infoの列" border="1"><colgroup><col /></colgroup><thead><tr><th class="catalog_table_entry"><p class="column_definition">
<!--
       Column Type
-->
列 型
      </p>
      <p>
<!--
       Description
-->
説明
      </p></th></tr></thead><tbody><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">dealloc</code> <code class="type">bigint</code>
      </p>
      <p>
<!--
       Total number of times <structname>pg_stat_statements</structname>
       entries about the least-executed statements were deallocated
       because more distinct statements than
       <varname>pg_stat_statements.max</varname> were observed
-->
<code class="varname">pg_stat_statements.max</code>よりも多くの異なるSQL文が検出されたため、実行回数が最も少ないSQL文の<code class="structname">pg_stat_statements</code>エントリが割り当て解除された合計回数
      </p></td></tr><tr><td class="catalog_table_entry"><p class="column_definition">
       <code class="structfield">stats_reset</code> <code class="type">timestamp with time zone</code>
      </p>
      <p>
<!--
       Time at which all statistics in the
       <structname>pg_stat_statements</structname> view were last reset.
-->
<code class="structname">pg_stat_statements</code>ビューのすべての統計情報が最後にリセットされた時刻
      </p></td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2" id="PGSTATSTATEMENTS-FUNCS"><div class="titlepage"><div><div><h3 class="title">F.32.3. 関数 <a href="#PGSTATSTATEMENTS-FUNCS" class="id_link">#</a></h3></div></div></div><!--
  <title>Functions</title>
--><div class="variablelist"><dl class="variablelist"><dt><span class="term">
     <code class="function">pg_stat_statements_reset(userid Oid, dbid Oid, queryid bigint) returns void</code>
     <a id="id-1.11.7.42.8.2.1.1.2" class="indexterm"></a>
    </span></dt><dd><p>
<!--
      <function>pg_stat_statements_reset</function> discards statistics
      gathered so far by <filename>pg_stat_statements</filename> corresponding
      to the specified <structfield>userid</structfield>, <structfield>dbid</structfield>
      and <structfield>queryid</structfield>.  If any of the parameters are not
      specified, the default value <literal>0</literal>(invalid) is used for
      each of them and the statistics that match with other parameters will be
      reset.  If no parameter is specified or all the specified parameters are
      <literal>0</literal>(invalid), it will discard all statistics.
      If all statistics in the <filename>pg_stat_statements</filename>
      view are discarded, it will also reset the statistics in the
      <structname>pg_stat_statements_info</structname> view.
      By default, this function can only be executed by superusers.
      Access may be granted to others using <command>GRANT</command>.
-->
<code class="function">pg_stat_statements_reset</code>は指定された<code class="structfield">userid</code>、<code class="structfield">dbid</code>、<code class="structfield">queryid</code>に対応する<code class="filename">pg_stat_statements</code>によってこれまでに収集したすべての統計情報を削除します。
いずれかのパラメータを指定しないのであれば、デフォルト値<code class="literal">0</code>（無効）を使ってください。他のパラメータに一致する統計情報がリセットされます。
どのパラメータも指定しない、または、すべての指定されたパラメータが<code class="literal">0</code>（無効）ならば、すべての統計情報を削除します。
<code class="filename">pg_stat_statements</code>ビューのすべての統計情報が破棄された場合、<code class="structname">pg_stat_statements_info</code>ビューの統計情報もリセットされます。
デフォルトでは、この関数はスーパーユーザのみ実行できます。
<code class="command">GRANT</code>を使ってアクセス権を他のユーザに付与できます。
     </p></dd><dt><span class="term">
     <code class="function">pg_stat_statements(showtext boolean) returns setof record</code>
     <a id="id-1.11.7.42.8.2.2.1.2" class="indexterm"></a>
     <a id="id-1.11.7.42.8.2.2.1.3" class="indexterm"></a>
    </span></dt><dd><p>
<!--
      The <structname>pg_stat_statements</structname> view is defined in
      terms of a function also named <function>pg_stat_statements</function>.
      It is possible for clients to call
      the <function>pg_stat_statements</function> function directly, and by
      specifying <literal>showtext := false</literal> have query text be
      omitted (that is, the <literal>OUT</literal> argument that corresponds
      to the view's <structfield>query</structfield> column will return nulls).  This
      feature is intended to support external tools that might wish to avoid
      the overhead of repeatedly retrieving query texts of indeterminate
      length.  Such tools can instead cache the first query text observed
      for each entry themselves, since that is
      all <filename>pg_stat_statements</filename> itself does, and then retrieve
      query texts only as needed.  Since the server stores query texts in a
      file, this approach may reduce physical I/O for repeated examination
      of the <structname>pg_stat_statements</structname> data.
-->
<code class="structname">pg_stat_statements</code>ビューは同じく<code class="function">pg_stat_statements</code>という名前の関数の項で定義されています。
クライアントが<code class="function">pg_stat_statements</code>関数を直接呼び出し、<code class="literal">showtext := false</code>と指定することで問い合わせテキストを省略することが可能です（すなわち、ビューの<code class="structfield">query</code>列に対応する<code class="literal">OUT</code>引数はNULLを返します）。
この機能は不定長の問い合わせテキストを繰り返し取得するオーバーヘッドを避けたいと考える外部のツールをサポートすることを意図したものです。
そのようなツールは代わりに、それが<code class="filename">pg_stat_statements</code>自身が行なっていることのすべてですので、各項目で最初に観察された問い合わせテキストをキャッシュし、必要とされる問い合わせテキストのみを取得できます。
サーバは問い合わせテキストをファイルに格納しますので、この方法は<code class="structname">pg_stat_statements</code>データの繰り返しの検査に対する物理I/Oを減らすでしょう。
     </p></dd></dl></div></div><div class="sect2" id="PGSTATSTATEMENTS-CONFIG-PARAMS"><div class="titlepage"><div><div><h3 class="title">F.32.4. 設定パラメータ <a href="#PGSTATSTATEMENTS-CONFIG-PARAMS" class="id_link">#</a></h3></div></div></div><!--
  <title>Configuration Parameters</title>
--><div class="variablelist"><dl class="variablelist"><dt><span class="term">
     <code class="varname">pg_stat_statements.max</code> (<code class="type">integer</code>)
     <a id="id-1.11.7.42.9.2.1.1.3" class="indexterm"></a>
     <a id="id-1.11.7.42.9.2.1.1.4" class="indexterm"></a>
    </span></dt><dd><p>
<!--
      <varname>pg_stat_statements.max</varname> is the maximum number of
      statements tracked by the module (i.e., the maximum number of rows
      in the <structname>pg_stat_statements</structname> view).  If more distinct
      statements than that are observed, information about the least-executed
      statements is discarded.  The number of times such information was
      discarded can be seen in the
      <structname>pg_stat_statements_info</structname> view.
      The default value is 5000.
      This parameter can only be set at server start.
-->
<code class="varname">pg_stat_statements.max</code>は、このモジュールによって記録されるSQL文の最大数（すなわち、<code class="structname">pg_stat_statements</code>ビューにおける行の最大数）です。
これを超えて異なるSQL文を検出した場合は、最も実行回数の低いSQL文の情報が捨てられます。
このような情報が破棄された回数は、<code class="structname">pg_stat_statements_info</code>ビューで確認できます。
デフォルトは5000です。
このパラメータはサーバの起動時にのみ指定できます。
     </p></dd><dt><span class="term">
     <code class="varname">pg_stat_statements.track</code> (<code class="type">enum</code>)
     <a id="id-1.11.7.42.9.2.2.1.3" class="indexterm"></a>
     <a id="id-1.11.7.42.9.2.2.1.4" class="indexterm"></a>
    </span></dt><dd><p>
<!--
      <varname>pg_stat_statements.track</varname> controls which statements
      are counted by the module.
      Specify <literal>top</literal> to track top-level statements (those issued
      directly by clients), <literal>all</literal> to also track nested statements
      (such as statements invoked within functions), or <literal>none</literal> to
      disable statement statistics collection.
      The default value is <literal>top</literal>.
      Only superusers can change this setting.
-->
<code class="varname">pg_stat_statements.track</code>は、どのSQL文をモジュールによって計測するかを制御します。
<code class="literal">top</code>を指定した場合は（直接クライアントによって発行された）最上層のSQL文を記録します。
<code class="literal">all</code>は（関数の中から呼び出された文などの）入れ子になった文も記録します。
<code class="literal">none</code>は文に関する統計情報収集を無効にします。
デフォルトは<code class="literal">top</code>です。
この設定はスーパーユーザだけが変更できます。
     </p></dd><dt><span class="term">
     <code class="varname">pg_stat_statements.track_utility</code> (<code class="type">boolean</code>)
     <a id="id-1.11.7.42.9.2.3.1.3" class="indexterm"></a>
     <a id="id-1.11.7.42.9.2.3.1.4" class="indexterm"></a>
    </span></dt><dd><p>
<!--
      <varname>pg_stat_statements.track_utility</varname> controls whether
      utility commands are tracked by the module.  Utility commands are
      all those other than <command>SELECT</command>, <command>INSERT</command>,
      <command>UPDATE</command>, <command>DELETE</command>, and <command>MERGE</command>.
      The default value is <literal>on</literal>.
      Only superusers can change this setting.
-->
<code class="varname">pg_stat_statements.track_utility</code>は、このモジュールがユーティリティコマンドを記録するかどうかを指定します。
ユーティリティコマンドとは、 <code class="command">SELECT</code>、<code class="command">INSERT</code>、<code class="command">UPDATE</code>、<code class="command">DELETE</code>、および<code class="command">MERGE</code>以外のすべてです。
デフォルトは<code class="literal">on</code>です。
この設定はスーパーユーザのみが変更できます。
     </p></dd><dt><span class="term">
     <code class="varname">pg_stat_statements.track_planning</code> (<code class="type">boolean</code>)
     <a id="id-1.11.7.42.9.2.4.1.3" class="indexterm"></a>
     <a id="id-1.11.7.42.9.2.4.1.4" class="indexterm"></a>
    </span></dt><dd><p>
<!--
      <varname>pg_stat_statements.track_planning</varname> controls whether
      planning operations and duration are tracked by the module.
      Enabling this parameter may incur a noticeable performance penalty,
      especially when statements with identical query structure are executed
      by many concurrent connections which compete to update a small number of
      <structname>pg_stat_statements</structname> entries.
      The default value is <literal>off</literal>.
      Only superusers can change this setting.
-->
<code class="varname">pg_stat_statements.track_planning</code>は、このモジュールがプラン生成の操作と時間を記録するかどうかを指定します。
このパラメータを有効にすると、特に同一の問い合わせ構造を持つSQL文が、少数の<code class="structname">pg_stat_statements</code>エントリ更新のために競合する多数の同時接続によって実行される場合にパフォーマンスが著しく低下する可能性があります。
デフォルトは<code class="literal">off</code>です。
この設定はスーパーユーザのみが変更できます。
     </p></dd><dt><span class="term">
     <code class="varname">pg_stat_statements.save</code> (<code class="type">boolean</code>)
     <a id="id-1.11.7.42.9.2.5.1.3" class="indexterm"></a>
     <a id="id-1.11.7.42.9.2.5.1.4" class="indexterm"></a>
    </span></dt><dd><p>
<!--
      <varname>pg_stat_statements.save</varname> specifies whether to
      save statement statistics across server shutdowns.
      If it is <literal>off</literal> then statistics are not saved at
      shutdown nor reloaded at server start.
      The default value is <literal>on</literal>.
      This parameter can only be set in the <filename>postgresql.conf</filename>
      file or on the server command line.
-->
<code class="varname">pg_stat_statements.save</code>は、サーバを終了させる際に文の統計情報を保存するかどうかを指定します。
<code class="literal">off</code>の場合、統計情報は終了時に保存されず、サーバ開始時に再読み込みもされません。
デフォルト値は<code class="literal">on</code>です。
このパラメータは<code class="filename">postgresql.conf</code>ファイル、またはサーバコマンドラインでのみ設定できます。
     </p></dd></dl></div><p>
<!--
   The module requires additional shared memory proportional to
   <varname>pg_stat_statements.max</varname>.  Note that this
   memory is consumed whenever the module is loaded, even if
   <varname>pg_stat_statements.track</varname> is set to <literal>none</literal>.
-->
このモジュールは、<code class="varname">pg_stat_statements.max</code>に比例する追加の共有メモリを必要とします。
<code class="varname">pg_stat_statements.track</code>に<code class="literal">none</code>が設定されていても、モジュールがロードされている限り常にこのメモリが消費されることに注意してください。
  </p><p>
<!--
   These parameters must be set in <filename>postgresql.conf</filename>.
   Typical usage might be:
-->
これらのパラメータは<code class="filename">postgresql.conf</code>の中で設定しなければなりません。
典型的な使用方法は以下のようになります。

</p><pre class="programlisting">
# postgresql.conf
shared_preload_libraries = 'pg_stat_statements'

compute_query_id = on
pg_stat_statements.max = 10000
pg_stat_statements.track = all
</pre><p>
  </p></div><div class="sect2" id="PGSTATSTATEMENTS-SAMPLE-OUTPUT"><div class="titlepage"><div><div><h3 class="title">F.32.5. サンプル出力 <a href="#PGSTATSTATEMENTS-SAMPLE-OUTPUT" class="id_link">#</a></h3></div></div></div><!--
  <title>Sample Output</title>
--><pre class="screen">
bench=# SELECT pg_stat_statements_reset();

$ pgbench -i bench
$ pgbench -c10 -t300 bench

bench=# \x
bench=# SELECT query, calls, total_exec_time, rows, 100.0 * shared_blks_hit /
               nullif(shared_blks_hit + shared_blks_read, 0) AS hit_percent
          FROM pg_stat_statements ORDER BY total_exec_time DESC LIMIT 5;
-[ RECORD 1 ]---+--------------------------------------------------​------------------
query           | UPDATE pgbench_branches SET bbalance = bbalance + $1 WHERE bid = $2
calls           | 3000
total_exec_time | 25565.855387
rows            | 3000
hit_percent     | 100.0000000000000000
-[ RECORD 2 ]---+--------------------------------------------------​------------------
query           | UPDATE pgbench_tellers SET tbalance = tbalance + $1 WHERE tid = $2
calls           | 3000
total_exec_time | 20756.669379
rows            | 3000
hit_percent     | 100.0000000000000000
-[ RECORD 3 ]---+--------------------------------------------------​------------------
query           | copy pgbench_accounts from stdin
calls           | 1
total_exec_time | 291.865911
rows            | 100000
hit_percent     | 100.0000000000000000
-[ RECORD 4 ]---+--------------------------------------------------​------------------
query           | UPDATE pgbench_accounts SET abalance = abalance + $1 WHERE aid = $2
calls           | 3000
total_exec_time | 271.232977
rows            | 3000
hit_percent     | 98.8454011741682975
-[ RECORD 5 ]---+--------------------------------------------------​------------------
query           | alter table pgbench_accounts add primary key (aid)
calls           | 1
total_exec_time | 160.588563
rows            | 0
hit_percent     | 100.0000000000000000


bench=# SELECT pg_stat_statements_reset(0,0,s.queryid) FROM pg_stat_statements AS s
            WHERE s.query = 'UPDATE pgbench_branches SET bbalance = bbalance + $1 WHERE bid = $2';

bench=# SELECT query, calls, total_exec_time, rows, 100.0 * shared_blks_hit /
               nullif(shared_blks_hit + shared_blks_read, 0) AS hit_percent
          FROM pg_stat_statements ORDER BY total_exec_time DESC LIMIT 5;
-[ RECORD 1 ]---+--------------------------------------------------​------------------
query           | UPDATE pgbench_tellers SET tbalance = tbalance + $1 WHERE tid = $2
calls           | 3000
total_exec_time | 20756.669379
rows            | 3000
hit_percent     | 100.0000000000000000
-[ RECORD 2 ]---+--------------------------------------------------​------------------
query           | copy pgbench_accounts from stdin
calls           | 1
total_exec_time | 291.865911
rows            | 100000
hit_percent     | 100.0000000000000000
-[ RECORD 3 ]---+--------------------------------------------------​------------------
query           | UPDATE pgbench_accounts SET abalance = abalance + $1 WHERE aid = $2
calls           | 3000
total_exec_time | 271.232977
rows            | 3000
hit_percent     | 98.8454011741682975
-[ RECORD 4 ]---+--------------------------------------------------​------------------
query           | alter table pgbench_accounts add primary key (aid)
calls           | 1
total_exec_time | 160.588563
rows            | 0
hit_percent     | 100.0000000000000000
-[ RECORD 5 ]---+--------------------------------------------------​------------------
query           | vacuum analyze pgbench_accounts
calls           | 1
total_exec_time | 136.448116
rows            | 0
hit_percent     | 99.9201915403032721

bench=# SELECT pg_stat_statements_reset(0,0,0);

bench=# SELECT query, calls, total_exec_time, rows, 100.0 * shared_blks_hit /
               nullif(shared_blks_hit + shared_blks_read, 0) AS hit_percent
          FROM pg_stat_statements ORDER BY total_exec_time DESC LIMIT 5;
-[ RECORD 1 ]---+--------------------------------------------------​---------------------------
query           | SELECT pg_stat_statements_reset(0,0,0)
calls           | 1
total_exec_time | 0.189497
rows            | 1
hit_percent     |
-[ RECORD 2 ]---+--------------------------------------------------​---------------------------
query           | SELECT query, calls, total_exec_time, rows, $1 * shared_blks_hit /          +
                |                nullif(shared_blks_hit + shared_blks_read, $2) AS hit_percent+
                |           FROM pg_stat_statements ORDER BY total_exec_time DESC LIMIT $3
calls           | 0
total_exec_time | 0
rows            | 0
hit_percent     |

</pre></div><div class="sect2" id="PGSTATSTATEMENTS-AUTHORS"><div class="titlepage"><div><div><h3 class="title">F.32.6. 作者 <a href="#PGSTATSTATEMENTS-AUTHORS" class="id_link">#</a></h3></div></div></div><!--
  <title>Authors</title>
--><p>
<!--
   Takahiro Itagaki <email>itagaki.takahiro@oss.ntt.co.jp</email>.
   Query normalization added by Peter Geoghegan <email>peter@2ndquadrant.com</email>.
-->
   板垣 貴裕 <code class="email">&lt;<a class="email" href="mailto:itagaki.takahiro@oss.ntt.co.jp">itagaki.takahiro@oss.ntt.co.jp</a>&gt;</code>。
   Peter Geoghegan <code class="email">&lt;<a class="email" href="mailto:peter@2ndquadrant.com">peter@2ndquadrant.com</a>&gt;</code>により問い合わせの正規化が追加されました。
  </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="pgrowlocks.html" title="F.31. pgrowlocks — テーブルの行ロックの情報を示す">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="contrib.html" title="付録F 追加で提供されるモジュールと拡張">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="pgstattuple.html" title="F.33. pgstattuple — タプルレベルの統計情報を入手する">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">F.31. pgrowlocks — テーブルの行ロックの情報を示す </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 16.0文書">ホーム</a></td><td width="40%" align="right" valign="top"> F.33. pgstattuple — タプルレベルの統計情報を入手する</td></tr></table></div></body></html>