<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>INSERT</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="sql-importforeignschema.html" title="IMPORT FOREIGN SCHEMA" /><link rel="next" href="sql-listen.html" title="LISTEN" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="4" align="center"><a accesskey="h" href="index.html">PostgreSQL 14.0文書</a></th></tr><tr><td width="10%" align="left"></td><td width="10%" align="left"></td><td width="60%" align="center"><a href="sql-commands.html" title="SQLコマンド">SQLコマンド</a></td><td width="20%" align="right"><div class="actions"><a class="issue" title="github" href="https://github.com/pgsql-jp/jpug-doc/issues/new?title=version 14.0 &#10;                      sql-insert.html">誤訳等の報告
                    </a></div></td></tr><tr><td width="10%" align="left"><a accesskey="p" href="sql-importforeignschema.html" title="IMPORT FOREIGN SCHEMA">前へ</a> </td><td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="SQLコマンド">上へ</a></td><td width="60%" align="center">INSERT</td><td width="20%" align="right"> <a accesskey="n" href="sql-listen.html" title="LISTEN">次へ</a></td></tr></table><hr /></div><div class="refentry" id="SQL-INSERT"><div class="titlepage"></div><a id="id-1.9.3.152.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">INSERT</span></h2><p>INSERT<span class="original">
  &lt;refpurpose&gt;create new rows in a table&lt;/refpurpose&gt;
</span> — テーブルに新しい行を作成する</p></div><div class="refsynopsisdiv"><h2>概要</h2><pre class="synopsis">
[ WITH [ RECURSIVE ] <em class="replaceable"><code>with_query</code></em> [, ...] ]
INSERT INTO <em class="replaceable"><code>table_name</code></em> [ AS <em class="replaceable"><code>alias</code></em> ] [ ( <em class="replaceable"><code>column_name</code></em> [, ...] ) ]
    [ OVERRIDING { SYSTEM | USER } VALUE ]
    { DEFAULT VALUES | VALUES ( { <em class="replaceable"><code>expression</code></em> | DEFAULT } [, ...] ) [, ...] | <em class="replaceable"><code>query</code></em> }
    [ ON CONFLICT [ <em class="replaceable"><code>conflict_target</code></em> ] <em class="replaceable"><code>conflict_action</code></em> ]
    [ RETURNING * | <em class="replaceable"><code>output_expression</code></em> [ [ AS ] <em class="replaceable"><code>output_name</code></em> ] [, ...] ]

<span class="original">
&lt;phrase&gt;where &lt;replaceable class="parameter"&gt;conflict_target&lt;/replaceable&gt; can be one of:&lt;/phrase&gt;
</span>
<span class="phrase">ここで<em class="replaceable"><code>conflict_target</code></em>は以下のいずれかです。</span>

    ( { <em class="replaceable"><code>index_column_name</code></em> | ( <em class="replaceable"><code>index_expression</code></em> ) } [ COLLATE <em class="replaceable"><code>collation</code></em> ] [ <em class="replaceable"><code>opclass</code></em> ] [, ...] ) [ WHERE <em class="replaceable"><code>index_predicate</code></em> ]
    ON CONSTRAINT <em class="replaceable"><code>constraint_name</code></em>

<span class="original">
&lt;phrase&gt;and &lt;replaceable class="parameter"&gt;conflict_action&lt;/replaceable&gt; is one of:&lt;/phrase&gt;
</span>
<span class="phrase">また<em class="replaceable"><code>conflict_action</code></em>は以下のいずれかです。</span>

    DO NOTHING
    DO UPDATE SET { <em class="replaceable"><code>column_name</code></em> = { <em class="replaceable"><code>expression</code></em> | DEFAULT } |
                    ( <em class="replaceable"><code>column_name</code></em> [, ...] ) = [ ROW ] ( { <em class="replaceable"><code>expression</code></em> | DEFAULT } [, ...] ) |
                    ( <em class="replaceable"><code>column_name</code></em> [, ...] ) = ( <em class="replaceable"><code>sub-SELECT</code></em> )
                  } [, ...]
              [ WHERE <em class="replaceable"><code>condition</code></em> ]
</pre></div><div class="refsect1" id="id-1.9.3.152.5"><h2>説明</h2><span class="original">
  &lt;title&gt;Description&lt;/title&gt;
</span><p>
<span class="original">
   &lt;command&gt;INSERT&lt;/command&gt; inserts new rows into a table.
   One can insert one or more rows specified by value expressions,
   or zero or more rows resulting from a query.
</span>
<code class="command">INSERT</code>はテーブルに新しい行を挿入します。
値式を使用して行（複数可）を挿入すること、および、問い合わせの結果を使って0行以上の行を挿入することができます。
  </p><p>
<span class="original">
   The target column names can be listed in any order.  If no list of
   column names is given at all, the default is all the columns of the
   table in their declared order; or the first &lt;replaceable&gt;N&lt;/replaceable&gt; column
   names, if there are only &lt;replaceable&gt;N&lt;/replaceable&gt; columns supplied by the
   &lt;literal&gt;VALUES&lt;/literal&gt; clause or &lt;replaceable&gt;query&lt;/replaceable&gt;.  The values
   supplied by the &lt;literal&gt;VALUES&lt;/literal&gt; clause or &lt;replaceable&gt;query&lt;/replaceable&gt; are
   associated with the explicit or implicit column list left-to-right.
</span>
対象の列名はどのような順番でも指定できます。
列名リストが指定されなかった場合は、テーブル内の全ての列を宣言時の順番に並べたものがデフォルトとして使われます。
また、<code class="literal">VALUES</code>句や<em class="replaceable"><code>query</code></em>で<em class="replaceable"><code>N</code></em>列のみが与えられた場合は、先頭の<em class="replaceable"><code>N</code></em>列の名前が指定されたものとみなされます。
<code class="literal">VALUES</code>句や<em class="replaceable"><code>query</code></em>で提供される値は、明示的または暗黙的な列リストと左から右への順で関連付けられます。
  </p><p>
<span class="original">
   Each column not present in the explicit or implicit column list will be
   filled with a default value, either its declared default value
   or null if there is none.
</span>
明示的または暗黙的な列リストにない各列にはデフォルト値（デフォルト値が宣言されていればその値、未宣言ならばNULL）が挿入されます。
  </p><p>
<span class="original">
   If the expression for any column is not of the correct data type,
   automatic type conversion will be attempted.
</span>
各列の式が正しいデータ型でない場合は、自動的に型の変換が行われます。
  </p><p>
<span class="original">
   &lt;literal&gt;ON CONFLICT&lt;/literal&gt; can be used to specify an alternative
   action to raising a unique constraint or exclusion constraint
   violation error. (See &lt;xref linkend="sql-on-conflict"/&gt; below.)
</span>
<code class="literal">ON CONFLICT</code>は一意制約または排他制約について、違反のエラーを発生させるのに代わる動作を指定するのに使うことができます。
（以下の<a class="xref" href="sql-insert.html#SQL-ON-CONFLICT" title="ON CONFLICT句">ON CONFLICT Clause</a>を参照してください。）
  </p><p>
<span class="original">
   The optional &lt;literal&gt;RETURNING&lt;/literal&gt; clause causes &lt;command&gt;INSERT&lt;/command&gt;
   to compute and return value(s) based on each row actually inserted
   (or updated, if an &lt;literal&gt;ON CONFLICT DO UPDATE&lt;/literal&gt; clause was
   used).  This is primarily useful for obtaining values that were
   supplied by defaults, such as a serial sequence number.  However,
   any expression using the table's columns is allowed.  The syntax of
   the &lt;literal&gt;RETURNING&lt;/literal&gt; list is identical to that of the output
   list of &lt;command&gt;SELECT&lt;/command&gt;.  Only rows that were successfully
   inserted or updated will be returned.  For example, if a row was
   locked but not updated because an &lt;literal&gt;ON CONFLICT DO UPDATE
   ... WHERE&lt;/literal&gt; clause &lt;replaceable
   class="parameter"&gt;condition&lt;/replaceable&gt; was not satisfied, the
   row will not be returned.
</span>
<code class="literal">RETURNING</code>句を指定すると、<code class="command">INSERT</code>は実際に挿入された（あるいは<code class="literal">ON CONFLICT DO UPDATE</code>句によって更新された）各行に基づいて計算された値を返すようになります。
これは、通番のシーケンス番号など、デフォルトで与えられた値を取り出す時に主に便利です。
しかし、そのテーブルの列を使用した任意の式を指定することができます。
<code class="literal">RETURNING</code>リストの構文は<code class="command">SELECT</code>の出力リストと同一です。
挿入または更新に成功した行だけが返されます。
例えば、行がロックされていて、<code class="literal">ON CONFLICT DO UPDATE ... WHERE</code>句の <em class="replaceable"><code>condition</code></em>が満たされなかったために更新されなかった行は返されません。
  </p><p>
<span class="original">
   You must have &lt;literal&gt;INSERT&lt;/literal&gt; privilege on a table in
   order to insert into it.  If &lt;literal&gt;ON CONFLICT DO UPDATE&lt;/literal&gt; is
   present, &lt;literal&gt;UPDATE&lt;/literal&gt; privilege on the table is also
   required.
</span>
テーブルに行を追加するには、そのテーブルに対して<code class="literal">INSERT</code>権限を持っている必要があります。
<code class="literal">ON CONFLICT DO UPDATE</code>がある場合は、テーブルの<code class="literal">UPDATE</code>権限も必要です。
  </p><p>
<span class="original">
   If a column list is specified, you only need
   &lt;literal&gt;INSERT&lt;/literal&gt; privilege on the listed columns.
   Similarly, when &lt;literal&gt;ON CONFLICT DO UPDATE&lt;/literal&gt; is specified, you
   only need &lt;literal&gt;UPDATE&lt;/literal&gt; privilege on the column(s) that are
   listed to be updated.  However, &lt;literal&gt;ON CONFLICT DO UPDATE&lt;/literal&gt;
   also requires &lt;literal&gt;SELECT&lt;/literal&gt; privilege on any column whose
   values are read in the &lt;literal&gt;ON CONFLICT DO UPDATE&lt;/literal&gt;
   expressions or &lt;replaceable&gt;condition&lt;/replaceable&gt;.
</span>
列リストを指定する場合は、列挙された列に対する<code class="literal">INSERT</code>権限のみが必要です。
同様に、<code class="literal">ON CONFLICT DO UPDATE</code>が指定されている場合、更新対象として列挙されている列についてのみ、<code class="literal">UPDATE</code>権限が必要です。
しかし、<code class="literal">ON CONFLICT DO UPDATE</code>はまた、その式あるいは<em class="replaceable"><code>condition</code></em>で読み取られるすべての列についての<code class="literal">SELECT</code>権限も必要です。
  </p><p>
<span class="original">
   Use of the &lt;literal&gt;RETURNING&lt;/literal&gt; clause requires &lt;literal&gt;SELECT&lt;/literal&gt;
   privilege on all columns mentioned in &lt;literal&gt;RETURNING&lt;/literal&gt;.
   If you use the &lt;replaceable
   class="parameter"&gt;query&lt;/replaceable&gt; clause to insert rows from a
   query, you of course need to have &lt;literal&gt;SELECT&lt;/literal&gt; privilege on
   any table or column used in the query.
</span>
<code class="literal">RETURNING</code>句を使用するには、<code class="literal">RETURNING</code>で使用するすべての列に対する<code class="literal">SELECT</code>権限が必要です。
<em class="replaceable"><code>query</code></em>を使用して問い合わせ結果を元に行を挿入する場合は当然ながら、その問い合わせ内で使われる全てのテーブルまたは列に対して<code class="literal">SELECT</code>権限を持っている必要があります。
  </p></div><div class="refsect1" id="id-1.9.3.152.6"><h2>パラメータ</h2><span class="original">
  &lt;title&gt;Parameters&lt;/title&gt;
</span><div class="refsect2" id="id-1.9.3.152.6.2"><h3>挿入</h3><span class="original">
   &lt;title&gt;Inserting&lt;/title&gt;
</span><p>
<span class="original">
    This section covers parameters that may be used when only
    inserting new rows.  Parameters &lt;emphasis&gt;exclusively&lt;/emphasis&gt;
    used with the &lt;literal&gt;ON CONFLICT&lt;/literal&gt; clause are described
    separately.
</span>
この節では新しい行を挿入するときにのみ使われるパラメータについて説明します。
<code class="literal">ON CONFLICT</code>句において<span class="emphasis"><em>のみ</em></span>使われるパラメータについては、別に説明します。
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>with_query</code></em></span></dt><dd><p>
<span class="original">
        The &lt;literal&gt;WITH&lt;/literal&gt; clause allows you to specify one or more
        subqueries that can be referenced by name in the &lt;command&gt;INSERT&lt;/command&gt;
        query. See &lt;xref linkend="queries-with"/&gt; and &lt;xref linkend="sql-select"/&gt;
        for details.
</span>
<code class="literal">WITH</code>句により、<code class="command">INSERT</code>問い合わせ内で名前により参照することができる１つ以上の副問い合わせを指定することができます。
詳しくは<a class="xref" href="queries-with.html" title="7.8. WITH問い合わせ（共通テーブル式）">7.8</a>と<a class="xref" href="sql-select.html" title="SELECT"><span class="refentrytitle">SELECT</span></a>を参照してください。
       </p><p>
<span class="original">
        It is possible for the &lt;replaceable class="parameter"&gt;query&lt;/replaceable&gt;
        (&lt;command&gt;SELECT&lt;/command&gt; statement)
        to also contain a &lt;literal&gt;WITH&lt;/literal&gt; clause.  In such a case both
        sets of &lt;replaceable&gt;with_query&lt;/replaceable&gt; can be referenced within
        the &lt;replaceable class="parameter"&gt;query&lt;/replaceable&gt;, but the
        second one takes precedence since it is more closely nested.
</span>
<em class="replaceable"><code>query</code></em>（<code class="command">SELECT</code>文）でもまた、<code class="literal">WITH</code>句を含めることができます。
こうした場合、<em class="replaceable"><code>with_query</code></em>の集合との両方を<em class="replaceable"><code>query</code></em>内で参照することができます。
しかし、第二の問い合わせがより近くにネストされているため優先します。
       </p></dd><dt><span class="term"><em class="replaceable"><code>table_name</code></em></span></dt><dd><p>
<span class="original">
        The name (optionally schema-qualified) of an existing table.
</span>
既存のテーブルの名前です（スキーマ修飾名も可）。
       </p></dd><dt><span class="term"><em class="replaceable"><code>alias</code></em></span></dt><dd><p>
<span class="original">
        A substitute name for &lt;replaceable
        class="parameter"&gt;table_name&lt;/replaceable&gt;.  When an alias is
        provided, it completely hides the actual name of the table.
        This is particularly useful when &lt;literal&gt;ON CONFLICT DO UPDATE&lt;/literal&gt;
        targets a table named &lt;varname&gt;excluded&lt;/varname&gt;, since that will otherwise
        be taken as the name of the special table representing rows proposed
        for insertion.
</span>
<em class="replaceable"><code>table_name</code></em>の代替名です。
aliasを指定すると、テーブルの実際の名前が完全に隠されます。
これは、<code class="varname">excluded</code>という名前のテーブルを<code class="literal">ON CONFLICT DO UPDATE</code>が対象にしている場合、これを指定しなければ、それが挿入で処理される行を表現する特別なテーブルの名前とみなされるため、特に有用となります。
       </p></dd><dt><span class="term"><em class="replaceable"><code>column_name</code></em></span></dt><dd><p>
<span class="original">
        The name of a column in the table named by &lt;replaceable
        class="parameter"&gt;table_name&lt;/replaceable&gt;.  The column name
        can be qualified with a subfield name or array subscript, if
        needed.  (Inserting into only some fields of a composite
        column leaves the other fields null.)  When referencing a
        column with &lt;literal&gt;ON CONFLICT DO UPDATE&lt;/literal&gt;, do not include
        the table's name in the specification of a target column.  For
        example, &lt;literal&gt;INSERT INTO table_name ... ON CONFLICT DO UPDATE
        SET table_name.col = 1&lt;/literal&gt; is invalid (this follows the general
        behavior for &lt;command&gt;UPDATE&lt;/command&gt;).
</span>
<em class="replaceable"><code>table_name</code></em>で指名されたテーブル内の列名です。
必要なら列名を副フィールドの名前や配列の添え字で修飾することができます。
（複合型の列の一部のフィールドのみを挿入すると他のフィールドはNULLになります。）
<code class="literal">ON CONFLICT DO UPDATE</code>で列を参照する場合、対象列の指定にテーブル名を含めてはいけません。
例えば、<code class="literal">INSERT INTO table_name ... ON CONFLICT DO UPDATE SET table_name.col = 1</code>は無効です（これは<code class="command">UPDATE</code>の一般的な動作に従います）。
       </p></dd><dt><span class="term"><code class="literal">OVERRIDING SYSTEM VALUE</code></span></dt><dd><p>
<span class="original">
        If this clause is specified, then any values supplied for identity
        columns will override the default sequence-generated values.
</span>
この句が指定されると、IDENTITY列について指定された値がシーケンスが生成したデフォルト値に優先します。
       </p><p>
<span class="original">
        For an identity column defined as &lt;literal&gt;GENERATED ALWAYS&lt;/literal&gt;,
        it is an error to insert an explicit value (other than
        &lt;literal&gt;DEFAULT&lt;/literal&gt;) without specifying either
        &lt;literal&gt;OVERRIDING SYSTEM VALUE&lt;/literal&gt; or &lt;literal&gt;OVERRIDING USER
        VALUE&lt;/literal&gt;.  (For an identity column defined as
        &lt;literal&gt;GENERATED BY DEFAULT&lt;/literal&gt;, &lt;literal&gt;OVERRIDING SYSTEM
        VALUE&lt;/literal&gt; is the normal behavior and specifying it does nothing,
        but &lt;productname&gt;PostgreSQL&lt;/productname&gt; allows it as an extension.)
</span>
<code class="literal">GENERATED ALWAYS</code>と定義されているIDENTITY列に対しては、<code class="literal">OVERRIDING SYSTEM VALUE</code>や<code class="literal">OVERRIDING USER VALUE</code>を指定せずに(<code class="literal">DEFAULT</code>以外の)明示的な値を挿入するのはエラーです。
(<code class="literal">GENERATED BY DEFAULT</code>と定義されているIDENTITY列に対しては、<code class="literal">OVERRIDING SYSTEM VALUE</code>が通常の振る舞いであり、指定したとしても何もしませんが、<span class="productname">PostgreSQL</span>は拡張として許容します。)
       </p></dd><dt><span class="term"><code class="literal">OVERRIDING USER VALUE</code></span></dt><dd><p>
<span class="original">
        If this clause is specified, then any values supplied for identity
        columns are ignored and the default sequence-generated values are
        applied.
</span>
この句が指定されると、IDENTITY列について指定された値はすべて無視されて、シーケンスが生成したデフォルト値が適用されます。
       </p><p>
<span class="original">
        This clause is useful for example when copying values between tables.
        Writing &lt;literal&gt;INSERT INTO tbl2 OVERRIDING USER VALUE SELECT * FROM
        tbl1&lt;/literal&gt; will copy from &lt;literal&gt;tbl1&lt;/literal&gt; all columns that
        are not identity columns in &lt;literal&gt;tbl2&lt;/literal&gt; while values for
        the identity columns in &lt;literal&gt;tbl2&lt;/literal&gt; will be generated by
        the sequences associated with &lt;literal&gt;tbl2&lt;/literal&gt;.
</span>
この句は例えばテーブル間で値をコピーする時に有用です。
<code class="literal">INSERT INTO tbl2 OVERRIDING USER VALUE SELECT * FROM tbl1</code>とすると、<code class="literal">tbl1</code>の列で<code class="literal">tbl2</code>のIDENTITY列でないものがすべてコピーされる一方、<code class="literal">tbl2</code>のIDENTITY列の値は、<code class="literal">tbl2</code>に紐付けられたシーケンスによって生成されます。
       </p></dd><dt><span class="term"><code class="literal">DEFAULT VALUES</code></span></dt><dd><p>
<span class="original">
        All columns will be filled with their default values, as if
        &lt;literal&gt;DEFAULT&lt;/literal&gt; were explicitly specified for each column.
        (An &lt;literal&gt;OVERRIDING&lt;/literal&gt; clause is not permitted in this
        form.)
</span>
各列に対して<code class="literal">DEFAULT</code>が明示的に指定されたかのように、すべての列にそれぞれのデフォルト値が設定されます。
（<code class="literal">OVERRIDING</code>はこの構文では使用できません。）
       </p></dd><dt><span class="term"><em class="replaceable"><code>expression</code></em></span></dt><dd><p>
<span class="original">
        An expression or value to assign to the corresponding column.
</span>
対応する列に代入する式または値を指定します。
       </p></dd><dt><span class="term"><code class="literal">DEFAULT</code></span></dt><dd><p>
<span class="original">
        The corresponding column will be filled with its default value.  An
        identity column will be filled with a new value generated by the
        associated sequence.  For a generated column, specifying this is
        permitted but merely specifies the normal behavior of computing the
        column from its generation expression.
</span>
対応する列にデフォルト値を設定します。
IDENTITY列には関連付けられた列により新しく生成された値が書き込まれます。
生成列に対して、これを指定することは許されていますが、単に生成式から列を計算するという普通の振る舞いを指定するだけです。
       </p></dd><dt><span class="term"><em class="replaceable"><code>query</code></em></span></dt><dd><p>
<span class="original">
        A query (&lt;command&gt;SELECT&lt;/command&gt; statement) that supplies the
        rows to be inserted.  Refer to the
        &lt;xref linkend="sql-select"/&gt;
        statement for a description of the syntax.
</span>
挿入する行を提供する問い合わせ（<code class="command">SELECT</code>文）を指定します。
構文の説明については<a class="xref" href="sql-select.html" title="SELECT"><span class="refentrytitle">SELECT</span></a>文を参照してください。
       </p></dd><dt><span class="term"><em class="replaceable"><code>output_expression</code></em></span></dt><dd><p>
<span class="original">
        An expression to be computed and returned by the
        &lt;command&gt;INSERT&lt;/command&gt; command after each row is inserted or
        updated. The expression can use any column names of the table
        named by &lt;replaceable
        class="parameter"&gt;table_name&lt;/replaceable&gt;.  Write
        &lt;literal&gt;*&lt;/literal&gt; to return all columns of the inserted or updated
        row(s).
</span>
各行が挿入または更新された後、<code class="command">INSERT</code>により計算され、返される式です。
この式には<em class="replaceable"><code>table_name</code></em>で指名されたテーブルの任意の列名を使用することができます。
挿入または更新された行のすべての列を返す場合は<code class="literal">*</code>と記載してください。
       </p></dd><dt><span class="term"><em class="replaceable"><code>output_name</code></em></span></dt><dd><p>
<span class="original">
        A name to use for a returned column.
</span>
返される列で使用される名前です。
       </p></dd></dl></div></div><div class="refsect2" id="SQL-ON-CONFLICT"><h3><code class="literal">ON CONFLICT</code>句</h3><span class="original">
   &lt;title&gt;&lt;literal&gt;ON CONFLICT&lt;/literal&gt; Clause&lt;/title&gt;
</span><a id="id-1.9.3.152.6.3.2" class="indexterm"></a><a id="id-1.9.3.152.6.3.3" class="indexterm"></a><p>
<span class="original">
    The optional &lt;literal&gt;ON CONFLICT&lt;/literal&gt; clause specifies an
    alternative action to raising a unique violation or exclusion
    constraint violation error.  For each individual row proposed for
    insertion, either the insertion proceeds, or, if an
    &lt;emphasis&gt;arbiter&lt;/emphasis&gt; constraint or index specified by
    &lt;parameter&gt;conflict_target&lt;/parameter&gt; is violated, the
    alternative &lt;parameter&gt;conflict_action&lt;/parameter&gt; is taken.
    &lt;literal&gt;ON CONFLICT DO NOTHING&lt;/literal&gt; simply avoids inserting
    a row as its alternative action.  &lt;literal&gt;ON CONFLICT DO
    UPDATE&lt;/literal&gt; updates the existing row that conflicts with the
    row proposed for insertion as its alternative action.
</span>
オプションの<code class="literal">ON CONFLICT</code>句では、一意制約や排他制約の違反について、エラーを発生させる代替となる動作を指定します。
挿入しようとされた各行について、挿入の処理が進められるか、あるいは、<em class="parameter"><code>conflict_target</code></em>により指定された<span class="emphasis"><em>競合</em></span>制約またはインデックスに違反した場合の代替の<em class="parameter"><code>conflict_action</code></em>が実行されるか、のいずれかです。
<code class="literal">ON CONFLICT DO NOTHING</code>は代替の動作として、単に行の挿入をしなくなるだけです。
<code class="literal">ON CONFLICT DO UPDATE</code>は代替の動作として、挿入されようとしていた行と競合する既存の行を更新します。
   </p><p>
<span class="original">
    &lt;parameter&gt;conflict_target&lt;/parameter&gt; can perform
    &lt;emphasis&gt;unique index inference&lt;/emphasis&gt;.  When performing
    inference, it consists of one or more &lt;replaceable
    class="parameter"&gt;index_column_name&lt;/replaceable&gt; columns and/or
    &lt;replaceable class="parameter"&gt;index_expression&lt;/replaceable&gt;
    expressions, and an optional &lt;replaceable class="parameter"&gt;index_predicate&lt;/replaceable&gt;.  All &lt;replaceable
    class="parameter"&gt;table_name&lt;/replaceable&gt; unique indexes that,
    without regard to order, contain exactly the
    &lt;parameter&gt;conflict_target&lt;/parameter&gt;-specified
    columns/expressions are inferred (chosen) as arbiter indexes.  If
    an &lt;replaceable class="parameter"&gt;index_predicate&lt;/replaceable&gt; is
    specified, it must, as a further requirement for inference,
    satisfy arbiter indexes.  Note that this means a non-partial
    unique index (a unique index without a predicate) will be inferred
    (and thus used by &lt;literal&gt;ON CONFLICT&lt;/literal&gt;) if such an index
    satisfying every other criteria is available.  If an attempt at
    inference is unsuccessful, an error is raised.
</span>
<em class="parameter"><code>conflict_target</code></em>は<span class="emphasis"><em>一意インデックスの推定</em></span>を実行することができます。
推定を実行するとき、それは1つ以上の<em class="replaceable"><code>index_column_name</code></em>列、または<em class="replaceable"><code>index_expression</code></em>式、あるいはその両方、およびオプションで<em class="replaceable"><code>index_predicate</code></em>から構成されます。
<em class="replaceable"><code>table_name</code></em>の一意インデックスで<em class="parameter"><code>conflict_target</code></em>で指定された列と式を（順序は関係なく）正確に含むものは、すべて競合解決インデックスとして推定されます（選ばれます）。
<em class="replaceable"><code>index_predicate</code></em>が指定されている場合は、推定のさらなる条件として、それは競合解決インデックスを満たさなければなりません。
これは、部分インデックスでない一意インデックス（述語のない一意インデックス）は、それが他のすべての条件を満たすのであれば推定される（従って<code class="literal">ON CONFLICT</code>で使用される）ことを意味することに注意して下さい。
推定に失敗した時は、エラーが発生します。
   </p><p>
<span class="original">
    &lt;literal&gt;ON CONFLICT DO UPDATE&lt;/literal&gt; guarantees an atomic
    &lt;command&gt;INSERT&lt;/command&gt; or &lt;command&gt;UPDATE&lt;/command&gt; outcome;
    provided there is no independent error, one of those two outcomes
    is guaranteed, even under high concurrency.  This is also known as
    &lt;firstterm&gt;UPSERT&lt;/firstterm&gt; &amp;mdash; &lt;quote&gt;UPDATE or
    INSERT&lt;/quote&gt;.
</span>
<code class="literal">ON CONFLICT DO UPDATE</code>は<code class="command">INSERT</code>または<code class="command">UPDATE</code>の原子的な結果を保証します。
無関係のエラーが発生しなければ、多数の同時実行がある状況においてさえも、それら2つの結果のうちの1つになります。
これは<em class="firstterm">UPSERT</em>、つまり<span class="quote">「<span class="quote">UPDATE or INSERT</span>」</span>としても知られています。
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>conflict_target</code></em></span></dt><dd><p>
<span class="original">
        Specifies which conflicts &lt;literal&gt;ON CONFLICT&lt;/literal&gt; takes
        the alternative action on by choosing &lt;firstterm&gt;arbiter
        indexes&lt;/firstterm&gt;.  Either performs &lt;emphasis&gt;unique index
        inference&lt;/emphasis&gt;, or names a constraint explicitly.  For
        &lt;literal&gt;ON CONFLICT DO NOTHING&lt;/literal&gt;, it is optional to
        specify a &lt;parameter&gt;conflict_target&lt;/parameter&gt;; when
        omitted, conflicts with all usable constraints (and unique
        indexes) are handled.  For &lt;literal&gt;ON CONFLICT DO
        UPDATE&lt;/literal&gt;, a &lt;parameter&gt;conflict_target&lt;/parameter&gt;
        &lt;emphasis&gt;must&lt;/emphasis&gt; be provided.
</span>
<code class="literal">ON CONFLICT</code>が<em class="firstterm">競合解決インデックス</em>を選ぶことで代替の動作をするときの競合を指定します。
<span class="emphasis"><em>一意インデックスの推定</em></span>を実行するか、あるいは制約を明示的に指定するかのいずれかです。
<code class="literal">ON CONFLICT DO NOTHING</code>では<em class="parameter"><code>conflict_target</code></em>を指定するのはオプションです。
省略すると、利用可能なすべての制約（および一意インデックス）との競合が処理されます。
<code class="literal">ON CONFLICT DO UPDATE</code>では<em class="parameter"><code>conflict_target</code></em>を指定<span class="emphasis"><em>しなければなりません</em></span>。
       </p></dd><dt><span class="term"><em class="replaceable"><code>conflict_action</code></em></span></dt><dd><p>
<span class="original">
        &lt;parameter&gt;conflict_action&lt;/parameter&gt; specifies an
        alternative &lt;literal&gt;ON CONFLICT&lt;/literal&gt; action.  It can be
        either &lt;literal&gt;DO NOTHING&lt;/literal&gt;, or a &lt;literal&gt;DO
        UPDATE&lt;/literal&gt; clause specifying the exact details of the
        &lt;literal&gt;UPDATE&lt;/literal&gt; action to be performed in case of a
        conflict.  The &lt;literal&gt;SET&lt;/literal&gt; and
        &lt;literal&gt;WHERE&lt;/literal&gt; clauses in &lt;literal&gt;ON CONFLICT DO
        UPDATE&lt;/literal&gt; have access to the existing row using the
        table's name (or an alias), and to rows proposed for insertion
        using the special &lt;varname&gt;excluded&lt;/varname&gt; table.
        &lt;literal&gt;SELECT&lt;/literal&gt; privilege is required on any column in the
        target table where corresponding &lt;varname&gt;excluded&lt;/varname&gt;
        columns are read.
</span>
<em class="parameter"><code>conflict_action</code></em>では<code class="literal">ON CONFLICT</code>の代替の動作を指定します。
これは<code class="literal">DO NOTHING</code>あるいは<code class="literal">DO UPDATE</code>句のいずれかをとることができ、後者では競合が発生した場合に実行される<code class="literal">UPDATE</code>の動作の正確な詳細を記述します。
<code class="literal">ON CONFLICT DO UPDATE</code>の<code class="literal">SET</code>句と<code class="literal">WHERE</code>は既存の行にテーブルの名前（または別名）を使ってアクセスでき、また挿入されようとしていた行には、特別な<code class="varname">excluded</code>テーブルを使ってアクセスできます。
<code class="varname">excluded</code>の列を読み取るときには、対象テーブルの対応する列の<code class="literal">SELECT</code>権限が必要です。
       </p><p>
<span class="original">
        Note that the effects of all per-row &lt;literal&gt;BEFORE
        INSERT&lt;/literal&gt; triggers are reflected in
        &lt;varname&gt;excluded&lt;/varname&gt; values, since those effects may
        have contributed to the row being excluded from insertion.
</span>
すべての行レベルの<code class="literal">BEFORE INSERT</code>トリガーの結果が<code class="varname">excluded</code>の値に反映されることに注意して下さい。
これらの結果として、行が挿入から除外されることになったかもしれないからです。
       </p></dd><dt><span class="term"><em class="replaceable"><code>index_column_name</code></em></span></dt><dd><p>
<span class="original">
        The name of a &lt;replaceable
        class="parameter"&gt;table_name&lt;/replaceable&gt; column.  Used to
        infer arbiter indexes.  Follows &lt;command&gt;CREATE
        INDEX&lt;/command&gt; format.  &lt;literal&gt;SELECT&lt;/literal&gt; privilege on
        &lt;replaceable class="parameter"&gt;index_column_name&lt;/replaceable&gt;
        is required.
</span>
<em class="replaceable"><code>table_name</code></em>の列の名前です。
競合解決インデックスを推定するのに使われます。
<code class="command">CREATE INDEX</code>の形式に従います。
<em class="replaceable"><code>index_column_name</code></em>の<code class="literal">SELECT</code>が必要です。
       </p></dd><dt><span class="term"><em class="replaceable"><code>index_expression</code></em></span></dt><dd><p>
<span class="original">
        Similar to &lt;replaceable
        class="parameter"&gt;index_column_name&lt;/replaceable&gt;, but used to
        infer expressions on &lt;replaceable
        class="parameter"&gt;table_name&lt;/replaceable&gt; columns appearing
        within index definitions (not simple columns).  Follows
        &lt;command&gt;CREATE INDEX&lt;/command&gt; format.  &lt;literal&gt;SELECT&lt;/literal&gt;
        privilege on any column appearing within &lt;replaceable
        class="parameter"&gt;index_expression&lt;/replaceable&gt; is required.
</span>
<em class="replaceable"><code>index_column_name</code></em>と似ていますが、インデックスの定義に現れる<em class="replaceable"><code>table_name</code></em>の列の式（単純な列ではない）の推定に使われます。
<code class="command">CREATE INDEX</code>の形式に従います。
<em class="replaceable"><code>index_expression</code></em>に現れるすべての列の<code class="literal">SELECT</code>権限が必要です。
       </p></dd><dt><span class="term"><em class="replaceable"><code>collation</code></em></span></dt><dd><p>
<span class="original">
        When specified, mandates that corresponding &lt;replaceable
        class="parameter"&gt;index_column_name&lt;/replaceable&gt; or
        &lt;replaceable class="parameter"&gt;index_expression&lt;/replaceable&gt;
        use a particular collation in order to be matched during
        inference.  Typically this is omitted, as collations usually
        do not affect whether or not a constraint violation occurs.
        Follows &lt;command&gt;CREATE INDEX&lt;/command&gt; format.
</span>
これを指定すると、推定時に、対応する<em class="replaceable"><code>index_column_name</code></em>あるいは<em class="replaceable"><code>index_expression</code></em>をマッチさせるときに、特定の照合順序を指定することになります。
普通は照合順序は制約違反が発生するかどうかに関係しないので、通常は省略されます。
<code class="command">CREATE INDEX</code>の形式に従います。
       </p></dd><dt><span class="term"><em class="replaceable"><code>opclass</code></em></span></dt><dd><p>
<span class="original">
        When specified, mandates that corresponding &lt;replaceable
        class="parameter"&gt;index_column_name&lt;/replaceable&gt; or
        &lt;replaceable class="parameter"&gt;index_expression&lt;/replaceable&gt;
        use particular operator class in order to be matched during
        inference.  Typically this is omitted,  as the
        &lt;emphasis&gt;equality&lt;/emphasis&gt; semantics are often equivalent
        across a type's operator classes anyway, or because it's
        sufficient to trust that the defined unique indexes have the
        pertinent definition of equality.  Follows &lt;command&gt;CREATE
        INDEX&lt;/command&gt; format.
</span>
これを指定すると、推定時に、対応する<em class="replaceable"><code>index_column_name</code></em>あるいは<em class="replaceable"><code>index_expression</code></em>をマッチさせるときに、特定の演算子クラスを指定することになります。
<span class="emphasis"><em>等価</em></span>の意味は、いずれにせよ、型の演算子クラスをまたがって同等であることが多いですし、また定義された一意インデックスは等価を適切に定義していると信頼すれば十分なので、通常はこれは省略されます。
<code class="command">CREATE INDEX</code>の形式に従います。
       </p></dd><dt><span class="term"><em class="replaceable"><code>index_predicate</code></em></span></dt><dd><p>
<span class="original">
        Used to allow inference of partial unique indexes.  Any
        indexes that satisfy the predicate (which need not actually be
        partial indexes) can be inferred.  Follows &lt;command&gt;CREATE
        INDEX&lt;/command&gt; format.  &lt;literal&gt;SELECT&lt;/literal&gt; privilege on any
        column appearing within &lt;replaceable
        class="parameter"&gt;index_predicate&lt;/replaceable&gt; is required.
</span>
部分一意インデックスの推定を可能にします。
述語を満たすすべてのインデックス（実際に部分インデックスである必要はありません）は推定可能になります。
<code class="command">CREATE INDEX</code>の形式に従います。
<em class="replaceable"><code>index_predicate</code></em>に現れるすべての列について<code class="literal">SELECT</code>権限が必要です。
       </p></dd><dt><span class="term"><em class="replaceable"><code>constraint_name</code></em></span></dt><dd><p>
<span class="original">
        Explicitly specifies an arbiter
        &lt;emphasis&gt;constraint&lt;/emphasis&gt; by name, rather than inferring
        a constraint or index.
</span>
競合解決の<span class="emphasis"><em>制約</em></span>を制約やインデックスの推定によるのではなく、明示的に名前で指定します。
       </p></dd><dt><span class="term"><em class="replaceable"><code>condition</code></em></span></dt><dd><p>
<span class="original">
        An expression that returns a value of type
        &lt;type&gt;boolean&lt;/type&gt;.  Only rows for which this expression
        returns &lt;literal&gt;true&lt;/literal&gt; will be updated, although all
        rows will be locked when the &lt;literal&gt;ON CONFLICT DO UPDATE&lt;/literal&gt;
        action is taken.  Note that
        &lt;replaceable&gt;condition&lt;/replaceable&gt; is evaluated last, after
        a conflict has been identified as a candidate to update.
</span>
<code class="type">boolean</code>型の値を返す式です。
この式が<code class="literal">true</code>を返す行のみが更新されます。
ただし、<code class="literal">ON CONFLICT DO UPDATE</code>の動作が行われるときは、すべての行がロックされます。
<em class="replaceable"><code>condition</code></em>は最後に評価される、競合が更新対象候補として特定された後であることに注意して下さい。
       </p></dd></dl></div><p>
<span class="original">
    Note that exclusion constraints are not supported as arbiters with
    &lt;literal&gt;ON CONFLICT DO UPDATE&lt;/literal&gt;. In all cases, only
    &lt;literal&gt;NOT DEFERRABLE&lt;/literal&gt; constraints and unique indexes
    are supported as arbiters.
</span>
排他制約は<code class="literal">ON CONFLICT DO UPDATE</code>の競合解決としてはサポートされないことに注意して下さい。
すべての場合について、<code class="literal">NOT DEFERRABLE</code>である制約と一意インデックスのみが競合解決としてサポートされます。
   </p><p>
<span class="original">
    &lt;command&gt;INSERT&lt;/command&gt; with an &lt;literal&gt;ON CONFLICT DO UPDATE&lt;/literal&gt;
    clause is a &lt;quote&gt;deterministic&lt;/quote&gt; statement.  This means
    that the command will not be allowed to affect any single existing
    row more than once; a cardinality violation error will be raised
    when this situation arises.  Rows proposed for insertion should
    not duplicate each other in terms of attributes constrained by an
    arbiter index or constraint.
</span>
<code class="literal">ON CONFLICT DO UPDATE</code>句のある<code class="command">INSERT</code>は<span class="quote">「<span class="quote">決定論的な</span>」</span>文です。
これは、そのコマンドが既存のどの行に対しても、2回以上影響を与えることが許されない、ということを意味します。
これに反する状況が発生した時は、カーディナリティ違反のエラーが発生します。
挿入されようとする行は、競合解決インデックスあるいは制約により制限される属性の観点で、複製されてはなりません。
   </p><p>
<span class="original">
    Note that it is currently not supported for the
    &lt;literal&gt;ON CONFLICT DO UPDATE&lt;/literal&gt; clause of an
    &lt;command&gt;INSERT&lt;/command&gt; applied to a partitioned table to update the
    partition key of a conflicting row such that it requires the row be moved
    to a new partition.
</span>
パーティションテーブルに適用された<code class="command">INSERT</code>の<code class="literal">ON CONFLICT DO UPDATE</code>句に対しては、その行を新しいパーティションに移動する必要のあるような競合する行のパーティションキーを更新することは現在サポートされていないことに注意してください。
   </p><div class="tip"><h3 class="title">ヒント</h3><p>
<span class="original">
     It is often preferable to use unique index inference rather than
     naming a constraint directly using &lt;literal&gt;ON CONFLICT ON
     CONSTRAINT&lt;/literal&gt; &lt;replaceable class="parameter"&gt;
     constraint_name&lt;/replaceable&gt;.  Inference will continue to work
     correctly when the underlying index is replaced by another more
     or less equivalent index in an overlapping way, for example when
     using &lt;literal&gt;CREATE UNIQUE INDEX ...  CONCURRENTLY&lt;/literal&gt;
     before dropping the index being replaced.
</span>
<code class="literal">ON CONFLICT ON CONSTRAINT</code> <em class="replaceable"><code> constraint_name</code></em>を使って制約を直接指定するより、一意インデックスの推定を使う方が望ましいことが多いです。
背景にあるインデックスが、他のほぼ同等のインデックスと重なり合う形で置換されるとき、推定は正しく動作し続けます。
例えば、置換されるインデックスを削除する前に<code class="literal">CREATE UNIQUE INDEX ...  CONCURRENTLY</code>を使う場合です。
    </p></div></div></div><div class="refsect1" id="id-1.9.3.152.7"><h2>出力</h2><span class="original">
  &lt;title&gt;Outputs&lt;/title&gt;
</span><p>
<span class="original">
   On successful completion, an &lt;command&gt;INSERT&lt;/command&gt; command returns a command
   tag of the form
</span>
正常に終了すると、<code class="command">INSERT</code>は以下のようなコマンドタグを返します。
</p><pre class="screen">
INSERT <em class="replaceable"><code>oid</code></em> <em class="replaceable"><code>count</code></em>
</pre><p>
<span class="original">
   The &lt;replaceable class="parameter"&gt;count&lt;/replaceable&gt; is the number of
   rows inserted or updated.  &lt;replaceable&gt;oid&lt;/replaceable&gt; is always 0 (it
   used to be the &lt;acronym&gt;OID&lt;/acronym&gt; assigned to the inserted row if
   &lt;replaceable&gt;count&lt;/replaceable&gt; was exactly one and the target table was
   declared &lt;literal&gt;WITH OIDS&lt;/literal&gt; and 0 otherwise, but creating a table
   &lt;literal&gt;WITH OIDS&lt;/literal&gt; is not supported anymore).
</span>
<em class="replaceable"><code>count</code></em>は挿入または更新された行数です。
<em class="replaceable"><code>oid</code></em>は常に0です(<em class="replaceable"><code>count</code></em>が正確に1であり、対象のテーブルが<code class="literal">WITH OIDS</code>と宣言されていた場合、挿入された行に<acronym class="acronym">OID</acronym>が、そうでなければ0が割り当てられていましたが、<code class="literal">WITH OIDS</code>でテーブルを作成することは今はもうサポートされていません)。
  </p><p>
<span class="original">
   If the &lt;command&gt;INSERT&lt;/command&gt; command contains a &lt;literal&gt;RETURNING&lt;/literal&gt;
   clause, the result will be similar to that of a &lt;command&gt;SELECT&lt;/command&gt;
   statement containing the columns and values defined in the
   &lt;literal&gt;RETURNING&lt;/literal&gt; list, computed over the row(s) inserted or
   updated by the command.
</span>
<code class="command">INSERT</code>コマンドが<code class="literal">RETURNING</code>句を持つ場合、その結果は、<code class="literal">RETURNING</code>リストで定義した列と値を持ち、そのコマンドで挿入または更新された行全体に対して計算を行う<code class="command">SELECT</code>文の結果と似たものになるでしょう。
  </p></div><div class="refsect1" id="id-1.9.3.152.8"><h2>注釈</h2><span class="original">
  &lt;title&gt;Notes&lt;/title&gt;
</span><p>
<span class="original">
   If the specified table is a partitioned table, each row is routed to
   the appropriate partition and inserted into it.  If the specified table
   is a partition, an error will occur if one of the input rows violates
   the partition constraint.
</span>
指定したテーブルがパーティションテーブルの場合、各行は適切なパーティションに回され、そちらに挿入されます。
指定したテーブルがパーティションの場合、挿入行にパーティションの制約に違反するものがあれば、エラーが発生します。
  </p></div><div class="refsect1" id="id-1.9.3.152.9"><h2>例</h2><span class="original">
  &lt;title&gt;Examples&lt;/title&gt;
</span><p>
<span class="original">
   Insert a single row into table &lt;literal&gt;films&lt;/literal&gt;:
</span>
<code class="literal">films</code>テーブルに1行を挿入します。

</p><pre class="programlisting">
INSERT INTO films VALUES
    ('UA502', 'Bananas', 105, '1971-07-13', 'Comedy', '82 minutes');
</pre><p>
  </p><p>
<span class="original">
   In this example, the &lt;literal&gt;len&lt;/literal&gt; column is
   omitted and therefore it will have the default value:
</span>
次の例では、<code class="literal">len</code>列を省略しています。
したがって、ここにはデフォルト値が入ります。

</p><pre class="programlisting">
INSERT INTO films (code, title, did, date_prod, kind)
    VALUES ('T_601', 'Yojimbo', 106, '1961-06-16', 'Drama');
</pre><p>
  </p><p>
<span class="original">
   This example uses the &lt;literal&gt;DEFAULT&lt;/literal&gt; clause for
   the date columns rather than specifying a value:
</span>
次の例では、日付列に対して値を指定する代わりに<code class="literal">DEFAULT</code>を使用します。

</p><pre class="programlisting">
INSERT INTO films VALUES
    ('UA502', 'Bananas', 105, DEFAULT, 'Comedy', '82 minutes');
INSERT INTO films (code, title, did, date_prod, kind)
    VALUES ('T_601', 'Yojimbo', 106, DEFAULT, 'Drama');
</pre><p>
  </p><p>
<span class="original">
   To insert a row consisting entirely of default values:
</span>
全てデフォルト値からなる行を挿入します。

</p><pre class="programlisting">
INSERT INTO films DEFAULT VALUES;
</pre><p>
  </p><p>
<span class="original">
   To insert multiple rows using the multirow &lt;command&gt;VALUES&lt;/command&gt; syntax:
</span>
複数行の<code class="command">VALUES</code>構文を使用して複数行を挿入します。

</p><pre class="programlisting">
INSERT INTO films (code, title, did, date_prod, kind) VALUES
    ('B6717', 'Tampopo', 110, '1985-02-10', 'Comedy'),
    ('HG120', 'The Dinner Game', 140, DEFAULT, 'Comedy');
</pre><p>
  </p><p>
<span class="original">
   This example inserts some rows into table
   &lt;literal&gt;films&lt;/literal&gt; from a table &lt;literal&gt;tmp_films&lt;/literal&gt;
   with the same column layout as &lt;literal&gt;films&lt;/literal&gt;:
</span>
次の例では、<code class="literal">films</code>テーブルと同じ列レイアウトを持つ<code class="literal">tmp_films</code>テーブルから<code class="literal">films</code>テーブルへいくつか行を挿入します。

</p><pre class="programlisting">
INSERT INTO films SELECT * FROM tmp_films WHERE date_prod &lt; '2004-05-07';
</pre><p>
  </p><p>
<span class="original">
   This example inserts into array columns:
</span>
次の例では、配列型の列に挿入します。

</p><pre class="programlisting">
<span class="original">
&amp;#045;&amp;#045; Create an empty 3x3 gameboard for noughts-and-crosses
</span>
-- 三目並べ用の3×3マスのゲーム盤を作成します。
INSERT INTO tictactoe (game, board[1:3][1:3])
    VALUES (1, '{{" "," "," "},{" "," "," "},{" "," "," "}}');
<span class="original">
&amp;#045;&amp;#045; The subscripts in the above example aren't really needed
</span>
--上の例の添え字は本当は必要ありません。
INSERT INTO tictactoe (game, board)
    VALUES (2, '{{X," "," "},{" ",O," "},{" ",X," "}}');
</pre><p>
  </p><p>
<span class="original">
   Insert a single row into table &lt;literal&gt;distributors&lt;/literal&gt;, returning
   the sequence number generated by the &lt;literal&gt;DEFAULT&lt;/literal&gt; clause:
</span>
<code class="literal">distributors</code>テーブルに一行を挿入し、その<code class="literal">DEFAULT</code>句により生成されたシーケンス番号を返します。

</p><pre class="programlisting">
INSERT INTO distributors (did, dname) VALUES (DEFAULT, 'XYZ Widgets')
   RETURNING did;
</pre><p>
  </p><p>
<span class="original">
   Increment the sales count of the salesperson who manages the
   account for Acme Corporation, and record the whole updated row
   along with current time in a log table:
</span>
Acme社の顧客を担当する営業担当者の売り上げ数を増やし、ログテーブルに更新行全体と更新時刻を記録します。
</p><pre class="programlisting">
WITH upd AS (
  UPDATE employees SET sales_count = sales_count + 1 WHERE id =
    (SELECT sales_person FROM accounts WHERE name = 'Acme Corporation')
    RETURNING *
)
INSERT INTO employees_log SELECT *, current_timestamp FROM upd;
</pre><p>
  </p><p>
<span class="original">
   Insert or update new distributors as appropriate.  Assumes a unique
   index has been defined that constrains values appearing in the
   &lt;literal&gt;did&lt;/literal&gt; column.  Note that the special
   &lt;varname&gt;excluded&lt;/varname&gt; table is used to reference values originally
   proposed for insertion:
</span>
新しい販売店(distributors)を適切に挿入または更新します。
<code class="literal">did</code>列に現れる値を制限する一意インデックスが定義されているものとします。
元々挿入されようとしていた値を参照するために、特別な<code class="varname">excluded</code>テーブルが使用されていることに注意して下さい。
</p><pre class="programlisting">
INSERT INTO distributors (did, dname)
    VALUES (5, 'Gizmo Transglobal'), (6, 'Associated Computing, Inc')
    ON CONFLICT (did) DO UPDATE SET dname = EXCLUDED.dname;
</pre><p>
  </p><p>
<span class="original">
   Insert a distributor, or do nothing for rows proposed for insertion
   when an existing, excluded row (a row with a matching constrained
   column or columns after before row insert triggers fire) exists.
   Example assumes a unique index has been defined that constrains
   values appearing in the &lt;literal&gt;did&lt;/literal&gt; column:
</span>
販売店を挿入するか、あるいは挿入しようとした行について既存の除外行（before insertの行トリガを実行した後で制約列にマッチした行）がある場合は何もしません。
例では<code class="literal">did</code>列に現れる値を制限する一意インデックスがあるものとしています。
</p><pre class="programlisting">
INSERT INTO distributors (did, dname) VALUES (7, 'Redline GmbH')
    ON CONFLICT (did) DO NOTHING;
</pre><p>
  </p><p>
<span class="original">
   Insert or update new distributors as appropriate.  Example assumes
   a unique index has been defined that constrains values appearing in
   the &lt;literal&gt;did&lt;/literal&gt; column.  &lt;literal&gt;WHERE&lt;/literal&gt; clause is
   used to limit the rows actually updated (any existing row not
   updated will still be locked, though):
</span>
新しい販売店を適切に挿入または更新します。
例では<code class="literal">did</code>列に現れる値を制限する一意インデックスがあるものとしています。
実際に更新される行を制限するために<code class="literal">WHERE</code>句が使われています（ただし、更新されない既存の行もすべてロックされます）。
</p><pre class="programlisting">
<span class="original">
&amp;#045;- Don't update existing distributors based in a certain ZIP code
</span>
-- 特定の郵便番号については既存の販売店を更新しません
INSERT INTO distributors AS d (did, dname) VALUES (8, 'Anvil Distribution')
    ON CONFLICT (did) DO UPDATE
    SET dname = EXCLUDED.dname || ' (formerly ' || d.dname || ')'
    WHERE d.zipcode &lt;&gt; '21201';

<span class="original">
&amp;#045;- Name a constraint directly in the statement (uses associated
&amp;#045;- index to arbitrate taking the DO NOTHING action)
</span>
-- 文中で制約を直接指定します（DO NOTHINGの動作をする競合解決のため
-- 関連するインデックスを指定します）
INSERT INTO distributors (did, dname) VALUES (9, 'Antwerp Design')
    ON CONFLICT ON CONSTRAINT distributors_pkey DO NOTHING;
</pre><p>
  </p><p>
<span class="original">
   Insert new distributor if possible;  otherwise
   &lt;literal&gt;DO NOTHING&lt;/literal&gt;.  Example assumes a unique index has been
   defined that constrains values appearing in the
   &lt;literal&gt;did&lt;/literal&gt; column on a subset of rows where the
   &lt;literal&gt;is_active&lt;/literal&gt; Boolean column evaluates to
   &lt;literal&gt;true&lt;/literal&gt;:
</span>
可能であれば新しい販売店を挿入しますが、できないときは<code class="literal">DO NOTHING</code>とします。
この例では、<code class="literal">is_active</code>というブーリアン列が<code class="literal">true</code>である行という条件で、<code class="literal">did</code>列に一意インデックスが定義されているものとしています。
</p><pre class="programlisting">
<span class="original">
&amp;#045;- This statement could infer a partial unique index on "did"
&amp;#045;- with a predicate of "WHERE is_active", but it could also
&amp;#045;- just use a regular unique constraint on "did"
</span>
-- この文は"WHERE is_active"という述語を使って、部分インデックスを
-- 推定できますが、単に"did"上の通常の一意制約を使うこともできます
INSERT INTO distributors (did, dname) VALUES (10, 'Conrad International')
    ON CONFLICT (did) WHERE is_active DO NOTHING;
</pre></div><div class="refsect1" id="id-1.9.3.152.10"><h2>
互換性
  </h2><span class="original">
  &lt;title&gt;Compatibility&lt;/title&gt;
</span><p>
<span class="original">
   &lt;command&gt;INSERT&lt;/command&gt; conforms to the SQL standard, except that
   the &lt;literal&gt;RETURNING&lt;/literal&gt; clause is a
   &lt;productname&gt;PostgreSQL&lt;/productname&gt; extension, as is the ability
   to use &lt;literal&gt;WITH&lt;/literal&gt; with &lt;command&gt;INSERT&lt;/command&gt;, and the ability to
   specify an alternative action with &lt;literal&gt;ON CONFLICT&lt;/literal&gt;.
   Also, the case in
   which a column name list is omitted, but not all the columns are
   filled from the &lt;literal&gt;VALUES&lt;/literal&gt; clause or &lt;replaceable&gt;query&lt;/replaceable&gt;,
   is disallowed by the standard.
</span>
<code class="command">INSERT</code>は標準SQLに準拠します。
ただし、<code class="literal">RETURNING</code>句、<code class="command">INSERT</code>で<code class="literal">WITH</code>が可能であること、<code class="literal">ON CONFLICT</code>で代替の動作を指定できることは<span class="productname">PostgreSQL</span>の拡張です。
また、標準SQLでは、列名リストが省略された時に、<code class="literal">VALUES</code>句または<em class="replaceable"><code>query</code></em>で一部の列のみを指定することはできません。
  </p><p>
<span class="original">
   The SQL standard specifies that &lt;literal&gt;OVERRIDING SYSTEM VALUE&lt;/literal&gt;
   can only be specified if an identity column that is generated always
   exists.  PostgreSQL allows the clause in any case and ignores it if it is
   not applicable.
</span>
標準SQLでは、必ず値を生成するIDENTITY列が存在する場合にのみ<code class="literal">OVERRIDING SYSTEM VALUE</code>を指定できるとしています。
PostgreSQLではこの句はどのような場合でも指定でき、それが適用できないときには無視します。
  </p><p>
<span class="original">
   Possible limitations of the &lt;replaceable
   class="parameter"&gt;query&lt;/replaceable&gt; clause are documented under
   &lt;xref linkend="sql-select"/&gt;.
</span>
<em class="replaceable"><code>query</code></em>句の制限については、<a class="xref" href="sql-select.html" title="SELECT"><span class="refentrytitle">SELECT</span></a>にて記述されています。
  </p></div></div><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter"><hr></hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-importforeignschema.html" title="IMPORT FOREIGN SCHEMA">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="sql-commands.html" title="SQLコマンド">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="sql-listen.html" title="LISTEN">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">IMPORT FOREIGN SCHEMA </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 14.0文書">ホーム</a></td><td width="40%" align="right" valign="top"> LISTEN</td></tr></table></div></body></html>