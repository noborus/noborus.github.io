<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>20.5. ログ先行書き込み（WAL）</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="runtime-config-resource.html" title="20.4. 資源の消費" /><link rel="next" href="runtime-config-replication.html" title="20.6. レプリケーション" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="4" align="center"><a accesskey="h" href="index.html">PostgreSQL 16.0文書</a></th></tr><tr><td width="10%" align="left"></td><td width="10%" align="left"></td><td width="60%" align="center"><a href="runtime-config.html" title="第20章 サーバの設定">第20章 サーバの設定</a></td><td width="20%" align="right"></td></tr><tr><td width="10%" align="left"><a accesskey="p" href="runtime-config-resource.html" title="20.4. 資源の消費">前へ</a> </td><td width="10%" align="left"><a accesskey="u" href="runtime-config.html" title="第20章 サーバの設定">上へ</a></td><td width="60%" align="center">20.5. ログ先行書き込み（WAL）</td><td width="20%" align="right"> <a accesskey="n" href="runtime-config-replication.html" title="20.6. レプリケーション">次へ</a></td></tr></table><hr /></div><div class="sect1" id="RUNTIME-CONFIG-WAL"><div class="titlepage"><div><div><h2 class="title" style="clear: both">20.5. ログ先行書き込み（WAL） <a href="#RUNTIME-CONFIG-WAL" class="id_link">#</a></h2></div></div></div><!--
    <title>Write Ahead Log</title>
--><p>
<!--
    For additional information on tuning these settings,
    see <xref linkend="wal-configuration"/>.
-->
これらの設定をチューニングする追加情報は<a class="xref" href="wal-configuration.html" title="30.5. WALの設定">30.5</a>を参照してください。
   </p><div class="sect2" id="RUNTIME-CONFIG-WAL-SETTINGS"><div class="titlepage"><div><div><h3 class="title">20.5.1. 諸設定 <a href="#RUNTIME-CONFIG-WAL-SETTINGS" class="id_link">#</a></h3></div></div></div><!--
     <title>Settings</title>
--><div class="variablelist"><dl class="variablelist"><dt id="GUC-WAL-LEVEL"><span class="term"><code class="varname">wal_level</code> (<code class="type">enum</code>)
      <a id="id-1.6.7.9.3.2.1.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.3.2.1.1.4" class="indexterm"></a>
      </span> <a href="#GUC-WAL-LEVEL" class="id_link">#</a></dt><dd><p>
<!--
        <varname>wal_level</varname> determines how much information is written to
        the WAL. The default value is <literal>replica</literal>, which writes enough
        data to support WAL archiving and replication, including running
        read-only queries on a standby server. <literal>minimal</literal> removes all
        logging except the information required to recover from a crash or
        immediate shutdown.  Finally,
        <literal>logical</literal> adds information necessary to support logical
        decoding.  Each level includes the information logged at all lower
        levels.  This parameter can only be set at server start.
-->
<code class="varname">wal_level</code>はどれだけの情報がWALに書かれるかを決定します。
デフォルト値は<code class="literal">replica</code>で、WALアーカイビングおよびレプリケーションをサポートするために十分なデータを書き出し、これにはスタンバイサーバで読み取り専用の問い合わせを実行することも含みます。
<code class="literal">minimal</code>はクラッシュまたは即時停止から回復するのに必要な情報を除き、すべてのログを削除します。
最後に、<code class="literal">logical</code>は、更にロジカルデコーディングをサポートするのに必要な情報を追加します。
それぞれのレベルは、下位のレベルのログ出力を含んでいます。
このパラメータはサーバ起動時のみ設定可能です。
       </p><p>
<!--
        The <literal>minimal</literal> level generates the least WAL
        volume.  It logs no row information for permanent relations
        in transactions that create or
        rewrite them.  This can make operations much faster (see
        <xref linkend="populate-pitr"/>).  Operations that initiate this
        optimization include:
-->
<code class="literal">minimal</code>レベルでは、最小限のWALの量しか生成されません。
永続リレーションを作成あるいは書き換えるトランザクションの差分に関する情報は記録されません。
これにより、それらの操作が大幅に高速になります（<a class="xref" href="populate.html#POPULATE-PITR" title="14.4.7. WALアーカイブ処理とストリーミングレプリケーションの無効化">14.4.7</a>を参照してください）。
この最適化が適用される操作には以下のものがあげられます。
        </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="command">ALTER ... SET TABLESPACE</code></td></tr><tr><td><code class="command">CLUSTER</code></td></tr><tr><td><code class="command">CREATE TABLE</code></td></tr><tr><td><code class="command">REFRESH MATERIALIZED VIEW</code>
<!--
         (without <option>CONCURRENTLY</option>)</member>
-->
         (<code class="option">CONCURRENTLY</code>なし)</td></tr><tr><td><code class="command">REINDEX</code></td></tr><tr><td><code class="command">TRUNCATE</code></td></tr></table><p>
<!--
        However, minimal WAL does not contain sufficient information for
        point-in-time recovery, so <literal>replica</literal> or
        higher must be used to enable continuous archiving
        (<xref linkend="guc-archive-mode"/>) and streaming binary replication.
        In fact, the server will not even start in this mode if
        <varname>max_wal_senders</varname> is non-zero.
        Note that changing <varname>wal_level</varname> to
        <literal>minimal</literal> makes previous base backups unusable
        for point-in-time recovery and standby servers.
-->
しかし、minimal WALにはポイントインタイムリカバリのための十分な情報が含まれていないので、<code class="literal">replica</code>以上を使って継続的アーカイブ(<a class="xref" href="runtime-config-wal.html#GUC-ARCHIVE-MODE">archive_mode</a>)とストリーミングバイナリレプリケーションを可能にしなければなりません。
実際、<code class="varname">max_wal_senders</code>が0以外の場合、サーバはこのモードで起動することさえありません。
<code class="varname">wal_level</code>を<code class="literal">minimal</code>に変更すると、以前のベースバックアップがポイントインタイムリカバリとスタンバイサーバで使用できなくなることに注意してください。
       </p><p>
<!--
        In <literal>logical</literal> level, the same information is logged as
        with <literal>replica</literal>, plus information needed to
        extract logical change sets from the WAL. Using a level of
        <literal>logical</literal> will increase the WAL volume, particularly if many
        tables are configured for <literal>REPLICA IDENTITY FULL</literal> and
        many <command>UPDATE</command> and <command>DELETE</command> statements are
        executed.
-->
<code class="literal">logical</code>レベルでは、<code class="literal">replica</code>と同じ情報が記録されるのに加え、ロジカルチェンジセットをWALから取り出すのに必要な情報が追加されます。
<code class="literal">logical</code>を使うとWALの量が増えます。
とりわけ、多数のテーブルが<code class="literal">REPLICA IDENTITY FULL</code>と設定されていて(訳注: ALTER TABLE参照)、多くの<code class="command">UPDATE</code>と<code class="command">DELETE</code>文が実行される場合はこのことが言えます。
       </p><p>
<!--
        In releases prior to 9.6, this parameter also allowed the
        values <literal>archive</literal> and <literal>hot_standby</literal>.
        These are still accepted but mapped to <literal>replica</literal>.
-->
9.6よりも前のリリースでは、このパラメータは<code class="literal">archive</code>と<code class="literal">hot_standby</code>という設定値も可能でした。
引き続きこれらも受け付けられますが、<code class="literal">replica</code>へとマップされます。
       </p></dd><dt id="GUC-FSYNC"><span class="term"><code class="varname">fsync</code> (<code class="type">boolean</code>)
      <a id="id-1.6.7.9.3.2.2.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.3.2.2.1.4" class="indexterm"></a>
      </span> <a href="#GUC-FSYNC" class="id_link">#</a></dt><dd><p>
<!--
        If this parameter is on, the <productname>PostgreSQL</productname> server
        will try to make sure that updates are physically written to
        disk, by issuing <function>fsync()</function> system calls or various
        equivalent methods (see <xref linkend="guc-wal-sync-method"/>).
        This ensures that the database cluster can recover to a
        consistent state after an operating system or hardware crash.
-->
このパラメータがオンの場合、<span class="productname">PostgreSQL</span>サーバは<code class="function">fsync()</code>システムコールを発行するか、もしくはこれに相当する方法（<a class="xref" href="runtime-config-wal.html#GUC-WAL-SYNC-METHOD">wal_sync_method</a>を参照）で、更新が物理的にディスクに確実に書き込まれるように試みます。
これは、オペレーティングシステムもしくはハードウェアがクラッシュした後、データベースクラスタを一貫した状態に復旧させることを確実にします。
       </p><p>
<!--
        While turning off <varname>fsync</varname> is often a performance
        benefit, this can result in unrecoverable data corruption in
        the event of a power failure or system crash.  Thus it
        is only advisable to turn off <varname>fsync</varname> if
        you can easily recreate your entire database from external
        data.
-->
<code class="varname">fsync</code>を停止することはしばしば性能上の利益になるとは言っても、停電やクラッシュの際に回復不可能なデータ破壊になることがあります。
従って外部データから全てのデータベースを簡単に再構築できる場合のみ<code class="varname">fsync</code>を停止してください。
       </p><p>
<!--
        Examples of safe circumstances for turning off
        <varname>fsync</varname> include the initial loading of a new
        database cluster from a backup file, using a database cluster
        for processing a batch of data after which the database
        will be thrown away and recreated,
        or for a read-only database clone which
        gets recreated frequently and is not used for failover.  High
        quality hardware alone is not a sufficient justification for
        turning off <varname>fsync</varname>.
-->
<code class="varname">fsync</code>を停止しても安全な状況の例としては、以下があげられます。
バックアップファイルから新しいデータベースクラスタにデータの初期読み込みを行う場合、バッチデータの処理のためにデータベースクラスタを使用し、その後データベースを削除して再構築する場合、読み込み専用のデータベースのクローンを頻繁に再作成するが、それをフェイルオーバーに使用しない場合、などです。
高性能なハードウェアであるからと言って、<code class="varname">fsync</code>を停止することは正当性を主張する十分な理由とはなりません。
       </p><p>
<!--
        For reliable recovery when changing <varname>fsync</varname>
        off to on, it is necessary to force all modified buffers in the
        kernel to durable storage.  This can be done while the cluster
        is shutdown or while <varname>fsync</varname> is on by running <command>initdb
        &#45;-sync-only</command>, running <command>sync</command>, unmounting the
        file system, or rebooting the server.
-->
<code class="varname">fsync</code>を無効(off)から有効(on)に変更したときの信頼できるリカバリのためには、カーネル内の全ての変更されたバッファを恒久的ストレージに強制的に吐き出させることが必要です。
これは、クラスタがシャットダウンしている間、または<code class="varname">fsync</code>が有効のときに、<code class="command">initdb --sync-only</code>を実行する、<code class="command">sync</code>を実行する、ファイルシステムをアンマウントする、またはサーバを再起動することによって可能となります。
       </p><p>
<!--
        In many situations, turning off <xref linkend="guc-synchronous-commit"/>
        for noncritical transactions can provide much of the potential
        performance benefit of turning off <varname>fsync</varname>, without
        the attendant risks of data corruption.
-->
多くの場合、重要でないトランザクションに対して<a class="xref" href="runtime-config-wal.html#GUC-SYNCHRONOUS-COMMIT">synchronous_commit</a>を無効にすることにより、データ破壊という付随的危険性を伴うことなく、<code class="varname">fsync</code>を無効にすることで得られるであろう性能上のメリットの多くを得ることができます。
       </p><p>
<!--
        <varname>fsync</varname> can only be set in the <filename>postgresql.conf</filename>
        file or on the server command line.
        If you turn this parameter off, also consider turning off
        <xref linkend="guc-full-page-writes"/>.
-->
<code class="varname">fsync</code> は<code class="filename">postgresql.conf</code>ファイル、または、サーバのコマンドラインでのみ設定可能です。
このパラメータを無効にする場合、<a class="xref" href="runtime-config-wal.html#GUC-FULL-PAGE-WRITES">full_page_writes</a>も同時に無効にすることを検討してください。
       </p></dd><dt id="GUC-SYNCHRONOUS-COMMIT"><span class="term"><code class="varname">synchronous_commit</code> (<code class="type">enum</code>)
      <a id="id-1.6.7.9.3.2.3.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.3.2.3.1.4" class="indexterm"></a>
      </span> <a href="#GUC-SYNCHRONOUS-COMMIT" class="id_link">#</a></dt><dd><p>
<!--
        Specifies how much WAL processing must complete before
        the database server returns a <quote>success</quote>
        indication to the client.  Valid values are
        <literal>remote_apply</literal>, <literal>on</literal>
        (the default), <literal>remote_write</literal>,
        <literal>local</literal>, and <literal>off</literal>.
-->
トランザクションのコミットがクライアントに<span class="quote">「<span class="quote">成功</span>」</span>の報告を返す前に、どれだけのWAL処理を完了しなければならないかを指定をします。
有効な値は<code class="literal">remote_apply</code>、<code class="literal">on</code>(デフォルト)、<code class="literal">remote_write</code>、<code class="literal">local</code>、<code class="literal">off</code>です。
       </p><p>
<!--
        If <varname>synchronous_standby_names</varname> is empty,
        the only meaningful settings are <literal>on</literal> and
        <literal>off</literal>;  <literal>remote_apply</literal>,
        <literal>remote_write</literal> and <literal>local</literal>
        all provide the same local synchronization level
        as <literal>on</literal>.  The local behavior of all
        non-<literal>off</literal> modes is to wait for local flush of WAL
        to disk.  In <literal>off</literal> mode, there is no waiting,
        so there can be a delay between when success is reported to the
        client and when the transaction is later guaranteed to be safe
        against a server crash.  (The maximum
        delay is three times <xref linkend="guc-wal-writer-delay"/>.)  Unlike
        <xref linkend="guc-fsync"/>, setting this parameter to <literal>off</literal>
        does not create any risk of database inconsistency: an operating
        system or database crash might
        result in some recent allegedly-committed transactions being lost, but
        the database state will be just the same as if those transactions had
        been aborted cleanly.  So, turning <varname>synchronous_commit</varname> off
        can be a useful alternative when performance is more important than
        exact certainty about the durability of a transaction.  For more
        discussion see <xref linkend="wal-async-commit"/>.
-->
<code class="varname">synchronous_standby_names</code>が空文字なら、意味のある設定は<code class="literal">on</code>と<code class="literal">off</code>だけです。
<code class="literal">remote_apply</code>、<code class="literal">remote_write</code>、<code class="literal">local</code>はすべて<code class="literal">on</code>と同じ同期レベルを提供します。
<code class="literal">off</code>モード以外のローカルの振る舞いは、WALがディスクにローカルにフラッシュされるのを待ちます。
<code class="literal">off</code>モードでは待ちはありません。
ですから、クライアントに成功が報告されてから、トランザクションが後でサーバクラッシュに対して安全が保証されるまでの間に遅延が生じる可能性があります。
（遅延は最大で<a class="xref" href="runtime-config-wal.html#GUC-WAL-WRITER-DELAY">wal_writer_delay</a>の3倍です。）
<a class="xref" href="runtime-config-wal.html#GUC-FSYNC">fsync</a>と違って、このパラメータを<code class="literal">off</code>にすることでデータベースの一貫性が損なわれるリスクはありません。
オペレーティングシステムやデータベースのクラッシュにより最近コミットされたということになっているトランザクションの一部が失われる可能性がありますが、これらのトランザクションが正常にアボートされた時とデータベースの状態は変わりません。
したがって、<code class="varname">synchronous_commit</code>のオフによる調整は、トランザクションの耐障害性を確実にするよりも性能が重要な場合の有用な代替案となるかも知れません。
詳細は<a class="xref" href="wal-async-commit.html" title="30.4. 非同期コミット">30.4</a>を参照してください。
       </p><p>
<!--
        If <xref linkend="guc-synchronous-standby-names"/> is non-empty,
        <varname>synchronous_commit</varname> also controls whether
        transaction commits will wait for their WAL records to be
        processed on the standby server(s).
-->
<a class="xref" href="runtime-config-replication.html#GUC-SYNCHRONOUS-STANDBY-NAMES">synchronous_standby_names</a>が空文字でない場合は、<code class="varname">synchronous_commit</code>は、WALレコードが、スタンバイサーバに複製されるまでトランザクションコミットを待機するか否かも制御します。
       </p><p>
<!--
        When set to <literal>remote_apply</literal>, commits will wait
        until replies from the current synchronous standby(s) indicate they
        have received the commit record of the transaction and applied
        it, so that it has become visible to queries on the standby(s),
        and also written to durable storage on the standbys.  This will
        cause much larger commit delays than previous settings since
        it waits for WAL replay.  When set to <literal>on</literal>,
        commits wait until replies
        from the current synchronous standby(s) indicate they have received
        the commit record of the transaction and flushed it to durable storage.  This
        ensures the transaction will not be lost unless both the primary and
        all synchronous standbys suffer corruption of their database storage.
        When set to <literal>remote_write</literal>, commits will wait until replies
        from the current synchronous standby(s) indicate they have
        received the commit record of the transaction and written it to
        their file systems. This setting ensures data preservation if a standby instance of
        <productname>PostgreSQL</productname> crashes, but not if the standby
        suffers an operating-system-level crash because the data has not
        necessarily reached durable storage on the standby.
        The setting <literal>local</literal> causes commits to wait for
        local flush to disk, but not for replication.  This is usually not
        desirable when synchronous replication is in use, but is provided for
        completeness.
-->
<code class="literal">remote_apply</code>に設定すると、現在の同期スタンバイがトランザクションのコミットレコードを受け取って適用し、スタンバイ上で発行されたクエリから見えるようになり、スタンバイ上の永続的な記憶装置に書き込まれたことを報告するまでコミットは待機します。
WALのリプレイを待つので、今までの設定に比べるとこの設定によってずっと大きなコミットの遅延が発生します。
<code class="literal">on</code>に設定すると、現在の同期スタンバイがトランザクションのコミットレコードを受け取り、永続的な記憶装置にフラッシュしたことを報告するまでコミットは待機します。
このモードでは、プライマリおよびすべての同期スタンバイがデータベース記憶装置の故障を被った場合を除いて、トランザクションが失われないことが保証されます。
<code class="literal">remote_write</code>に設定すると、現在の同期スタンバイがトランザクションのコミットレコードを受け取り、スタンバイのファイルシステムに書き出したことを報告するまでコミットは待機します。
この設定は仮に<span class="productname">PostgreSQL</span>のスタンバイインスタンスがクラッシュしたとしても、データ保護を保証するのに充分です。
しかし、スタンバイがオペレーティングシステムのレベルでクラッシュした場合はこの限りではありません。
データが必ずしもスタンバイの永続的な記憶装置に到達したとは言えないからです。
最後に、<code class="literal">local</code>設定は、コミットがローカルにディスクにフラッシュされるまで待機しますが、レプリケーションされるまでは待機しません。
これは通常同期レプリケーションが使用されている場合は望ましい設定ではありませんが、完全さのために提供されています。
       </p><p>
<!--
        This parameter can be changed at any time; the behavior for any
        one transaction is determined by the setting in effect when it
        commits.  It is therefore possible, and useful, to have some
        transactions commit synchronously and others asynchronously.
        For example, to make a single multistatement transaction commit
        asynchronously when the default is the opposite, issue <command>SET
        LOCAL synchronous_commit TO OFF</command> within the transaction.
-->
このパラメータはいつでも変更可能です。
どのトランザクションの動作も、コミット時に有効であった設定によって決まります。
したがって、一部のトランザクションのコミットを同期的に、その他を非同期的にすることが可能で、かつ、有用です。
例えば、デフォルトが同期コミットの場合に複数文トランザクションを一つだけ非同期にコミットさせるためには、トランザクション内で<code class="command">SET LOCAL synchronous_commit TO OFF</code>を発行します。
       </p><p>
<!--
        <xref linkend="synchronous-commit-matrix"/> summarizes the
        capabilities of the <varname>synchronous_commit</varname> settings.
-->
<code class="varname">synchronous_commit</code>設定の機能のまとめが<a class="xref" href="runtime-config-wal.html#SYNCHRONOUS-COMMIT-MATRIX" title="表20.1 synchronous_commitモード">表 20.1</a>にあります。
       </p><div class="table" id="SYNCHRONOUS-COMMIT-MATRIX"><p class="title"><strong>表20.1 synchronous_commitモード</strong></p><div class="table-contents"><!--
        <title>synchronous_commit Modes</title>
--><table class="table" summary="synchronous_commitモード" border="1"><colgroup><col class="col1" /><col class="col2" /><col class="col3" /><col class="col4" /><col class="col5" /></colgroup><thead><tr><th>synchronous_commit設定</th><th>localの永続的なコミット</th><th>PGがクラッシュした後のスタンバイの永続的なコミット</th><th>OSがクラッシュした後のスタンバイの永続的なコミット</th><th>スタンバイのクエリの一貫性</th></tr></thead><tbody><tr><td>remote_apply</td><td align="center">•</td><td align="center">•</td><td align="center">•</td><td align="center">•</td></tr><tr><td>on</td><td align="center">•</td><td align="center">•</td><td align="center">•</td><td align="center"> </td></tr><tr><td>remote_write</td><td align="center">•</td><td align="center">•</td><td align="center"> </td><td align="center"> </td></tr><tr><td>local</td><td align="center">•</td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td>off</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr></tbody></table></div></div><br class="table-break" /></dd><dt id="GUC-WAL-SYNC-METHOD"><span class="term"><code class="varname">wal_sync_method</code> (<code class="type">enum</code>)
      <a id="id-1.6.7.9.3.2.4.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.3.2.4.1.4" class="indexterm"></a>
      </span> <a href="#GUC-WAL-SYNC-METHOD" class="id_link">#</a></dt><dd><p>
<!--
        Method used for forcing WAL updates out to disk.
        If <varname>fsync</varname> is off then this setting is irrelevant,
        since WAL file updates will not be forced out at all.
        Possible values are:
-->
WALの更新をディスクへ強制するのに使用される方法です。
<code class="varname">fsync</code>がオフの場合この設定は役に立ちません。と言うのはWALファイルの更新が全く強制されないからです。取り得る値は以下のものです。
       </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
<!--
         <literal>open_datasync</literal> (write WAL files with <function>open()</function> option <symbol>O_DSYNC</symbol>)
-->
<code class="literal">open_datasync</code>（<code class="function">open()</code>のオプション<code class="symbol">O_DSYNC</code>でWALファイルに書き込む）
        </p></li><li class="listitem"><p>
<!--
         <literal>fdatasync</literal> (call <function>fdatasync()</function> at each commit)
-->
<code class="literal">fdatasync</code>（コミット毎に<code class="function">fdatasync()</code>を呼び出す）
        </p></li><li class="listitem"><p>
<!--
         <literal>fsync</literal> (call <function>fsync()</function> at each commit)
-->
<code class="literal">fsync</code>（コミット毎に<code class="function">fsync()</code>を呼び出す）
        </p></li><li class="listitem"><p>
<!--
         <literal>fsync_writethrough</literal> (call <function>fsync()</function> at each commit, forcing write-through of any disk write cache)
-->
<code class="literal">fsync_writethrough</code>（すべてのディスク書き込みキャッシュをライトスルーさせるため、コミット毎に<code class="function">fsync()</code>を呼び出す）
        </p></li><li class="listitem"><p>
<!--
         <literal>open_sync</literal> (write WAL files with <function>open()</function> option <symbol>O_SYNC</symbol>)
-->
<code class="literal">open_sync</code>（<code class="function">open()</code>のオプション<code class="symbol">O_SYNC</code>でWALファイルに書き込む）
        </p></li></ul></div><p>
<!--
        Not all of these choices are available on all platforms.
        The default is the first method in the above list that is supported
        by the platform, except that <literal>fdatasync</literal> is the default on
        Linux and FreeBSD.  The default is not necessarily ideal; it might be
        necessary to change this setting or other aspects of your system
        configuration in order to create a crash-safe configuration or
        achieve optimal performance.
        These aspects are discussed in <xref linkend="wal-reliability"/>.
        This parameter can only be set in the <filename>postgresql.conf</filename>
        file or on the server command line.
-->
全てのプラットフォームでこれら全ての選択肢が使えるわけではありません。
デフォルトは、上のリストのプラットフォームでサポートされるものの最初に列挙されているものです。
ただしLinuxとFreeBSDでは<code class="literal">fdatasync</code>がデフォルトです。
デフォルトは必ずしも理想的なものではありません。
クラッシュに適応した構成にする、あるいはアーカイブの最適性能を導くためには、この設定あるいはシステム構成の他の部分を変更することが必要かもしれません。
これらの側面は <a class="xref" href="wal-reliability.html" title="30.1. 信頼性">30.1</a>で解説されます。
このパラメータは<code class="filename">postgresql.conf</code>ファイル、または、サーバのコマンドラインでのみで設定可能です。
       </p></dd><dt id="GUC-FULL-PAGE-WRITES"><span class="term"><code class="varname">full_page_writes</code> (<code class="type">boolean</code>)
      <a id="id-1.6.7.9.3.2.5.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.3.2.5.1.4" class="indexterm"></a>
      </span> <a href="#GUC-FULL-PAGE-WRITES" class="id_link">#</a></dt><dd><p>
<!--
        When this parameter is on, the <productname>PostgreSQL</productname> server
        writes the entire content of each disk page to WAL during the
        first modification of that page after a checkpoint.
        This is needed because
        a page write that is in process during an operating system crash might
        be only partially completed, leading to an on-disk page
        that contains a mix of old and new data.  The row-level change data
        normally stored in WAL will not be enough to completely restore
        such a page during post-crash recovery.  Storing the full page image
        guarantees that the page can be correctly restored, but at the price
        of increasing the amount of data that must be written to WAL.
        (Because WAL replay always starts from a checkpoint, it is sufficient
        to do this during the first change of each page after a checkpoint.
        Therefore, one way to reduce the cost of full-page writes is to
        increase the checkpoint interval parameters.)
-->
このパラメータが有効の場合、<span class="productname">PostgreSQL</span>サーバは、チェックポイントの後にそのページが最初に変更された過程で、ディスクページの全ての内容をWALに書き込みます。
オペレーティングシステムがクラッシュした時に進行中のページ書き込みは途中までしか終わっていない可能性があり、ディスク上のページが古いデータと新しいデータが混在する状態になるため、この機能が必要です。
通常WAL内に保存される行レベルの変更データは、クラッシュ後のリカバリ時にこうしたページを完全に復旧させるには不十分です。
完全なページイメージを保存することにより、ページを正しく復旧できることを保証しますが、その代わりに、WALに書き込まなければならないデータ量が増加することになります。
（WAL再生は常にチェックポイントから始まるため、チェックポイント後のそれぞれのページの最初の変更時にこれを行えば十分です。
従って、完全ページ書き出しのコストを低減する方法の1つは、チェックポイント間隔パラメータを大きくすることです。）
       </p><p>
<!--
        Turning this parameter off speeds normal operation, but
        might lead to either unrecoverable data corruption, or silent
        data corruption, after a system failure. The risks are similar to turning off
        <varname>fsync</varname>, though smaller, and it should be turned off
        only based on the same circumstances recommended for that parameter.
-->
このパラメータを無効にすると、通常の操作速度が上がりますが、システム障害後に、回復不能なデータ破損、あるいは警告なしのデータ損壊をもたらすかもしれません。
このリスクは小さいながら<code class="varname">fsync</code>を無効にした場合と似ています。そしてその<code class="varname">fsync</code>に対して推奨されている同一の状況に基づく限りにおいて停止されなければなりません。
       </p><p>
<!--
        Turning off this parameter does not affect use of
        WAL archiving for point-in-time recovery (PITR)
        (see <xref linkend="continuous-archiving"/>).
-->
このパラメータを無効にしてもポイントインタイムリカバリ（PITR）用のWALアーカイブの使用に影響ありません（ <a class="xref" href="continuous-archiving.html" title="26.3. 継続的アーカイブとポイントインタイムリカバリ（PITR）">26.3</a>を参照してください）。
       </p><p>
<!--
        This parameter can only be set in the <filename>postgresql.conf</filename>
        file or on the server command line.
        The default is <literal>on</literal>.
-->
このパラメータは<code class="filename">postgresql.conf</code>ファイル内、またはサーバのコマンドラインのみで設定可能です。
デフォルトは<code class="literal">on</code>です。
       </p></dd><dt id="GUC-WAL-LOG-HINTS"><span class="term"><code class="varname">wal_log_hints</code> (<code class="type">boolean</code>)
      <a id="id-1.6.7.9.3.2.6.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.3.2.6.1.4" class="indexterm"></a>
      </span> <a href="#GUC-WAL-LOG-HINTS" class="id_link">#</a></dt><dd><p>
<!--
        When this parameter is <literal>on</literal>, the <productname>PostgreSQL</productname>
        server writes the entire content of each disk page to WAL during the
        first modification of that page after a checkpoint, even for
        non-critical modifications of so-called hint bits.
-->
このパラメータが<code class="literal">on</code>の場合、<span class="productname">PostgreSQL</span>サーバはチェックポイント後にはじめてページを変更する際に、ディスクページの全内容をWALに書き出します。
これは、あまり重要でない、ヒントビットと呼ばれるものに対する変更にさえ当てはまります。
       </p><p>
<!--
        If data checksums are enabled, hint bit updates are always WAL-logged
        and this setting is ignored. You can use this setting to test how much
        extra WAL-logging would occur if your database had data checksums
        enabled.
-->
データチェックサムが有効であると、ヒントビットの更新は常にWALにログされ、この設定パラメータは無視されます。この設定パラメータを使って、データチェックサムが有効なときにどれだけのWALログは余計に書きだされるかをテストすることができます。
       </p><p>
<!--
        This parameter can only be set at server start. The default value is <literal>off</literal>.
-->
このパラメータはサーバ起動時のみ設定可能です。
デフォルト値は<code class="literal">off</code>です。
       </p></dd><dt id="GUC-WAL-COMPRESSION"><span class="term"><code class="varname">wal_compression</code> (<code class="type">enum</code>)
      <a id="id-1.6.7.9.3.2.7.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.3.2.7.1.4" class="indexterm"></a>
      </span> <a href="#GUC-WAL-COMPRESSION" class="id_link">#</a></dt><dd><p>
<!--
        This parameter enables compression of WAL using the specified
        compression method.
        When enabled, the <productname>PostgreSQL</productname>
        server compresses full page images written to WAL when
        <xref linkend="guc-full-page-writes"/> is on or during a base backup.
        A compressed page image will be decompressed during WAL replay.
        The supported methods are <literal>pglz</literal>,
        <literal>lz4</literal> (if <productname>PostgreSQL</productname>
        was compiled with <option>&#45;-with-lz4</option>) and
        <literal>zstd</literal> (if <productname>PostgreSQL</productname>
        was compiled with <option>&#45;-with-zstd</option>).
        The default value is <literal>off</literal>.
        Only superusers and users with the appropriate <literal>SET</literal>
        privilege can change this setting.
-->
このパラメータは、指定された圧縮方法を使用したWALの圧縮を有効にします。
有効にすると、<span class="productname">PostgreSQL</span>サーバは<a class="xref" href="runtime-config-wal.html#GUC-FULL-PAGE-WRITES">full_page_writes</a>がオンの時またはベースバックアップ中にWALに書き込まれた全ページイメージを圧縮します。
圧縮されたページイメージはWAL再生中に伸長されます。
サポートされている方法は<code class="literal">pglz</code>、<code class="literal">lz4</code>(<span class="productname">PostgreSQL</span>が<code class="option">--with-lz4</code>でコンパイルされた場合)および<code class="literal">zstd</code>(<span class="productname">PostgreSQL</span>が<code class="option">--with-zstd</code>でコンパイルされた場合)です。
デフォルト値は<code class="literal">off</code>です。
スーパーユーザと適切な<code class="literal">SET</code>権限を持つユーザのみがこの設定を変更できます。
       </p><p>
<!--
        Enabling compression can reduce the WAL volume without
        increasing the risk of unrecoverable data corruption,
        but at the cost of some extra CPU spent on the compression during
        WAL logging and on the decompression during WAL replay.
-->
このパラメータを有効にすると、回復不可能なデータ破壊のリスクを増やすこと無しにWALの量を減らすことができます。
しかし、WALロギングの際の圧縮のため、またWALリプレイの際には伸張のために余分なCPUを使用するというコストが発生します。
       </p></dd><dt id="GUC-WAL-INIT-ZERO"><span class="term"><code class="varname">wal_init_zero</code> (<code class="type">boolean</code>)
      <a id="id-1.6.7.9.3.2.8.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.3.2.8.1.4" class="indexterm"></a>
      </span> <a href="#GUC-WAL-INIT-ZERO" class="id_link">#</a></dt><dd><p>
<!--
        If set to <literal>on</literal> (the default), this option causes new
        WAL files to be filled with zeroes.  On some file systems, this ensures
        that space is allocated before we need to write WAL records.  However,
        <firstterm>Copy-On-Write</firstterm> (COW) file systems may not benefit
        from this technique, so the option is given to skip the unnecessary
        work.  If set to <literal>off</literal>, only the final byte is written
        when the file is created so that it has the expected size.
-->
このオプションが<code class="literal">on</code>（デフォルト）に設定されると、新しいWALファイルはゼロで初期化されます。
システムによっては、このことによってWALレコードを書く必要が出てくる前にスペースが割り当てられることを保証します。
しかし、<em class="firstterm">Copy-On-Write</em> (COW)ファイルシステムではこの技術は利点がないかもしれず、このオプションはスキップできるようになっています。
<code class="literal">off</code>に設定すると、ファイルを作る時に期待する大きさになるように最後のバイトだけが書かれます。
       </p></dd><dt id="GUC-WAL-RECYCLE"><span class="term"><code class="varname">wal_recycle</code> (<code class="type">boolean</code>)
      <a id="id-1.6.7.9.3.2.9.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.3.2.9.1.4" class="indexterm"></a>
      </span> <a href="#GUC-WAL-RECYCLE" class="id_link">#</a></dt><dd><p>
<!--
        If set to <literal>on</literal> (the default), this option causes WAL
        files to be recycled by renaming them, avoiding the need to create new
        ones.  On COW file systems, it may be faster to create new ones, so the
        option is given to disable this behavior.
-->
このオプションが<code class="literal">on</code>（デフォルト）に設定されると、新しくファイルを作るのを避けるために、名前を変えてWALファイルが再利用されます。
COWファイルシステムでは、新しいファイルを作るほうが速いかも知れないので、この挙動を無効にできるようにオプションとなっています。
       </p></dd><dt id="GUC-WAL-BUFFERS"><span class="term"><code class="varname">wal_buffers</code> (<code class="type">integer</code>)
      <a id="id-1.6.7.9.3.2.10.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.3.2.10.1.4" class="indexterm"></a>
      </span> <a href="#GUC-WAL-BUFFERS" class="id_link">#</a></dt><dd><p>
<!--
        The amount of shared memory used for WAL data that has not yet been
        written to disk.  The default setting of -1 selects a size equal to
        1/32nd (about 3%) of <xref linkend="guc-shared-buffers"/>, but not less
        than <literal>64kB</literal> nor more than the size of one WAL
        segment, typically <literal>16MB</literal>.  This value can be set
        manually if the automatic choice is too large or too small,
        but any positive value less than <literal>32kB</literal> will be
        treated as <literal>32kB</literal>.
        If this value is specified without units, it is taken as WAL blocks,
        that is <symbol>XLOG_BLCKSZ</symbol> bytes, typically 8kB.
        This parameter can only be set at server start.
-->
未だディスクに書き込まれていないWALデータに対して使用される共有メモリ容量です。
デフォルトの設定である-1は、<a class="xref" href="runtime-config-resource.html#GUC-SHARED-BUFFERS">shared_buffers</a>の1/32（約3%）の容量に等しい大きさを選択します。
しかし、<code class="literal">64kB</code>未満ではなく、かつ典型的に<code class="literal">16MB</code>であるWALセグメントの大きさを超えることはありません。
もし、自動設定による選択が大きすぎたり、小さすぎる場合この値は手作業で設定可能です。
しかし、<code class="literal">32kB</code>未満のどんな正の値であっても、<code class="literal">32kB</code>として取り扱われます。
この値が単位なしで指定された場合は、WALブロック単位であるとみなします。すなわち、<code class="symbol">XLOG_BLCKSZ</code>バイト、一般的には8kBです。
このパラメータはサーバ起動時のみ設定可能です。
       </p><p>
<!--
        The contents of the WAL buffers are written out to disk at every
        transaction commit, so extremely large values are unlikely to
        provide a significant benefit.  However, setting this value to at
        least a few megabytes can improve write performance on a busy
        server where many clients are committing at once.  The auto-tuning
        selected by the default setting of -1 should give reasonable
        results in most cases.
-->
WALバッファの内容はトランザクションのコミット毎にディスクに書き込まれます。
したがって、極端に大きな値は有意な効果を期待できません。
しかし、この値を数メガバイトに設定することにより、多くのクライアントが同時にコミットするトラフィック量の多いサーバでは書き込み性能が向上します。
デフォルト設定の-1で選択される自動チューニングによると、ほとんどの場合妥当な結果が得られます。
       </p></dd><dt id="GUC-WAL-WRITER-DELAY"><span class="term"><code class="varname">wal_writer_delay</code> (<code class="type">integer</code>)
      <a id="id-1.6.7.9.3.2.11.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.3.2.11.1.4" class="indexterm"></a>
      </span> <a href="#GUC-WAL-WRITER-DELAY" class="id_link">#</a></dt><dd><p>
<!--
        Specifies how often the WAL writer flushes WAL, in time terms.
        After flushing WAL the writer sleeps for the length of time given
        by <varname>wal_writer_delay</varname>, unless woken up sooner
        by an asynchronously committing transaction. If the last flush
        happened less than <varname>wal_writer_delay</varname> ago and less
        than <varname>wal_writer_flush_after</varname> worth of WAL has been
        produced since, then WAL is only written to the operating system, not
        flushed to disk.
        If this value is specified without units, it is taken as milliseconds.
        The default value is 200 milliseconds (<literal>200ms</literal>).  Note that
        on many systems, the effective resolution of sleep delays is 10
        milliseconds; setting <varname>wal_writer_delay</varname> to a value that is
        not a multiple of 10 might have the same results as setting it to the
        next higher multiple of 10. This parameter can only be set in the
        <filename>postgresql.conf</filename> file or on the server command line.
-->
WALライタがWALをフラッシュする頻度を時間で指定します。
WALをフラッシュしたあと、非同期コミットしているトランザクションに起こされない限り、<code class="varname">wal_writer_delay</code>ミリ秒待機します。
最後のフラッシュが過去<code class="varname">wal_writer_delay</code>以内に行われ、かつそれ以降<code class="varname">wal_writer_flush_after</code>相当のWALが生成されている場合は、WALはオペレーティングシステムに書き込まれますが、ディスクにはフラッシュされません。
この値が単位なしで指定された場合は、ミリ秒単位であるとみなします。
デフォルト値は200ミリ秒（<code class="literal">200ms</code>）です。
多くのシステムでは、待機間隔の実質的な分解能は10ミリ秒です。
10の倍数以外の値を<code class="varname">wal_writer_delay</code>に設定しても、その次に大きい10の倍数を設定した場合と同じ結果となります。
このパラメータは<code class="filename">postgresql.conf</code>ファイル内、またはサーバのコマンドラインのみで設定可能です。
       </p></dd><dt id="GUC-WAL-WRITER-FLUSH-AFTER"><span class="term"><code class="varname">wal_writer_flush_after</code> (<code class="type">integer</code>)
      <a id="id-1.6.7.9.3.2.12.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.3.2.12.1.4" class="indexterm"></a>
      </span> <a href="#GUC-WAL-WRITER-FLUSH-AFTER" class="id_link">#</a></dt><dd><p>
<!--
        Specifies how often the WAL writer flushes WAL, in volume terms.
        If the last flush happened less
        than <varname>wal_writer_delay</varname> ago and less
        than <varname>wal_writer_flush_after</varname> worth of WAL has been
        produced since, then WAL is only written to the operating system, not
        flushed to disk.  If <varname>wal_writer_flush_after</varname> is set
        to <literal>0</literal> then WAL data is always flushed immediately.
        If this value is specified without units, it is taken as WAL blocks,
        that is <symbol>XLOG_BLCKSZ</symbol> bytes, typically 8kB.
        The default is <literal>1MB</literal>.
        This parameter can only be set in the
        <filename>postgresql.conf</filename> file or on the server command line.
-->
WALライタがWALをフラッシュする頻度を量で指定します。
最後のフラッシュが過去<code class="varname">wal_writer_delay</code>以内に起こなわれ、かつそれ以降<code class="varname">wal_writer_flush_after</code>相当のWALが生成されている場合は、WALはオペレーティングシステムに書き込まれますが、ディスクにはフラッシュされません。
<code class="varname">wal_writer_flush_after</code>が<code class="literal">0</code>に設定されている場合は、WALデータが書かれるたびにWALが即時にフラッシュされます。
この値が単位なしで指定された場合は、WALブロック単位であるとみなします。すなわち、<code class="symbol">XLOG_BLCKSZ</code>バイト、一般的には8kBです。
デフォルト値は<code class="literal">1MB</code>です。
このパラメータは<code class="filename">postgresql.conf</code>ファイル内、またはサーバのコマンドラインのみで設定可能です。
       </p></dd><dt id="GUC-WAL-SKIP-THRESHOLD"><span class="term"><code class="varname">wal_skip_threshold</code> (<code class="type">integer</code>)
      <a id="id-1.6.7.9.3.2.13.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.3.2.13.1.4" class="indexterm"></a>
      </span> <a href="#GUC-WAL-SKIP-THRESHOLD" class="id_link">#</a></dt><dd><p>
<!--
        When <varname>wal_level</varname> is <literal>minimal</literal> and a
        transaction commits after creating or rewriting a permanent relation,
        this setting determines how to persist the new data.  If the data is
        smaller than this setting, write it to the WAL log; otherwise, use an
        fsync of affected files.  Depending on the properties of your storage,
        raising or lowering this value might help if such commits are slowing
        concurrent transactions.  If this value is specified without units, it
        is taken as kilobytes.  The default is two megabytes
        (<literal>2MB</literal>).
-->
<code class="varname">wal_level</code>が<code class="literal">minimal</code>で、トランザクションのコミットが永続リレーションを作るかあるいは書き換えた場合に、この設定は新しいデータをどのように永続させるかを決定します。
データがこの設定よりも少なければ、WALログに書きます。そうでなければ、影響のあるファイルに対してfsyncを使用します。
そのようなコミットが現在のトランザクションを低速化しているようであれば、使用する記憶装置の特性によってはこの値を増減することが役に立つかも知れません。
この値が単位なしに指定されるとキロバイトであると見なします。
デフォルトは2メガバイト(<code class="literal">2MB</code>)です。
       </p></dd><dt id="GUC-COMMIT-DELAY"><span class="term"><code class="varname">commit_delay</code> (<code class="type">integer</code>)
      <a id="id-1.6.7.9.3.2.14.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.3.2.14.1.4" class="indexterm"></a>
      </span> <a href="#GUC-COMMIT-DELAY" class="id_link">#</a></dt><dd><p>
<!--
        Setting <varname>commit_delay</varname> adds a time delay
        before a WAL flush is initiated.  This can improve
        group commit throughput by allowing a larger number of transactions
        to commit via a single WAL flush, if system load is high enough
        that additional transactions become ready to commit within the
        given interval.  However, it also increases latency by up to the
        <varname>commit_delay</varname> for each WAL
        flush.  Because the delay is just wasted if no other transactions
        become ready to commit, a delay is only performed if at least
        <varname>commit_siblings</varname> other transactions are active
        when a flush is about to be initiated.  Also, no delays are
        performed if <varname>fsync</varname> is disabled.
        If this value is specified without units, it is taken as microseconds.
        The default <varname>commit_delay</varname> is zero (no delay).
        Only superusers and users with the appropriate <literal>SET</literal>
        privilege can change this setting.
-->
<code class="varname">commit_delay</code>を設定することにより、WALフラッシュを開始する前の時間遅延が追加されます。
このことにより、もし追加のトランザクションが与えられた時間間隔内でコミットが可能になるほどシステム負荷が充分に高い場合、一回のWALフラッシュでより多くの数のトランザクションをコミットできるようになり、コミット群のスループットを改善できます。
とは言っても、それぞれのWALフラッシュに対して最大<code class="varname">commit_delay</code>の待ち時間の増加をきたします。
コミットの準備が完了したトランザクションが他に存在しない場合、遅延は無駄になるため、遅延はフラッシュが開始されようとしている時点で少なくとも<code class="varname">commit_siblings</code>だけのトランザクションが活動している場合にだけ機能します。
同様に、<code class="varname">fsync</code>が無効の場合も遅延は機能しません。
この値が単位なしで指定された場合は、マイクロ秒単位であるとみなします。
デフォルトの<code class="varname">commit_delay</code>はゼロ（遅延無し）です。
スーパーユーザと適切な<code class="literal">SET</code>権限を持つユーザのみがこの設定を変更できます。
       </p><p>
<!--
        In <productname>PostgreSQL</productname> releases prior to 9.3,
        <varname>commit_delay</varname> behaved differently and was much
        less effective: it affected only commits, rather than all WAL flushes,
        and waited for the entire configured delay even if the WAL flush
        was completed sooner.  Beginning in <productname>PostgreSQL</productname> 9.3,
        the first process that becomes ready to flush waits for the configured
        interval, while subsequent processes wait only until the leader
        completes the flush operation.
-->
9.3より前の<span class="productname">PostgreSQL</span>では、<code class="varname">commit_delay</code>の振る舞いは異なっており、あまり効果がありませんでした。
全てのWALフラッシュではなく、コミットだけに影響していました。また、そしてWALフラッシュが早めに完了しても設定された遅延分待機していました。
<span class="productname">PostgreSQL</span> 9.3以降では、フラッシュの準備が整った最初のプロセスが設定値分待機し、後続のプロセスは最初のプロセスがフラッシュ操作を完了するまでの間だけ待機をします。
       </p></dd><dt id="GUC-COMMIT-SIBLINGS"><span class="term"><code class="varname">commit_siblings</code> (<code class="type">integer</code>)
      <a id="id-1.6.7.9.3.2.15.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.3.2.15.1.4" class="indexterm"></a>
      </span> <a href="#GUC-COMMIT-SIBLINGS" class="id_link">#</a></dt><dd><p>
<!--
        Minimum number of concurrent open transactions to require
        before performing the <varname>commit_delay</varname> delay. A larger
        value makes it more probable that at least one other
        transaction will become ready to commit during the delay
        interval. The default is five transactions.
-->
<code class="varname">commit_delay</code>の遅延を実行するときに必要とされる同時に開いているトランザクションの最小数です。
より大きい値にすると、遅延周期の間に、少なくとも1つの他のトランザクションのコミットの準備が整う確率が高くなります。
デフォルトは5トランザクションです。
       </p></dd></dl></div></div><div class="sect2" id="RUNTIME-CONFIG-WAL-CHECKPOINTS"><div class="titlepage"><div><div><h3 class="title">20.5.2. チェックポイント <a href="#RUNTIME-CONFIG-WAL-CHECKPOINTS" class="id_link">#</a></h3></div></div></div><!--
     <title>Checkpoints</title>
--><div class="variablelist"><dl class="variablelist"><dt id="GUC-CHECKPOINT-TIMEOUT"><span class="term"><code class="varname">checkpoint_timeout</code> (<code class="type">integer</code>)
      <a id="id-1.6.7.9.4.2.1.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.4.2.1.1.4" class="indexterm"></a>
      </span> <a href="#GUC-CHECKPOINT-TIMEOUT" class="id_link">#</a></dt><dd><p>
<!--
        Maximum time between automatic WAL checkpoints.
        If this value is specified without units, it is taken as seconds.
        The valid range is between 30 seconds and one day.
        The default is five minutes (<literal>5min</literal>).
        Increasing this parameter can increase the amount of time needed
        for crash recovery.
        This parameter can only be set in the <filename>postgresql.conf</filename>
        file or on the server command line.
-->
自動的WALチェックポイント間の最大間隔を指定します。
この値が単位なしで指定された場合は、秒単位であるとみなします。
有効な範囲は、30秒から1日の間です。
デフォルトは5分（<code class="literal">5min</code>）です。
このパラメータを増やすと、クラッシュリカバリで必要となる時間が増加します。
このパラメータは<code class="filename">postgresql.conf</code>ファイル、または、サーバのコマンドラインでのみ設定可能です。
       </p></dd><dt id="GUC-CHECKPOINT-COMPLETION-TARGET"><span class="term"><code class="varname">checkpoint_completion_target</code> (<code class="type">floating point</code>)
      <a id="id-1.6.7.9.4.2.2.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.4.2.2.1.4" class="indexterm"></a>
      </span> <a href="#GUC-CHECKPOINT-COMPLETION-TARGET" class="id_link">#</a></dt><dd><p>
<!--
        Specifies the target of checkpoint completion, as a fraction of
        total time between checkpoints. The default is 0.9, which spreads the
        checkpoint across almost all of the available interval, providing fairly
        consistent I/O load while also leaving some time for checkpoint
        completion overhead.  Reducing this parameter is not recommended because
        it causes the checkpoint to complete faster.  This results in a higher
        rate of I/O during the checkpoint followed by a period of less I/O between
        the checkpoint completion and the next scheduled checkpoint.  This
        parameter can only be set in the <filename>postgresql.conf</filename> file
        or on the server command line.
-->
チェックポイントの間の時間のうち、どの程度の割合を使うかをチェックポイントの完了目標として指定します。
デフォルトは0.9で、可能な限りの間隔のほとんどにチェックポイントを拡散し、かなり一定のI/O負荷をもたらしますが、チェックポイントが完了するにあたってオーバーヘッドをもたらします。
チェックポイントの完了を早くするので、このパラメータを小さくするのはお勧めできません。
これにより、チェックポイント中はI/Oの割合が大きくなり、チェックポイントの完了から次のチェックポイントまでの間はより少ないI/Oとなります。
このパラメータは<code class="filename">postgresql.conf</code>ファイル、または、サーバのコマンドラインでのみ設定可能です。
       </p></dd><dt id="GUC-CHECKPOINT-FLUSH-AFTER"><span class="term"><code class="varname">checkpoint_flush_after</code> (<code class="type">integer</code>)
      <a id="id-1.6.7.9.4.2.3.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.4.2.3.1.4" class="indexterm"></a>
      </span> <a href="#GUC-CHECKPOINT-FLUSH-AFTER" class="id_link">#</a></dt><dd><p>
<!--
        Whenever more than this amount of data has been
        written while performing a checkpoint, attempt to force the
        OS to issue these writes to the underlying storage.  Doing so will
        limit the amount of dirty data in the kernel's page cache, reducing
        the likelihood of stalls when an <function>fsync</function> is issued at the end of the
        checkpoint, or when the OS writes data back in larger batches in the
        background.  Often that will result in greatly reduced transaction
        latency, but there also are some cases, especially with workloads
        that are bigger than <xref linkend="guc-shared-buffers"/>, but smaller
        than the OS's page cache, where performance might degrade.  This
        setting may have no effect on some platforms.
        If this value is specified without units, it is taken as blocks,
        that is <symbol>BLCKSZ</symbol> bytes, typically 8kB.
        The valid range is
        between <literal>0</literal>, which disables forced writeback,
        and <literal>2MB</literal>.  The default is <literal>256kB</literal> on
        Linux, <literal>0</literal> elsewhere.  (If <symbol>BLCKSZ</symbol> is not
        8kB, the default and maximum values scale proportionally to it.)
        This parameter can only be set in the <filename>postgresql.conf</filename>
        file or on the server command line.
-->
チェックポイント実行中にこのデータ量よりも多く書く度に、OSが記憶装置に書き込むことを強制しようとします。
このことにより、カーネルのページキャッシュが持つダーティデータの量を一定量に制限し、チェックポイントの最後に<code class="function">fsync</code>が実行される際、あるいはOSがバックグラウンドでデータを大きな塊で書き出す際に性能の急激な低下を招く可能性を減らします。
多くの場合これによってトランザクションの遅延が大幅に少なくなりますが、あるケース、特にワークロードが<a class="xref" href="runtime-config-resource.html#GUC-SHARED-BUFFERS">shared_buffers</a>よりも大きく、OSのページキャッシュよりも小さい時には性能が低下するかもしれません。
この設定が無効なプラットフォームがあります。
この値が単位なしで指定された場合は、ブロック単位であるとみなします。すなわち、<code class="symbol">BLCKSZ</code>バイト、一般的には8kBです。
有効な設定値は、この強制書き込み機能が無効になる<code class="literal">0</code>から、<code class="literal">2MB</code>までです。
デフォルト値は、Linuxでは<code class="literal">256kB</code>で、それ以外は<code class="literal">0</code>です。
(<code class="symbol">BLCKSZ</code>が8kbでなければ、この設定のデフォルト値と最大値が<code class="symbol">BLCKSZ</code>に比例して変更されます。)
このパラメータは<code class="filename">postgresql.conf</code>ファイル、または、サーバのコマンドラインでのみで設定可能です。
       </p></dd><dt id="GUC-CHECKPOINT-WARNING"><span class="term"><code class="varname">checkpoint_warning</code> (<code class="type">integer</code>)
      <a id="id-1.6.7.9.4.2.4.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.4.2.4.1.4" class="indexterm"></a>
      </span> <a href="#GUC-CHECKPOINT-WARNING" class="id_link">#</a></dt><dd><p>
<!--
        Write a message to the server log if checkpoints caused by
        the filling of WAL segment files happen closer together
        than this amount of time (which suggests that
        <varname>max_wal_size</varname> ought to be raised).
        If this value is specified without units, it is taken as seconds.
        The default is 30 seconds (<literal>30s</literal>).
        Zero disables the warning.
        No warnings will be generated if <varname>checkpoint_timeout</varname>
        is less than <varname>checkpoint_warning</varname>.
        This parameter can only be set in the <filename>postgresql.conf</filename>
        file or on the server command line.
-->
WALセグメントファイルが溢れることが原因で起きるチェックポイントが、ここで指定した時間よりも短い間隔で発生したとき、サーバログにメッセージを書き出します
（これは、<code class="varname">max_wal_size</code>を増やす必要があることを示唆しています）。
この値が単位なしで指定された場合は、秒単位であるとみなします。
デフォルトは30秒（<code class="literal">30s</code>）です。
零の場合は警告を出しません。
<code class="varname">checkpoint_timeout</code>が<code class="varname">checkpoint_warning</code>より小さい場合は警告を出しません。
このパラメータは<code class="filename">postgresql.conf</code>ファイル、または、サーバのコマンドラインでのみ設定可能です。
       </p></dd><dt id="GUC-MAX-WAL-SIZE"><span class="term"><code class="varname">max_wal_size</code> (<code class="type">integer</code>)
      <a id="id-1.6.7.9.4.2.5.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.4.2.5.1.4" class="indexterm"></a>
      </span> <a href="#GUC-MAX-WAL-SIZE" class="id_link">#</a></dt><dd><p>
<!--
        Maximum size to let the WAL grow during automatic
        checkpoints. This is a soft limit; WAL size can exceed
        <varname>max_wal_size</varname> under special circumstances, such as
        heavy load, a failing <varname>archive_command</varname> or <varname>archive_library</varname>, or a high
        <varname>wal_keep_size</varname> setting.
        If this value is specified without units, it is taken as megabytes.
        The default is 1 GB.
        Increasing this parameter can increase the amount of time needed for
        crash recovery.
        This parameter can only be set in the <filename>postgresql.conf</filename>
        file or on the server command line.
-->
自動WALチェックポイントの際にWALが増加する最大サイズです。
これはソフトリミットです。特別な状況下、たとえば高負荷、<code class="varname">archive_command</code>の失敗、<code class="varname">archive_library</code>の失敗、<code class="varname">wal_keep_size</code>が大きな値に設定されている、などの時には、WALサイズは<code class="varname">max_wal_size</code>を超えることがあります。
この値が単位なしで指定された場合は、メガバイト単位であるとみなします。
デフォルトは1GBです。
このパラメータを大きくすると、クラッシュリカバリに必要な時間が長くなります。
このパラメータは、<code class="filename">postgresql.conf</code>ファイルで設定するか、サーバのコマンドラインでのみ指定できます。
       </p></dd><dt id="GUC-MIN-WAL-SIZE"><span class="term"><code class="varname">min_wal_size</code> (<code class="type">integer</code>)
      <a id="id-1.6.7.9.4.2.6.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.4.2.6.1.4" class="indexterm"></a>
      </span> <a href="#GUC-MIN-WAL-SIZE" class="id_link">#</a></dt><dd><p>
<!--
        As long as WAL disk usage stays below this setting, old WAL files are
        always recycled for future use at a checkpoint, rather than removed.
        This can be used to ensure that enough WAL space is reserved to
        handle spikes in WAL usage, for example when running large batch
        jobs.
        If this value is specified without units, it is taken as megabytes.
        The default is 80 MB.
        This parameter can only be set in the <filename>postgresql.conf</filename>
        file or on the server command line.
-->
この設定以下にWALのディスク使用量が保たれる限り、古いWALファイルは、消去されることなく今後のチェックポイントで使用するために常にリサイクルされます。
この設定は、たとえば大きなバッチジョブを走らせる際のWALの利用スパイクを取り扱うために、十分なWALのスペースが予約されていることを保証するために使用できます。
この値が単位なしで指定された場合は、メガバイト単位であるとみなします。
デフォルトは80MBです。
このパラメータは、<code class="filename">postgresql.conf</code>ファイルで設定するか、サーバのコマンドラインでのみ指定できます。
       </p></dd></dl></div></div><div class="sect2" id="RUNTIME-CONFIG-WAL-ARCHIVING"><div class="titlepage"><div><div><h3 class="title">20.5.3. アーカイビング <a href="#RUNTIME-CONFIG-WAL-ARCHIVING" class="id_link">#</a></h3></div></div></div><!--
     <title>Archiving</title>
--><div class="variablelist"><dl class="variablelist"><dt id="GUC-ARCHIVE-MODE"><span class="term"><code class="varname">archive_mode</code> (<code class="type">enum</code>)
      <a id="id-1.6.7.9.5.2.1.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.5.2.1.1.4" class="indexterm"></a>
      </span> <a href="#GUC-ARCHIVE-MODE" class="id_link">#</a></dt><dd><p>
<!--
        When <varname>archive_mode</varname> is enabled, completed WAL segments
        are sent to archive storage by setting
        <xref linkend="guc-archive-command"/> or
        <xref linkend="guc-archive-library"/>. In addition to <literal>off</literal>,
        to disable, there are two modes: <literal>on</literal>, and
        <literal>always</literal>. During normal operation, there is no
        difference between the two modes, but when set to <literal>always</literal>
        the WAL archiver is enabled also during archive recovery or standby
        mode. In <literal>always</literal> mode, all files restored from the archive
        or streamed with streaming replication will be archived (again). See
        <xref linkend="continuous-archiving-in-standby"/> for details.
-->
<code class="varname">archive_mode</code>が有効な場合、<a class="xref" href="runtime-config-wal.html#GUC-ARCHIVE-COMMAND">archive_command</a>あるいは<a class="xref" href="runtime-config-wal.html#GUC-ARCHIVE-LIBRARY">archive_library</a>を設定することにより、完了したWALセグメントはアーカイブ格納領域に送信されます。
無効にするための<code class="literal">off</code>に加え、2つのモードがあります。<code class="literal">on</code>と<code class="literal">always</code>です。
通常の運用ではこの2つのモードには違いはありませんが、<code class="literal">always</code>に設定すると、アーカイブリカバリおよびスタンバイモードでWALアーカイバが有効になります。
<code class="literal">always</code>モードでは、アーカイブからリストアされたファイルや、ストリーミングレプリケーションでストリームされたファイルもすべて(再び)アーカイブされます。
詳細は<a class="xref" href="warm-standby.html#CONTINUOUS-ARCHIVING-IN-STANDBY" title="27.2.9. スタンバイにおける継続的アーカイビング">27.2.9</a>を参照してください。
       </p><p>
<!--
        <varname>archive_mode</varname> is a separate setting from
        <varname>archive_command</varname> and
        <varname>archive_library</varname> so that
        <varname>archive_command</varname> and
        <varname>archive_library</varname> can be changed without leaving
        archiving mode.
        This parameter can only be set at server start.
        <varname>archive_mode</varname> cannot be enabled when
        <varname>wal_level</varname> is set to <literal>minimal</literal>.
-->
<code class="varname">archive_command</code>と<code class="varname">archive_library</code>がアーカイブモードを停止することなく変更できるように、<code class="varname">archive_mode</code>は、<code class="varname">archive_command</code>と<code class="varname">archive_library</code>とは別の設定項目になっています。
このパラメータはサーバ起動時のみ設定可能です。
<code class="varname">wal_level</code>が<code class="literal">minimal</code>に設定されている場合、<code class="varname">archive_mode</code>を有効にすることはできません。
       </p></dd><dt id="GUC-ARCHIVE-COMMAND"><span class="term"><code class="varname">archive_command</code> (<code class="type">string</code>)
      <a id="id-1.6.7.9.5.2.2.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.5.2.2.1.4" class="indexterm"></a>
      </span> <a href="#GUC-ARCHIVE-COMMAND" class="id_link">#</a></dt><dd><p>
<!--
        The local shell command to execute to archive a completed WAL file
        segment.  Any <literal>%p</literal> in the string is
        replaced by the path name of the file to archive, and any
        <literal>%f</literal> is replaced by only the file name.
        (The path name is relative to the working directory of the server,
        i.e., the cluster's data directory.)
        Use <literal>%%</literal> to embed an actual <literal>%</literal> character in the
        command.  It is important for the command to return a zero
        exit status only if it succeeds. For more information see
        <xref linkend="backup-archiving-wal"/>.
-->
完了したWALファイルセグメントのアーカイブを実行するローカルのシェルコマンドです。
文字列内のすべての<code class="literal">%p</code>は、格納されるファイルのパスで置き換えられ、そして、<code class="literal">%f</code>はファイル名のみ置換します。
（このパス名はサーバの作業用ディレクトリ、つまり、クラスタのデータディレクトリからの相対パスです。）
コマンド内に<code class="literal">%</code>文字そのものを埋め込むには<code class="literal">%%</code>を使用します。
コマンドが成功した場合にのみ終了ステータスゼロを返すことが重要です。
詳しくは<a class="xref" href="continuous-archiving.html#BACKUP-ARCHIVING-WAL" title="26.3.1. WALアーカイブの設定">26.3.1</a>を参照ください。
       </p><p>
<!--
        This parameter can only be set in the <filename>postgresql.conf</filename>
        file or on the server command line.  It is only used if
        <varname>archive_mode</varname> was enabled at server start and
        <varname>archive_library</varname> is set to an empty string.  If both
        <varname>archive_command</varname> and <varname>archive_library</varname>
        are set, an error will be raised.
        If <varname>archive_command</varname> is an empty string (the default) while
        <varname>archive_mode</varname> is enabled (and <varname>archive_library</varname>
        is set to an empty string), WAL archiving is temporarily
        disabled, but the server continues to accumulate WAL segment files in
        the expectation that a command will soon be provided.  Setting
        <varname>archive_command</varname> to a command that does nothing but
        return true, e.g., <literal>/bin/true</literal> (<literal>REM</literal> on
        Windows), effectively disables
        archiving, but also breaks the chain of WAL files needed for
        archive recovery, so it should only be used in unusual circumstances.
-->
このパラメータは<code class="filename">postgresql.conf</code>ファイル、または、サーバのコマンドラインでのみ設定可能です。
サーバ起動時に<code class="varname">archive_mode</code>が有効で、<code class="varname">archive_library</code>が空文字の時にのみ使用されます。
<code class="varname">archive_command</code>と<code class="varname">archive_library</code>の両方が有効ならばエラーが発生します。
<code class="varname">archive_mode</code>が有効であるにもかかわらず、<code class="varname">archive_command</code>が空文字列（デフォルト）、（そして<code class="varname">archive_library</code>が空文字列）である場合、WALアーカイブ処理は一時的に無効になりますが、コマンドが後で提供されることを見越して、サーバはWALセグメントの蓄積を続けます。
例えば、<code class="literal">/bin/true</code>（Windowsでは<code class="literal">REM</code>）のように、真を返すだけで何もしないコマンドを<code class="varname">archive_command</code>に設定すると、実質的にアーカイブ処理が無効になりますが、アーカイブからの復帰に必要なWALファイルの連鎖も同時に断ち切るため、特別な場合のみ使用するようにしなければなりません。
       </p></dd><dt id="GUC-ARCHIVE-LIBRARY"><span class="term"><code class="varname">archive_library</code> (<code class="type">string</code>)
      <a id="id-1.6.7.9.5.2.3.1.3" class="indexterm"></a>
      </span> <a href="#GUC-ARCHIVE-LIBRARY" class="id_link">#</a></dt><dd><p>
<!--
        The library to use for archiving completed WAL file segments.  If set to
        an empty string (the default), archiving via shell is enabled, and
        <xref linkend="guc-archive-command"/> is used.  If both
        <varname>archive_command</varname> and <varname>archive_library</varname>
        are set, an error will be raised.  Otherwise, the specified
        shared library is used for archiving. The WAL archiver process is
        restarted by the postmaster when this parameter changes. For more
        information, see <xref linkend="backup-archiving-wal"/> and
        <xref linkend="archive-modules"/>.
-->
アーカイビングが完了したWALファイルセグメントに使用するライブラリです。
空文字列（デフォルト）に設定された場合、シェル経由のアーカイビングが有効になり、<a class="xref" href="runtime-config-wal.html#GUC-ARCHIVE-COMMAND">archive_command</a>が使用されます。
<code class="varname">archive_command</code>と<code class="varname">archive_library</code>の両方が有効ならばエラーが発生します。
それ以外の場合は、指定された共有ライブラリがアーカイブに使用されます。
WALアーカイバプロセスは、このパラメータが変更されたときにpostmasterによって再起動されます。
詳細については、<a class="xref" href="continuous-archiving.html#BACKUP-ARCHIVING-WAL" title="26.3.1. WALアーカイブの設定">26.3.1</a>および<a class="xref" href="archive-modules.html" title="第51章 アーカイブモジュール">第51章</a>を参照してください。
       </p><p>
<!--
        This parameter can only be set in the
        <filename>postgresql.conf</filename> file or on the server command line.
-->
このパラメータは<code class="filename">postgresql.conf</code>ファイル、または、サーバのコマンドラインでのみ設定可能です。
       </p></dd><dt id="GUC-ARCHIVE-TIMEOUT"><span class="term"><code class="varname">archive_timeout</code> (<code class="type">integer</code>)
      <a id="id-1.6.7.9.5.2.4.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.5.2.4.1.4" class="indexterm"></a>
      </span> <a href="#GUC-ARCHIVE-TIMEOUT" class="id_link">#</a></dt><dd><p>
<!--
        The <xref linkend="guc-archive-command"/> or <xref linkend="guc-archive-library"/> is only invoked for
        completed WAL segments. Hence, if your server generates little WAL
        traffic (or has slack periods where it does so), there could be a
        long delay between the completion of a transaction and its safe
        recording in archive storage.  To limit how old unarchived
        data can be, you can set <varname>archive_timeout</varname> to force the
        server to switch to a new WAL segment file periodically.  When this
        parameter is greater than zero, the server will switch to a new
        segment file whenever this amount of time has elapsed since the last
        segment file switch, and there has been any database activity,
        including a single checkpoint (checkpoints are skipped if there is
        no database activity).  Note that archived files that are closed
        early due to a forced switch are still the same length as completely
        full files.  Therefore, it is unwise to use a very short
        <varname>archive_timeout</varname> &mdash; it will bloat your archive
        storage.  <varname>archive_timeout</varname> settings of a minute or so are
        usually reasonable.  You should consider using streaming replication,
        instead of archiving, if you want data to be copied off the primary
        server more quickly than that.
        If this value is specified without units, it is taken as seconds.
        This parameter can only be set in the
        <filename>postgresql.conf</filename> file or on the server command line.
-->
<a class="xref" href="runtime-config-wal.html#GUC-ARCHIVE-COMMAND">archive_command</a>または<a class="xref" href="runtime-config-wal.html#GUC-ARCHIVE-LIBRARY">archive_library</a> は、完了したWALセグメントに対してのみ呼び出されます。
したがって、サーバがWALトラフィックをほとんど生成しない場合（あるいはそのような余裕期間がある場合）、トランザクションの完了とアーカイブストレージへの安全な記録との間に長い遅延が発生する可能性があります。
アーカイブされていないデータの古さを制限するために、<code class="varname">archive_timeout</code>を設定して、サーバに新しいWALセグメントファイルへの定期的な切り替えを強制することができます。
このパラメータが0より大きい場合、サーバは、最後のセグメントファイル切り替えからこの時間が経過し、単一のチェックポイント（データベースアクティビティがない場合はチェックポイントはスキップされます）を含むデータベースアクティビティが発生するたびに新しいセグメントファイルへの切り替えを行います。
強制的な切り替えにより早期に閉じられたアーカイブファイルは、完全に満杯のファイルと同じ長さのままであることに注意してください。
したがって、非常に短い<code class="varname">archive_timeout</code>を使用することは賢明ではなく、アーカイブストレージを膨張させます。
通常は1分程度の<code class="varname">archive_timeout</code>設定が妥当です。
プライマリサーバからデータをより迅速にコピーしたい場合は、アーカイブではなくストリーミングレプリケーションを使用することを検討してください。この値が単位なしで指定された場合、秒として取得されます。
このパラメータは<code class="filename">postgresql.conf</code>ファイル、または、サーバのコマンドラインでのみ設定可能です。
       </p></dd></dl></div></div><div class="sect2" id="RUNTIME-CONFIG-WAL-RECOVERY"><div class="titlepage"><div><div><h3 class="title">20.5.4. リカバリ <a href="#RUNTIME-CONFIG-WAL-RECOVERY" class="id_link">#</a></h3></div></div></div><!--
    <title>Recovery</title>
--><a id="id-1.6.7.9.6.2" class="indexterm"></a><a id="id-1.6.7.9.6.3" class="indexterm"></a><p>
<!--
     This section describes the settings that apply to recovery in general,
     affecting crash recovery, streaming replication and archive-based
     replication.
-->
このセクションでは、クラッシュリカバリ、ストリーミングレプリケーション、およびアーカイブベースのレプリケーションに影響する一般的なリカバリに適用される設定について説明します。
    </p><div class="variablelist"><dl class="variablelist"><dt id="GUC-RECOVERY-PREFETCH"><span class="term"><code class="varname">recovery_prefetch</code> (<code class="type">enum</code>)
      <a id="id-1.6.7.9.6.5.1.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.6.5.1.1.4" class="indexterm"></a>
      </span> <a href="#GUC-RECOVERY-PREFETCH" class="id_link">#</a></dt><dd><p>
<!--
        Whether to try to prefetch blocks that are referenced in the WAL that
        are not yet in the buffer pool, during recovery.  Valid values are
        <literal>off</literal>, <literal>on</literal> and
        <literal>try</literal> (the default).  The setting
        <literal>try</literal> enables
        prefetching only if the operating system provides the
        <function>posix_fadvise</function> function, which is currently used
        to implement prefetching.  Note that some operating systems provide the
        function, but it doesn't do anything.
-->
リカバリ中に、まだバッファプールにない、WALで参照されているブロックをプリフェッチしようとするかどうか。
有効な値は<code class="literal">off</code>、<code class="literal">on</code>、<code class="literal">try</code>(デフォルト)です。
<code class="literal">try</code>設定は、オペレーティングシステムが<code class="function">posix_fadvise</code>関数を提供している場合にのみプリフェッチを有効にします。
この関数は現在、プリフェッチの実装に使用されています。
一部のオペレーティングシステムはこの関数を提供していますが、何も行わないことに注意してください。
       </p><p>
<!--
        Prefetching blocks that will soon be needed can reduce I/O wait times
        during recovery with some workloads.
        See also the <xref linkend="guc-wal-decode-buffer-size"/> and
        <xref linkend="guc-maintenance-io-concurrency"/> settings, which limit
        prefetching activity.
-->
すぐに必要になるブロックをプリフェッチすると、一部のワークロードでリカバリ中のI/O待機時間を短縮できます。
プリフェッチ・アクティビティを制限する<a class="xref" href="runtime-config-wal.html#GUC-WAL-DECODE-BUFFER-SIZE">wal_decode_buffer_size</a>および<a class="xref" href="runtime-config-resource.html#GUC-MAINTENANCE-IO-CONCURRENCY">maintenance_io_concurrency</a>設定も参照してください。
       </p></dd><dt id="GUC-WAL-DECODE-BUFFER-SIZE"><span class="term"><code class="varname">wal_decode_buffer_size</code> (<code class="type">integer</code>)
      <a id="id-1.6.7.9.6.5.2.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.6.5.2.1.4" class="indexterm"></a>
      </span> <a href="#GUC-WAL-DECODE-BUFFER-SIZE" class="id_link">#</a></dt><dd><p>
<!--
        A limit on how far ahead the server can look in the WAL, to find
        blocks to prefetch.  If this value is specified without units, it is
        taken as bytes.
        The default is 512kB.
-->
サーバがプリフェッチするブロックを見つけるためにWAL内をどれだけ先まで見ることができるかの制限です。
この値が単位なしで指定された場合、バイトとして扱われます。
デフォルトは512KBです。
       </p></dd></dl></div></div><div class="sect2" id="RUNTIME-CONFIG-WAL-ARCHIVE-RECOVERY"><div class="titlepage"><div><div><h3 class="title">20.5.5. アーカイブからのリカバリ <a href="#RUNTIME-CONFIG-WAL-ARCHIVE-RECOVERY" class="id_link">#</a></h3></div></div></div><!--
    <title>Archive Recovery</title>
--><a id="id-1.6.7.9.7.2" class="indexterm"></a><a id="id-1.6.7.9.7.3" class="indexterm"></a><p>
<!--
     This section describes the settings that apply only for the duration of
     the recovery.  They must be reset for any subsequent recovery you wish to
     perform.
-->
この節では、リカバリの間だけ適用する設定について説明します。
その後実施するリカバリでは、その設定はリセットしなければなりません。
    </p><p>
<!--
     <quote>Recovery</quote> covers using the server as a standby or for
     executing a targeted recovery.  Typically, standby mode would be used to
     provide high availability and/or read scalability, whereas a targeted
     recovery is used to recover from data loss.
-->
<span class="quote">「<span class="quote">リカバリ</span>」</span>は、サーバをスタンバイとして使用するとき、あるいはターゲットを指定したリカバリで適用されます。
通常、スタンバイモードは、高可用性または読み出しスケーラビリティ、あるいはその両方を提供するために使用します。
一方ターゲットを指定したリカバリは失なわれたデータを回復するために使用します。
    </p><p>
<!--
     To start the server in standby mode, create a file called
     <filename>standby.signal</filename><indexterm><primary>standby.signal</primary></indexterm>
     in the data directory.  The server will enter recovery and will not stop
     recovery when the end of archived WAL is reached, but will keep trying to
     continue recovery by connecting to the sending server as specified by the
     <varname>primary_conninfo</varname> setting and/or by fetching new WAL
     segments using <varname>restore_command</varname>.  For this mode, the
     parameters from this section and <xref
     linkend="runtime-config-replication-standby"/> are of interest.
     Parameters from <xref linkend="runtime-config-wal-recovery-target"/> will
     also be applied but are typically not useful in this mode.
-->
スタンバイモードでサーバを起動するには、<code class="filename">standby.signal</code><a id="id-1.6.7.9.7.6.2" class="indexterm"></a>と呼ばれるファイルをデータディレクトリに作ります。
サーバはリカバリモードに入り、アーカイブWALの終端に到着してもリカバリを止めず、<code class="varname">primary_conninfo</code>の設定で指定された送信サーバに接続するか、<code class="varname">restore_command</code>を使って新しいWALセグメントを取得するか、あるいはその両方によってリカバリを継続しようとします。
このモードでは、この節と<a class="xref" href="runtime-config-replication.html#RUNTIME-CONFIG-REPLICATION-STANDBY" title="20.6.3. スタンバイサーバ">20.6.3</a>で説明するパラメータが関係します。
<a class="xref" href="runtime-config-wal.html#RUNTIME-CONFIG-WAL-RECOVERY-TARGET" title="20.5.6. リカバリターゲット">20.5.6</a>のパラメータも適用できますが、このモードでは通常有用ではありません。
    </p><p>
<!--
     To start the server in targeted recovery mode, create a file called
     <filename>recovery.signal</filename><indexterm><primary>recovery.signal</primary></indexterm>
     in the data directory.  If both <filename>standby.signal</filename> and
     <filename>recovery.signal</filename> files are created, standby mode
     takes precedence.  Targeted recovery mode ends when the archived WAL is
     fully replayed, or when <varname>recovery_target</varname> is reached.
     In this mode, the parameters from both this section and <xref
     linkend="runtime-config-wal-recovery-target"/> will be used.
-->
サーバをターゲットリカバリモードで起動するには、<code class="filename">recovery.signal</code><a id="id-1.6.7.9.7.7.2" class="indexterm"></a>という名前のファイルをデータディレクトリに作ります。
<code class="filename">standby.signal</code>と<code class="filename">recovery.signal</code>の両方が作られた場合は、スタンバイモードが優先します。
ターゲットリカバリモードはアーカイブWALが完全に再生されるか、<code class="varname">recovery_target</code>に到達した時に終了します。
このモードでは、この節と<a class="xref" href="runtime-config-wal.html#RUNTIME-CONFIG-WAL-RECOVERY-TARGET" title="20.5.6. リカバリターゲット">20.5.6</a>のパラメータの両方が使用されます。
    </p><div class="variablelist"><dl class="variablelist"><dt id="GUC-RESTORE-COMMAND"><span class="term"><code class="varname">restore_command</code> (<code class="type">string</code>)
      <a id="id-1.6.7.9.7.8.1.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.7.8.1.1.4" class="indexterm"></a>
      </span> <a href="#GUC-RESTORE-COMMAND" class="id_link">#</a></dt><dd><p>
<!--
        The local shell command to execute to retrieve an archived segment of
        the WAL file series. This parameter is required for archive recovery,
        but optional for streaming replication.
        Any <literal>%f</literal> in the string is
        replaced by the name of the file to retrieve from the archive,
        and any <literal>%p</literal> is replaced by the copy destination path name
        on the server.
        (The path name is relative to the current working directory,
        i.e., the cluster's data directory.)
        Any <literal>%r</literal> is replaced by the name of the file containing the
        last valid restart point. That is the earliest file that must be kept
        to allow a restore to be restartable, so this information can be used
        to truncate the archive to just the minimum required to support
        restarting from the current restore. <literal>%r</literal> is typically only
        used by warm-standby configurations
        (see <xref linkend="warm-standby"/>).
        Write <literal>%%</literal> to embed an actual <literal>%</literal> character.
-->
一連のWALファイルからアーカイブセグメントを取り出すために実行するローカルのシェルコマンドです。
このパラメータはアーカイブリカバリでは必須ですが、ストリーミングレプリケーションではオプションです。
文字列中の<code class="literal">%f</code>はアーカイブから取り出すファイルの名前に置換され、<code class="literal">%p</code>はサーバ上のコピー先のパス名に置換されます。
（パス名は現在の作業ディレクトリの相対パス、つまりクラスタのデータディレクトリです。）
<code class="literal">%r</code>は有効な最後のリスタートポイントを含むファイル名に置換されます。
これはリストアが再開可能であるために維持しなければならない最古のファイルで、現在のリストアからの再開をサポートするのに最小限必要なアーカイブを残して切り詰めるのに必要な情報として利用できます。
<code class="literal">%r</code>は通常ウォームスタンバイ構成でのみ使用されます。
（<a class="xref" href="warm-standby.html" title="27.2. ログシッピングスタンバイサーバ">27.2</a>参照。）
<code class="literal">%</code>文字自体を埋め込むには<code class="literal">%%</code>と書いてください。
       </p><p>
<!--
        It is important for the command to return a zero exit status
        only if it succeeds.  The command <emphasis>will</emphasis> be asked for file
        names that are not present in the archive; it must return nonzero
        when so asked.  Examples:
-->
コマンドは、成功した時のみ終了コードのゼロを返却することが重要です。
コマンドはアーカイブにないファイル名を聞かれる<span class="emphasis"><em>ことになります</em></span>。
その場合には、非ゼロの値を返却しなければなりません。以下に例を示します。
</p><pre class="programlisting">
restore_command = 'cp /mnt/server/archivedir/%f "%p"'
restore_command = 'copy "C:\\server\\archivedir\\%f" "%p"'  # Windows
</pre><p>
<!--
        An exception is that if the command was terminated by a signal (other
        than <systemitem>SIGTERM</systemitem>, which is used as part of a
        database server shutdown) or an error by the shell (such as command
        not found), then recovery will abort and the server will not start up.
-->
例外は、データベースサーバのシャットダウンの一部として、<span class="systemitem">SIGTERM</span>以外のシグナルでコマンドが終了させられたり、シェルによってエラーが発生した（コマンドが見つからない場合など）場合で、その場合はリカバリは中断され、サーバはスタートアップしなくなります。
       </p><p>
<!--
        This parameter can only be set in the <filename>postgresql.conf</filename>
        file or on the server command line.
-->
このパラメータは <code class="filename">postgresql.conf</code>ファイル、または、サーバのコマンドラインでのみで設定可能です。
       </p></dd><dt id="GUC-ARCHIVE-CLEANUP-COMMAND"><span class="term"><code class="varname">archive_cleanup_command</code> (<code class="type">string</code>)
      <a id="id-1.6.7.9.7.8.2.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.7.8.2.1.4" class="indexterm"></a>
      </span> <a href="#GUC-ARCHIVE-CLEANUP-COMMAND" class="id_link">#</a></dt><dd><p>
<!--
        This optional parameter specifies a shell command that will be executed
        at every restartpoint.  The purpose of
        <varname>archive_cleanup_command</varname> is to provide a mechanism for
        cleaning up old archived WAL files that are no longer needed by the
        standby server.
        Any <literal>%r</literal> is replaced by the name of the file containing the
        last valid restart point.
        That is the earliest file that must be <emphasis>kept</emphasis> to allow a
        restore to be restartable, and so all files earlier than <literal>%r</literal>
        may be safely removed.
        This information can be used to truncate the archive to just the
        minimum required to support restart from the current restore.
        The <xref linkend="pgarchivecleanup"/> module
        is often used in <varname>archive_cleanup_command</varname> for
        single-standby configurations, for example:
<programlisting>archive_cleanup_command = 'pg_archivecleanup /mnt/server/archivedir %r'</programlisting>
        Note however that if multiple standby servers are restoring from the
        same archive directory, you will need to ensure that you do not delete
        WAL files until they are no longer needed by any of the servers.
        <varname>archive_cleanup_command</varname> would typically be used in a
        warm-standby configuration (see <xref linkend="warm-standby"/>).
        Write <literal>%%</literal> to embed an actual <literal>%</literal> character in the
        command.
-->
オプションのパラメータは、すべてのリスタートポイントで実行されるシェルコマンドを指定します。
<code class="varname">archive_cleanup_command</code>の目的は、スタンバイサーバにとって必要とされない古いアーカイブWALファイルをクリーンアップする仕組みを提供することです。
<code class="literal">%r</code>は最後の有効なリスタートポイントを含むファイル名に置換されます。
これはリストアが再開可能であるために<span class="emphasis"><em>保持</em></span>しなければならない最古のファイルで、<code class="literal">%r</code>よりも前のすべてのファイルは安全に削除できます。
これは現在のリストアからの再開をサポートするのに最小限必要なアーカイブを残して切り詰めるのに必要な情報として利用できます。
単一のスタンバイ構成用の<code class="varname">archive_cleanup_command</code>で、たとえば</p><pre class="programlisting">archive_cleanup_command = 'pg_archivecleanup /mnt/server/archivedir %r'</pre><p>のようにして、しばしば<a class="xref" href="pgarchivecleanup.html" title="pg_archivecleanup"><span class="refentrytitle"><span class="application">pg_archivecleanup</span></span></a>モジュールが使われます。
だたし、複数のスタンバイサーバが同じアーカイブディレクトリからリストアしている場合は、どのサーバにおいてももはや必要がなくなるまでWALファイルが削除されることのないようにする必要があることに留意してください。
<code class="varname">archive_cleanup_command</code>は通常ウォームスタンバイ構成で使用されます。
（<a class="xref" href="warm-standby.html" title="27.2. ログシッピングスタンバイサーバ">27.2</a>参照。）
<code class="literal">%</code>文字自体を埋め込むには<code class="literal">%%</code>と書いてください。
       </p><p>
<!--
        If the command returns a nonzero exit status then a warning log
        message will be written.  An exception is that if the command was
        terminated by a signal or an error by the shell (such as command not
        found), a fatal error will be raised.
-->
コマンドが非ゼロの終了ステータスを返した場合、警告ログメッセージが出力されます。
例外は、コマンドがシグナルで終了されたとき、あるいはシェルがエラーを起こしたとき（コマンドが見つからないなど）で、その場合致命的エラーが生じます。
       </p><p>
<!--
        This parameter can only be set in the <filename>postgresql.conf</filename>
        file or on the server command line.
-->
このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
       </p></dd><dt id="GUC-RECOVERY-END-COMMAND"><span class="term"><code class="varname">recovery_end_command</code> (<code class="type">string</code>)
      <a id="id-1.6.7.9.7.8.3.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.7.8.3.1.4" class="indexterm"></a>
      </span> <a href="#GUC-RECOVERY-END-COMMAND" class="id_link">#</a></dt><dd><p>
<!--
        This parameter specifies a shell command that will be executed once only
        at the end of recovery. This parameter is optional. The purpose of the
        <varname>recovery_end_command</varname> is to provide a mechanism for cleanup
        following replication or recovery.
        Any <literal>%r</literal> is replaced by the name of the file containing the
        last valid restart point, like in <xref linkend="guc-archive-cleanup-command"/>.
-->
このパラメータは、リカバリの終了時に一度だけ起動されるシェルコマンドを指定します。
このパラメータはオプションです。
<code class="varname">recovery_end_command</code>の目的はレプリケーションあるいはリカバリの後のクリーンアップのための機構を提供することにあります。
<code class="literal">%r</code>は、<a class="xref" href="runtime-config-wal.html#GUC-ARCHIVE-CLEANUP-COMMAND">archive_cleanup_command</a>と同じように、有効な最後のリスタートポイントを含むWALファイル名に置換されます。
       </p><p>
<!--
        If the command returns a nonzero exit status then a warning log
        message will be written and the database will proceed to start up
        anyway.  An exception is that if the command was terminated by a
        signal or an error by the shell (such as command not found), the
        database will not proceed with startup.
-->
コマンドが非ゼロの終了ステータスを返した場合、警告ログメッセージが出力されますが、データベースはスタートアップ処理を続けます。
例外は、コマンドがシグナルによって終了させられたか、シェルによってエラーが発生した（そのようなコマンドは見つからない）場合で、その場合はデータベースはスタートアップ処理を継続させません。
       </p><p>
<!--
        This parameter can only be set in the <filename>postgresql.conf</filename>
        file or on the server command line.
-->
このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
       </p></dd></dl></div></div><div class="sect2" id="RUNTIME-CONFIG-WAL-RECOVERY-TARGET"><div class="titlepage"><div><div><h3 class="title">20.5.6. リカバリターゲット <a href="#RUNTIME-CONFIG-WAL-RECOVERY-TARGET" class="id_link">#</a></h3></div></div></div><!--
    <title>Recovery Target</title>
--><p>
<!--
      By default, recovery will recover to the end of the WAL log. The
      following parameters can be used to specify an earlier stopping point.
      At most one of <varname>recovery_target</varname>,
      <varname>recovery_target_lsn</varname>, <varname>recovery_target_name</varname>,
      <varname>recovery_target_time</varname>, or <varname>recovery_target_xid</varname>
      can be used; if more than one of these is specified in the configuration
      file, an error will be raised.
      These parameters can only be set at server start.
-->
デフォルトではWALログの最後までリカバリを行います。
次のパラメータがそれより前の時点でリカバリを停止するために利用できます。
次の<code class="varname">recovery_target</code>、<code class="varname">recovery_target_lsn</code>、<code class="varname">recovery_target_name</code>、<code class="varname">recovery_target_time</code>、<code class="varname">recovery_target_xid</code>のどれか一つが使えます。
設定ファイルの中で２つ以上指定するとエラーとなります。
これらのパラメータはサーバ起動時のみ設定可能です。
     </p><div class="variablelist"><dl class="variablelist"><dt id="GUC-RECOVERY-TARGET"><span class="term"><code class="varname">recovery_target</code><code class="literal"> = 'immediate'</code>
      <a id="id-1.6.7.9.8.3.1.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.8.3.1.1.4" class="indexterm"></a>
      </span> <a href="#GUC-RECOVERY-TARGET" class="id_link">#</a></dt><dd><p>
<!--
        This parameter specifies that recovery should end as soon as a
        consistent state is reached, i.e., as early as possible. When restoring
        from an online backup, this means the point where taking the backup
        ended.
-->
このパラメータは、リカバリが一貫した状態になり次第、すなわちできるだけ早く終了することを指定します。
オンラインバックアップからリストアした場合、これはバックアップが終了した時点を意味します。
       </p><p>
<!--
        Technically, this is a string parameter, but <literal>'immediate'</literal>
        is currently the only allowed value.
-->
技術的にはこれは文字列型のパラメータですが、現時点では<code class="literal">'immediate'</code>だけが許容されている値です。
       </p></dd><dt id="GUC-RECOVERY-TARGET-NAME"><span class="term"><code class="varname">recovery_target_name</code> (<code class="type">string</code>)
      <a id="id-1.6.7.9.8.3.2.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.8.3.2.1.4" class="indexterm"></a>
      </span> <a href="#GUC-RECOVERY-TARGET-NAME" class="id_link">#</a></dt><dd><p>
<!--
        This parameter specifies the named restore point (created with
        <function>pg_create_restore_point()</function>) to which recovery will proceed.
-->
このパラメータは、指定した（<code class="function">pg_create_restore_point()</code>により作成された）名前付きリストアポイントまでリカバリを進行させます。
       </p></dd><dt id="GUC-RECOVERY-TARGET-TIME"><span class="term"><code class="varname">recovery_target_time</code> (<code class="type">timestamp</code>)
      <a id="id-1.6.7.9.8.3.3.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.8.3.3.1.4" class="indexterm"></a>
      </span> <a href="#GUC-RECOVERY-TARGET-TIME" class="id_link">#</a></dt><dd><p>
<!--
        This parameter specifies the time stamp up to which recovery
        will proceed.
        The precise stopping point is also influenced by
        <xref linkend="guc-recovery-target-inclusive"/>.
-->
このパラメータは、指定したタイムスタンプまでリカバリを進行させます。
正確な停止点は<a class="xref" href="runtime-config-wal.html#GUC-RECOVERY-TARGET-INCLUSIVE">recovery_target_inclusive</a>にも影響されます。
       </p><p>
<!--
        The value of this parameter is a time stamp in the same format
        accepted by the <type>timestamp with time zone</type> data type,
        except that you cannot use a time zone abbreviation (unless the
        <xref linkend="guc-timezone-abbreviations"/> variable has been set
        earlier in the configuration file).  Preferred style is to use a
        numeric offset from UTC, or you can write a full time zone name,
        e.g., <literal>Europe/Helsinki</literal> not <literal>EEST</literal>.
-->
（<a class="xref" href="runtime-config-client.html#GUC-TIMEZONE-ABBREVIATIONS">timezone_abbreviations</a>変数が設定ファイルで先に設定されていない限り）時間帯略語を使えないことを除けば、このパラメータの値は<code class="type">timestamp with time zone</code>データ型が受け付けるのと同じ形式のタイムスタンプです。
おすすめの形式はUTCからのオフセットか、<code class="literal">EEST</code>ではなく<code class="literal">Europe/Helsinki</code>のような完全な時間帯名です。
       </p></dd><dt id="GUC-RECOVERY-TARGET-XID"><span class="term"><code class="varname">recovery_target_xid</code> (<code class="type">string</code>)
      <a id="id-1.6.7.9.8.3.4.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.8.3.4.1.4" class="indexterm"></a>
      </span> <a href="#GUC-RECOVERY-TARGET-XID" class="id_link">#</a></dt><dd><p>
<!--
        This parameter specifies the transaction ID up to which recovery
        will proceed. Keep in mind
        that while transaction IDs are assigned sequentially at transaction
        start, transactions can complete in a different numeric order.
        The transactions that will be recovered are those that committed
        before (and optionally including) the specified one.
        The precise stopping point is also influenced by
        <xref linkend="guc-recovery-target-inclusive"/>.
-->
このパラメータは、指定したトランザクションIDまでリカバリを進行させます。
トランザクションIDはトランザクション起動時に順番に割り当てられますが、トランザクションは数字順によらず完了することがあることに留意してください。
リカバリされるトランザクションは、指定されたものよりも前 (オプションによっては指定されたものも含まれる) にコミットされたものになります。
正確な停止点は<a class="xref" href="runtime-config-wal.html#GUC-RECOVERY-TARGET-INCLUSIVE">recovery_target_inclusive</a>にも影響されます。
       </p></dd><dt id="GUC-RECOVERY-TARGET-LSN"><span class="term"><code class="varname">recovery_target_lsn</code> (<code class="type">pg_lsn</code>)
      <a id="id-1.6.7.9.8.3.5.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.8.3.5.1.4" class="indexterm"></a>
      </span> <a href="#GUC-RECOVERY-TARGET-LSN" class="id_link">#</a></dt><dd><p>
<!--
        This parameter specifies the LSN of the write-ahead log location up
        to which recovery will proceed. The precise stopping point is also
        influenced by <xref linkend="guc-recovery-target-inclusive"/>. This
        parameter is parsed using the system data type
        <link linkend="datatype-pg-lsn"><type>pg_lsn</type></link>.
-->
このパラメータは、指定した先行書き込みログ(WAL)の場所のLSNまでリカバリを進行させます。
正確な停止点は、<a class="xref" href="runtime-config-wal.html#GUC-RECOVERY-TARGET-INCLUSIVE">recovery_target_inclusive</a>の影響も受けます。
このパラメータは、 システムデータ型<a class="link" href="datatype-pg-lsn.html" title="8.20. pg_lsn型"><code class="type">pg_lsn</code></a>を使用して解析されます。
       </p></dd></dl></div><p>
<!--
       The following options further specify the recovery target, and affect
       what happens when the target is reached:
-->
以下のオプションはリカバリ対象をより詳細に指定し、リカバリが対象に達した時の動作に影響を与えます。
     </p><div class="variablelist"><dl class="variablelist"><dt id="GUC-RECOVERY-TARGET-INCLUSIVE"><span class="term"><code class="varname">recovery_target_inclusive</code> (<code class="type">boolean</code>)
      <a id="id-1.6.7.9.8.5.1.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.8.5.1.1.4" class="indexterm"></a>
      </span> <a href="#GUC-RECOVERY-TARGET-INCLUSIVE" class="id_link">#</a></dt><dd><p>
<!--
        Specifies whether to stop just after the specified recovery target
        (<literal>on</literal>), or just before the recovery target
        (<literal>off</literal>).
        Applies when <xref linkend="guc-recovery-target-lsn"/>,
        <xref linkend="guc-recovery-target-time"/>, or
        <xref linkend="guc-recovery-target-xid"/> is specified.
        This setting controls whether transactions
        having exactly the target WAL location (LSN), commit time, or transaction ID, respectively, will
        be included in the recovery.  Default is <literal>on</literal>.
-->
指定したリカバリ対象のちょうど後に停止するか(<code class="literal">on</code>)、ちょうどその前に停止するか(<code class="literal">off</code>)を指定します。
<a class="xref" href="runtime-config-wal.html#GUC-RECOVERY-TARGET-LSN">recovery_target_lsn</a>、<a class="xref" href="runtime-config-wal.html#GUC-RECOVERY-TARGET-TIME">recovery_target_time</a>、又は<a class="xref" href="runtime-config-wal.html#GUC-RECOVERY-TARGET-XID">recovery_target_xid</a>が指定されている場合は適用されます。
この設定は、指定した対象のWALの場所(LSN)、コミット時刻、あるいはトランザクションIDが、それぞれ正確に一致するトランザクションをリカバリに含めるかどうかを制御します。
デフォルトは<code class="literal">on</code>です。
       </p></dd><dt id="GUC-RECOVERY-TARGET-TIMELINE"><span class="term"><code class="varname">recovery_target_timeline</code> (<code class="type">string</code>)
      <a id="id-1.6.7.9.8.5.2.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.8.5.2.1.4" class="indexterm"></a>
      </span> <a href="#GUC-RECOVERY-TARGET-TIMELINE" class="id_link">#</a></dt><dd><p>
<!--
        Specifies recovering into a particular timeline.  The value can be a
        numeric timeline ID or a special value.  The value
        <literal>current</literal> recovers along the same timeline that was
        current when the base backup was taken.  The
        value <literal>latest</literal> recovers
        to the latest timeline found in the archive, which is useful in
        a standby server.  <literal>latest</literal> is the default.
-->
リカバリが作成する個別のタイムラインを指定します。
値は数値のタイムラインIDか、特殊な値です。
<code class="literal">current</code>では、ベースバックアップが取得されたときにカレントだったタイムラインに沿ってリカバリします。
<code class="literal">latest</code>では、アーカイブ時に見つけた最新のタイムラインにリカバリします。これはスタンバイサーバで有用です。
デフォルトは<code class="literal">latest</code>です。
       </p><p>
<!--
        To specify a timeline ID in hexadecimal (for example, if extracted
        from a WAL file name or history file), prefix it with a
        <literal>0x</literal>.  For instance, if the WAL file name is
        <filename>00000011000000A10000004F</filename>, then the timeline ID is
        <literal>0x11</literal> (or 17 decimal).
-->
タイムラインIDを16進数で指定するには(たとえば、WALファイル名前または歴史ファイルから抽出した場合)、<code class="literal">0x</code>を前に置きます。
例として、WALファイル名前が<code class="filename">00000011000000A10000004F</code>であれば、タイムラインIDは<code class="literal">0x11</code>(または10進数で17)になります。
       </p><p>
<!--
        You usually only need to set this parameter
        in complex re-recovery situations, where you need to return to
        a state that itself was reached after a point-in-time recovery.
        See <xref linkend="backup-timelines"/> for discussion.
-->
通常このパラメータの設定が必要となるのは、ポイントインタイムリカバリの実施後に到達した状態に戻す場合など、複雑なリカバリの状況のみです。
この論考については<a class="xref" href="continuous-archiving.html#BACKUP-TIMELINES" title="26.3.5. タイムライン">26.3.5</a>を参照してください。
       </p></dd><dt id="GUC-RECOVERY-TARGET-ACTION"><span class="term"><code class="varname">recovery_target_action</code> (<code class="type">enum</code>)
      <a id="id-1.6.7.9.8.5.3.1.3" class="indexterm"></a>
      <a id="id-1.6.7.9.8.5.3.1.4" class="indexterm"></a>
      </span> <a href="#GUC-RECOVERY-TARGET-ACTION" class="id_link">#</a></dt><dd><p>
<!--
        Specifies what action the server should take once the recovery target is
        reached. The default is <literal>pause</literal>, which means recovery will
        be paused. <literal>promote</literal> means the recovery process will finish
        and the server will start to accept connections.
        Finally <literal>shutdown</literal> will stop the server after reaching the
        recovery target.
-->
リカバリ対象に到達した場合に、サーバがする動作を指定します。
デフォルトは<code class="literal">pause</code>で、リカバリを休止することを意味します。
<code class="literal">promote</code>は、リカバリの過程が終われば、サーバは接続の受け付けを始めることを意味します。
最後に、<code class="literal">shutdown</code>は、リカバリ対象に到達した後にサーバを停止します。
       </p><p>
<!--
        The intended use of the <literal>pause</literal> setting is to allow queries
        to be executed against the database to check if this recovery target
        is the most desirable point for recovery.
        The paused state can be resumed by
        using <function>pg_wal_replay_resume()</function> (see
        <xref linkend="functions-recovery-control-table"/>), which then
        causes recovery to end. If this recovery target is not the
        desired stopping point, then shut down the server, change the
        recovery target settings to a later target and restart to
        continue recovery.
-->
<code class="literal">pause</code>の設定の意図した使い方は、このリカバリ対象がリカバリのための最も望ましいポイントかどうかチェックするために、データベースに対して問い合わせを実行できるようにすることです。
休止された状態は、<code class="function">pg_wal_replay_resume()</code>(<a class="xref" href="functions-admin.html#FUNCTIONS-RECOVERY-CONTROL-TABLE" title="表9.93 リカバリ制御関数">表 9.93</a>参照)の使用により再開することができます。
その後、それはリカバリを終了させます。
このリカバリ対象が希望の止まるポイントでない場合、サーバをシャットダウンし、リカバリ対象の設定をより後の対象に変更し、リカバリを継続するために再起動してください。
       </p><p>
<!--
        The <literal>shutdown</literal> setting is useful to have the instance ready
        at the exact replay point desired.  The instance will still be able to
        replay more WAL records (and in fact will have to replay WAL records
        since the last checkpoint next time it is started).
-->
<code class="literal">shutdown</code>の設定はインスタンスを正確に望ましい再生ポイントで準備するのに有用です。
インスタンスはさらに多くのWALレコードを再生できます(実際、次に起動するときには最後のチェックポイントからWALレコードを再生しなければなりません)。
       </p><p>
<!--
        Note that because <filename>recovery.signal</filename> will not be
        removed when <varname>recovery_target_action</varname> is set to <literal>shutdown</literal>,
        any subsequent start will end with immediate shutdown unless the
        configuration is changed or the <filename>recovery.signal</filename>
        file is removed manually.
-->
<code class="filename">recovery.signal</code>は<code class="varname">recovery_target_action</code>が<code class="literal">shutdown</code>に設定されていると削除されないことに留意してください。
設定が変更されるか、<code class="filename">recovery.signal</code>が手動で削除されない限り、以降起動しても直ちに停止されてしまいます。
       </p><p>
<!--
        This setting has no effect if no recovery target is set.
        If <xref linkend="guc-hot-standby"/> is not enabled, a setting of
        <literal>pause</literal> will act the same as <literal>shutdown</literal>.
        If the recovery target is reached while a promotion is ongoing,
        a setting of <literal>pause</literal> will act the same as
        <literal>promote</literal>.
-->
この設定はリカバリ対象が設定されていない場合には効果がありません。
<a class="xref" href="runtime-config-replication.html#GUC-HOT-STANDBY">hot_standby</a>が有効になっていない場合、<code class="literal">pause</code>の設定は<code class="literal">shutdown</code>と同じように動作します。
昇格中にリカバリ対象に到達した場合は、<code class="literal">pause</code>は<code class="literal">promote</code>と同じように働きます。
       </p><p>
<!--
        In any case, if a recovery target is configured but the archive
        recovery ends before the target is reached, the server will shut down
        with a fatal error.
-->
どのような場合でも、リカバリ対象が設定されていて、アーカイブリカバリがそのリカバリ対象に到達する前に終了すると、サーバはフェイタルエラーで停止します。
       </p></dd></dl></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="runtime-config-resource.html" title="20.4. 資源の消費">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime-config.html" title="第20章 サーバの設定">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="runtime-config-replication.html" title="20.6. レプリケーション">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">20.4. 資源の消費 </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 16.0文書">ホーム</a></td><td width="40%" align="right" valign="top"> 20.6. レプリケーション</td></tr></table></div></body></html>