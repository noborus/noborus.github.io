<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>18.10. SSHトンネルを使った安全なTCP/IP接続</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="ssl-tcp.html" title="18.9. SSLによる安全なTCP/IP接続" /><link rel="next" href="event-log-registration.html" title="18.11. WindowsにおけるEvent Logの登録" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="4" align="center"><a accesskey="h" href="index.html">PostgreSQL 11.1文書</a></th></tr><tr><td width="10%" align="left"></td><td width="10%" align="left"></td><td width="60%" align="center"><a href="runtime.html" title="第18章 サーバの準備と運用">第18章 サーバの準備と運用</a></td><td width="20%" align="right"><div class="actions"><a class="issue" title="github" href="https://github.com/pgsql-jp/jpug-doc/issues/new?title=version 11.1 &#10;                      ssh-tunnels.html">誤訳等の報告
                    </a></div></td></tr><tr><td width="10%" align="left"><a accesskey="p" href="ssl-tcp.html" title="18.9. SSLによる安全なTCP/IP接続">前へ</a> </td><td width="10%" align="left"><a accesskey="u" href="runtime.html" title="第18章 サーバの準備と運用">上へ</a></td><td width="60%" align="center">18.10. <span class="application">SSH</span>トンネルを使った安全なTCP/IP接続</td><td width="20%" align="right"> <a accesskey="n" href="event-log-registration.html" title="18.11. WindowsにおけるEvent Logの登録">次へ</a></td></tr></table><hr /></div><div class="sect1" id="SSH-TUNNELS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">18.10. <span class="application">SSH</span>トンネルを使った安全なTCP/IP接続</h2></div></div></div><span class="original">
  &lt;title&gt;Secure TCP/IP Connections with &lt;application&gt;SSH&lt;/application&gt; Tunnels&lt;/title&gt;
</span><a id="id-1.6.5.12.2" class="indexterm"></a><p>
<span class="original">
   It is possible to use &lt;application&gt;SSH&lt;/application&gt; to encrypt the network
   connection between clients and a
   &lt;productname&gt;PostgreSQL&lt;/productname&gt; server. Done properly, this
   provides an adequately secure network connection, even for non-SSL-capable
   clients.
</span>
クライアントと<span class="productname">PostgreSQL</span>サーバ間のネットワーク接続を暗号化するために<span class="application">SSH</span>を使うことができます。
正しく行えば、SSL機能がクライアントになくても、これで十分に安全なネットワーク接続を行うことができます。
  </p><p>
<span class="original">
   First make sure that an &lt;application&gt;SSH&lt;/application&gt; server is
   running properly on the same machine as the
   &lt;productname&gt;PostgreSQL&lt;/productname&gt; server and that you can log in using
   &lt;command&gt;ssh&lt;/command&gt; as some user. Then you can establish a secure
   tunnel with a command like this from the client machine:
</span>
まず<span class="application">SSH</span>サーバが<span class="productname">PostgreSQL</span>サーバと同じマシン上で正しく起動していて、<code class="command">ssh</code>を使ってログインできるユーザが存在することを確かめてください。
そうすると、次に示すコマンドでクライアントマシンから安全なトンネルを確立することができます。
</p><pre class="programlisting">
ssh -L 63333:localhost:5432 joe@foo.com
</pre><p>
<span class="original">
   The first number in the &lt;option&gt;-L&lt;/option&gt; argument, 63333, is the
   port number of your end of the tunnel; it can be any unused port.
   (IANA reserves ports 49152 through 65535 for private use.)  The
   second number, 5432, is the remote end of the tunnel: the port
   number your server is using. The name or IP address between the
   port numbers is the host with the database server you are going to
   connect to, as seen from the host you are logging in to, which
   is &lt;literal&gt;foo.com&lt;/literal&gt; in this example. In order to connect
   to the database server using this tunnel, you connect to port 63333
   on the local machine:
</span>
<code class="option">-L</code>引数の1番目の数字（63333）はトンネルのローカル側のポート番号で、未使用のポートを選択することが可能です。（IANAは49152から65535までのポートを私的使用のため予約しています。）
2番目の数字（5432）は、トンネルのリモート側のサーバが使用しているポート番号です。
2つのポート番号間の名前もしくはアドレスは、ログインしているホスト（この例では、<code class="literal">foo.com</code>）から見られる、あなたが接続しようとするデータベースサーバホストです。
このトンネルを使ってデータベースサーバに接続するためには、ローカルマシンのポート63333に接続します。
</p><pre class="programlisting">
psql -h localhost -p 63333 postgres
</pre><p>
<span class="original">
   To the database server it will then look as though you are really
   user &lt;literal&gt;joe&lt;/literal&gt; on host &lt;literal&gt;foo.com&lt;/literal&gt;
   connecting to &lt;literal&gt;localhost&lt;/literal&gt; in that context, and it
   will use whatever authentication procedure was configured for
   connections from this user and host.  Note that the server will not
   think the connection is SSL-encrypted, since in fact it is not
   encrypted between the
   &lt;application&gt;SSH&lt;/application&gt; server and the
   &lt;productname&gt;PostgreSQL&lt;/productname&gt; server.  This should not pose any
   extra security risk as long as they are on the same machine.
</span>
データベースサーバにとっては、ユーザが実際にホスト<code class="literal">foo.com</code>上のユーザ<code class="literal">joe</code>であるかのように見え、このユーザとホストによる<code class="literal">localhost</code>接続向けに設定された認証手続きが使用されます。
サーバはこの接続がSSLで暗号化されているとみなさないことに注意してください。
実際、<span class="application">SSH</span>サーバと<span class="productname">PostgreSQL</span>サーバとの間は暗号化されません。
この2つのサーバが同一マシンにある限り、セキュリティ上の危険性が増すことはありません。
  </p><p>
<span class="original">
   In order for the
   tunnel setup to succeed you must be allowed to connect via
   &lt;command&gt;ssh&lt;/command&gt; as &lt;literal&gt;joe@foo.com&lt;/literal&gt;, just
   as if you had attempted to use &lt;command&gt;ssh&lt;/command&gt; to create a
   terminal session.
</span>
トンネルの確立が成功するためには、<code class="command">ssh</code>を使用して端末セッションを作成したのと同様に、<code class="literal">joe@foo.com</code>ユーザが<code class="command">ssh</code>を通して接続することが許可されていなければいけません。
  </p><p>
<span class="original">
   You could also have set up the port forwarding as
</span>
以下に示すようにポートフォワードを設定することができます。
</p><pre class="programlisting">
ssh -L 63333:foo.com:5432 joe@foo.com
</pre><p>
<span class="original">
   but then the database server will see the connection as coming in
   on its &lt;literal&gt;foo.com&lt;/literal&gt; interface, which is not opened by
   the default setting &lt;literal&gt;listen_addresses =
   'localhost'&lt;/literal&gt;.  This is usually not what you want.
</span>
しかしそうすると、データベースサーバはその<code class="literal">foo.com</code>インタフェースから接続が来たように判断し、デフォルトの設定である<code class="literal">listen_addresses = 'localhost'</code>では開かれません。
通常これは好ましいことではありません。
  </p><p>
<span class="original">
   If you have to &lt;quote&gt;hop&lt;/quote&gt; to the database server via some
   login host, one possible setup could look like this:
</span>
どこかのログインホスト経由でデータベースサーバに<span class="quote">「<span class="quote">跳躍</span>」</span>しなければならない場合、以下のようにすることが可能です。
</p><pre class="programlisting">
ssh -L 63333:db.foo.com:5432 joe@shell.foo.com
</pre><p>
<span class="original">
   Note that this way the connection
   from &lt;literal&gt;shell.foo.com&lt;/literal&gt;
   to &lt;literal&gt;db.foo.com&lt;/literal&gt; will not be encrypted by the SSH
   tunnel.
   SSH offers quite a few configuration possibilities when the network
   is restricted in various ways.  Please refer to the SSH
   documentation for details.
</span>
<code class="literal">shell.foo.com</code>から<code class="literal">db.foo.com</code>へのこのような接続はSSHトンネルで暗号化されません。
SSHはいろいろな方法でネットワークが制約されているとき、かなりの数の設定可能性を提供しています。
詳細はSSHの文書を参照してください。
  </p><div class="tip"><h3 class="title">ヒント</h3><p>
<span class="original">
    Several other applications exist that can provide secure tunnels using
    a procedure similar in concept to the one just described.
</span>
ここで説明してきたものと似た概念の手続きを使用して、安全なトンネルを提供可能なアプリケーションが他にもいくつか存在します。
   </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ssl-tcp.html">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime.html">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="event-log-registration.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">18.9. SSLによる安全なTCP/IP接続 </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> 18.11. <span class="systemitem">Windows</span>における<span class="application">Event Log</span>の登録</td></tr></table></div></body></html>