<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.113.0"><meta name=generator content="Relearn 5.16.0+tip"><meta name=description content="Noboru Saito's site"><title>Memory management :: Noboru Saito's page</title><link href=https://noborus.github.io/ov/memory/index.html rel=alternate hreflang=x-default><link href=https://noborus.github.io/ov/memory/index.html rel=alternate hreflang=en><link href=https://noborus.github.io/ja/ov/memory/index.html rel=alternate hreflang=ja><link href=/images/logo.svg?1686390904 rel=icon type=image/svg+xml><link href=/css/fontawesome-all.min.css?1686390904 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css?1686390904 rel=stylesheet></noscript><link href=/css/nucleus.css?1686390904 rel=stylesheet><link href=/css/auto-complete.css?1686390904 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/auto-complete.css?1686390904 rel=stylesheet></noscript><link href=/css/perfect-scrollbar.min.css?1686390904 rel=stylesheet><link href=/css/fonts.css?1686390904 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css?1686390904 rel=stylesheet></noscript><link href=/css/theme.css?1686390904 rel=stylesheet><link href=/css/theme-my-custom-variant.css?1686390904 rel=stylesheet id=variant-style><link href=/css/variant.css?1686390904 rel=stylesheet><link href=/css/print.css?1686390904 rel=stylesheet media=print><link href=/css/ie.css?1686390904 rel=stylesheet><script src=/js/url.js?1686390904></script>
<script src=/js/variant.js?1686390904></script>
<script>window.index_json_url="/index.json";var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="Copy to clipboard",window.T_Copied_to_clipboard="Copied to clipboard!",window.T_Copy_link_to_clipboard="Copy link to clipboard",window.T_Link_copied_to_clipboard="Copied link to clipboard!",window.T_No_results_found="No results found for \"{0}\"",window.T_N_results_found="{1} results found for \"{0}\"",baseUriFull="https://noborus.github.io/",window.variants&&variants.init(["my-custom-variant"])</script></head><body class="mobile-support html" data-url=/ov/memory/index.html><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable><div><div class=navigation><a class="nav nav-next topbar-link" href=/about/index.html title="About (&#129106;)"><i class="fas fa-chevron-right fa-fw"></i></a></div><div class=navigation><a class="nav nav-prev topbar-link" href=/ov/section/index.html title="How to use section (&#129104;)"><i class="fas fa-chevron-left fa-fw"></i></a></div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle class=topbar-link title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a></span>
<span id=toc-menu title='Table of Contents (CTRL+ALT+t)'><i class="fas fa-list-alt fa-fw"></i></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>Top</span></a><meta itemprop=position content="1">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/ov/index.html><span itemprop=name>ov - Feature-rich pager</span></a><meta itemprop=position content="2">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Memory management</span><meta itemprop=position content="3"></li></ol></div><div class="default-animation progress"><div class=toc-wrapper><nav id=TableOfContents><ul><li><a href=#memory-management>Memory management</a><ul><li><a href=#regular-file>Regular file</a></li><li><a href=#non-regular-file>Non-regular file</a></li><li><a href=#memory-limit>memory limit</a></li></ul></li></ul></nav></div></div></div></nav><main id=body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=memory-management>Memory management</h1><div class=c-time>Posted on:
<time datetime=2023-06-02T00:00:00Z>June 2, 2023</time></div><h2 id=memory-management>Memory management</h2><h3 id=regular-file>Regular file</h3><p><code>ov</code> is managed by dividing it into Chunks for each ChunkSize (10,000) lines.
For example, a file with 73210 lines is divided into 7 chunks. Chunk</p><p><a href=#image-cfc404fe480b5b864498debf4d11d8fc class=lightbox-link><img src=../ov-file-mem.png alt="file memory management" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-cfc404fe480b5b864498debf4d11d8fc><img src=../ov-file-mem.png alt="file memory management" class=lightbox-image loading=lazy></a></p><p>The first Chunk (Chunk0) is always loaded into memory.
Chunk3 and Chunk4 must also be loaded into memory, as they may span two Chunks when displayed.
Chunk1 and Chunk2 have been used before and are loaded into memory, but can be freed if they exceed their limits.
For regular files, it is possible to save memory and speed by loading and freeing memory while seeking.</p><h3 id=non-regular-file>Non-regular file</h3><p>Files that cannot be <code>seek</code> (pipes and compressed files) are also managed in chunk units, but once released, they cannot be loaded into memory, so load them into memory as much as possible.
If there is a memory limit, read up to the memory limit and then pause reading.</p><p><a href=#image-1307c297bae22cf7e89d26213feb3de8 class=lightbox-link><img src=../ov-mem-mem.png alt="non-file memory management" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-1307c297bae22cf7e89d26213feb3de8><img src=../ov-mem-mem.png alt="non-file memory management" class=lightbox-image loading=lazy></a></p><p>Then, for example, when you go to line 41230, Chunk1, Chunk2, and Chunk3 are freed and read ahead from where they are now.</p><h3 id=memory-limit>memory limit</h3><p>The default memory limit for regular files is 100 (1 million lines).
I don&rsquo;t think you need to change much, but you can specify it with <code>--memory-limit-file</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>ov --memory-limit-file 10 large.log
</span></span></code></pre></div><p>The default memory limit for non-regular files is -1 ( unlimited).</p><p>It is recommended to limit this according to memory.
It is recommended to set <code>MemoryLimit: 10000(or 1000)</code> in <code>ov.yaml</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>MemoryLimit</span>: <span style=color:#ae81ff>10000</span>
</span></span></code></pre></div><p>You can also use options like <code>--memory-limit 1000</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>command | ov --memory-limit 1000
</span></span></code></pre></div><p>Even with the memory limit option specified, large files can still use a lot of memory.
Setting <code>GOMEMLIMIT</code> to run GC frequently will also suppress temporary memory increase.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>export GOMEMLIMIT=400MiB
</span></span><span style=display:flex><span>ov --memory-limit-file 10 large.log
</span></span></code></pre></div><footer class=footline></footer></article></div></main></div><aside id=sidebar class=default-animation><div id=header-wrapper class=default-animation><div id=header class=default-animation><a id=logo href=./index.html><style>#sidebar a#logo{display:flex;align-items:center;font-size:1.3rem;font-weight:600;color:#777}#logo object{margin-right:.1rem}</style><img width=50 height=50 src=/images/logo.svg></img>Noboru Saitoâ€™s site</a></div><div class="searchbox default-animation"><i class="fas fa-search" title="Search (CTRL+ALT+f)"></i>
<label class=a11y-only for=search-by>Search</label>
<input data-search-input id=search-by name=search-by class=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script>var contentLangs=["en","ja"]</script><script src=/js/auto-complete.js?1686390904 defer></script>
<script src=/js/lunr/lunr.min.js?1686390904 defer></script>
<script src=/js/lunr/lunr.stemmer.support.min.js?1686390904 defer></script>
<script src=/js/lunr/lunr.multi.min.js?1686390904 defer></script>
<script src=/js/lunr/lunr.en.min.js?1686390904 defer></script>
<script src=/js/lunr/tinyseg.js?1686390904 defer></script>
<script src=/js/lunr/lunr.ja.min.js?1686390904 defer></script>
<script src=/js/search.js?1686390904 defer></script></div><div id=homelinks class=default-animation><ul><li><a class=padding href=/index.html><i class="fas fa-home"></i> Home</a></li></ul></div><div id=content-wrapper class=highlightable><ul class="topics enlarge morespace"><li data-nav-id=/blog/index.html><a class=padding href=/blog/index.html>Blog</a><ul id=subsections-e5771ef0a5755d5af1982ccf165846c6 class=morespace><li data-nav-id=/blog/guesswidth/index.html><a class=padding href=/blog/guesswidth/index.html>Guess the width of the width-specified format</a></li><li data-nav-id=/blog/jqsql/index.html><a class=padding href=/blog/jqsql/index.html>Another way to aggregate json(jq + SQL)</a></li></ul></li><li data-nav-id=/trdsql/index.html><a class=padding href=/trdsql/index.html>trdsql</a><ul id=subsections-a127209ea9757fb2737b7f62423c1089 class=morespace><li data-nav-id=/trdsql/01_install/index.html><a class=padding href=/trdsql/01_install/index.html>trdsql install</a></li></ul></li><li data-nav-id=/ov/index.html class=parent><a class=padding href=/ov/index.html>ov</a><ul id=subsections-46f423e8c5dcd692046cb56c3632ac71 class=morespace><li data-nav-id=/ov/psql/index.html><a class=padding href=/ov/psql/index.html>psql</a></li><li data-nav-id=/ov/git/index.html><a class=padding href=/ov/git/index.html>git</a></li><li data-nav-id=/ov/mysql/index.html><a class=padding href=/ov/mysql/index.html>mysql</a></li><li data-nav-id=/ov/pgcli/index.html><a class=padding href=/ov/pgcli/index.html>pgcli</a></li><li data-nav-id=/ov/mycli/index.html><a class=padding href=/ov/mycli/index.html>mycli</a></li><li data-nav-id=/ov/ps/index.html><a class=padding href=/ov/ps/index.html>ps</a></li><li data-nav-id=/ov/man/index.html><a class=padding href=/ov/man/index.html>man</a></li><li data-nav-id=/ov/top/index.html><a class=padding href=/ov/top/index.html>top</a></li><li data-nav-id=/ov/procs/index.html><a class=padding href=/ov/procs/index.html>procs</a></li><li data-nav-id=/ov/bat/index.html><a class=padding href=/ov/bat/index.html>bat</a></li><li data-nav-id=/ov/watch/index.html><a class=padding href=/ov/watch/index.html>Watch files with ov</a></li><li data-nav-id=/ov/csv/index.html><a class=padding href=/ov/csv/index.html>view csv</a></li><li data-nav-id=/ov/markdown/index.html><a class=padding href=/ov/markdown/index.html>View markdown</a></li><li data-nav-id=/ov/multifile/index.html><a class=padding href=/ov/multifile/index.html>multiple files</a></li><li data-nav-id=/ov/multicolor/index.html><a class=padding href=/ov/multicolor/index.html>Multicolor highlights multiple words</a></li><li data-nav-id=/ov/exec/index.html><a class=padding href=/ov/exec/index.html>execute command</a></li><li data-nav-id=/ov/tail/index.html><a class=padding href=/ov/tail/index.html>How to use follow mode</a></li><li data-nav-id=/ov/section/index.html><a class=padding href=/ov/section/index.html>How to use section</a></li><li data-nav-id=/ov/memory/index.html class=active><a class=padding href=/ov/memory/index.html>Memory management</a></li></ul></li><li data-nav-id=/about/index.html><a class=padding href=/about/index.html>About</a></li></ul><div id=shortcuts><div class="nav-title padding"></div><ul class=space><li><a class=padding href=/categories/index.html><i class='fas fa-list'></i> Categories</a></li><li><a class=padding href=/tags/index.html><i class='fas fa-tags'></i> Tags</a></li></ul></div><div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showLangSwitch showFooter"></div><hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showLangSwitch showFooter"><div id=prefooter class="footerLangSwitch footerVariantSwitch footerVisitedLinks showLangSwitch"><ul><li id=select-language-container class="footerLangSwitch showLangSwitch"><div class="padding select-container"><i class="fas fa-language fa-fw"></i>
<span>&nbsp;</span><div class=select-style><label class=a11y-only for=select-language>Language</label>
<select id=select-language onchange="location=baseUri+this.value"><option lang=en id=en value=/ov/memory/index.html selected>English</option><option lang=ja id=ja value=/ja/ov/memory/index.html>Japanese</option></select></div><div class=select-clear></div></div></li><li id=select-variant-container class=footerVariantSwitch><div class="padding select-container"><i class="fas fa-paint-brush fa-fw"></i>
<span>&nbsp;</span><div class=select-style><label class=a11y-only for=select-variant>Theme</label>
<select id=select-variant onchange=window.variants&&variants.changeVariant(this.value)><option id=my-custom-variant value=my-custom-variant selected>My Custom Variant</option></select></div><div class=select-clear></div></div><script>window.variants&&variants.markSelectedVariant()</script></li><li class=footerVisitedLinks><button class=padding onclick=clearHistory()><i class="fas fa-history fa-fw"></i><span>&nbsp;</span>Clear History</button></li></ul></div><div id=footer class="footerFooter showFooter"><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn title=love><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div></div></aside><script src=/js/clipboard.min.js?1686390904 defer></script>
<script src=/js/perfect-scrollbar.min.js?1686390904 defer></script>
<script src=/js/theme.js?1686390904 defer></script></body></html>