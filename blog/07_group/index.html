<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>trdsql GROUP集計 &ndash; Noboru Saito&#39;s page</title><meta name=description property=og:description content="全体の合計を計算することもありますが、グループ毎の合計をまとめて出力したい場合もあります。 そこで使うのがGROUP BYです。 前回の例をもう一度使用します。 name,price apple,100 orange,50 melon,500 apple,90 apple,90 orange,40 orange,40 ここでappleやorange毎の合計を出したい場合は、以下のように検索条件で絞れば計算できますが、nameの|Noboru Saito's site"><meta name=apple-mobile-web-app-title content="Noboru Saito's page"><link rel=icon href=/favicon-64.png><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=mask-icon size=any href=/pinned-icon.svg><meta name=twitter:card content=summary><meta name=twitter:site content=@><meta name=twitter:creator content=@><meta name=twitter:title content="trdsql GROUP集計 | Noboru Saito's page"><meta name=twitter:description content="全体の合計を計算することもありますが、グループ毎の合計をまとめて出力したい場合もあります。 そこで使うのがGROUP BYです。 前回の例をもう一度使用します。 name,price apple,100 orange,50 melon,500 apple,90 apple,90 orange,40 orange,40 ここでappleやorange毎の合計を出したい場合は、以下のように検索条件で絞れば計算できますが、nameの|Noboru Saito's site"><meta name=twitter:image content=https://noborus.github.io/twitter-card.png><link rel=stylesheet href=/assets/syntax.css><link rel=stylesheet href=/assets/primer-build.css><link rel=stylesheet href=/assets/style.css></head><body class=bg-gray><div id=holy class="container-lg bg-white h-100"><div id=header class="px-1 bg-white"><nav class="UnderlineNav UnderlineNav--right px-2"><a class="UnderlineNav-actions muted-link h2" href=https://noborus.github.io/>Noboru Saito&#39;s page</a><div class=UnderlineNav-body><a class=UnderlineNav-item href=/><span>Top</span></a>
<a class=UnderlineNav-item href=/blog/><span>Blog</span></a>
<a class=UnderlineNav-item href=/about/><span>About</span></a></div></nav></div><div role=main id=main class="holy-main markdown-body px-4 bg-white"><div class=Subhead><div class=Subhead-heading><div class="h1 mt-3 mb-1">trdsql GROUP集計</div></div><div class=Subhead-description><a href=/categories/trdsql class=muted-link><span class="Label Label--gray-darker">trdsql</span></a>
<a href=/categories/advent-calendar-2019 class=muted-link><span class="Label Label--gray-darker">advent calendar 2019</span></a>
<a href=/tags/trdsql class=muted-link><span class="Label Label--gray">trdsql</span></a>
<a href=/tags/group-by class=muted-link><span class="Label Label--gray">group by</span></a><div class=float-md-right><span title="Lastmod: 2019-12-07. Published at: 2019-12-07.">Published: 2019-12-07</span></div></div></div><article><section class="pb-6 mb-3 border-bottom"><p>全体の合計を計算することもありますが、グループ毎の合計をまとめて出力したい場合もあります。
そこで使うのがGROUP BYです。</p><p>前回の例をもう一度使用します。</p><div class=highlight><pre class=chroma><code class=language-sample.csv data-lang=sample.csv>name,price
apple,100
orange,50
melon,500
apple,90
apple,90
orange,40
orange,40</code></pre></div><p>ここでappleやorange毎の合計を出したい場合は、以下のように検索条件で絞れば計算できますが、nameの種類の数だけ実行するとなると大変な作業になります。</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>trdsql -ih <span class=s2>&#34;SELECT name,SUM(CAST(price AS INT)) as sum FROM sample.csv WHERE name=&#39;apple&#39;&#34;</span>
apple,280</code></pre></div><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>trdsql -ih <span class=s2>&#34;SELECT name,SUM(CAST(price AS INT)) as sum FROM sample.csv WHERE name=&#39;orange&#39;&#34;</span>
orange,130</code></pre></div><p>そこでGROUP BY を使ってnameをグループとして扱うことで、それぞれの集計結果を求めることができます。</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>trdsql -ih <span class=s2>&#34;SELECT name,SUM(CAST(price AS INT)) as sum FROM sample.csv GROUP BY name&#34;</span>
apple,280
melon,500
orange,130</code></pre></div><p>前回の集計を少し変えてname毎に出すように出力してみます。
出力は-oat(Ascii Table)を使うと見やすく表示できます。</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>trdsql -ih -oat <span class=s2>&#34;SELECT name, COUNT(name) as count, MIN(CAST(price AS INT)) AS min,MAX(CAST(price AS INT)) as max,SUM(CAST(price AS INT)) as sum,AVG(CAST(price AS INT)) as avg FROM sample.csv GROUP BY name&#34;</span>
+--------+-------+-----+-----+-----+--------------------+
<span class=p>|</span>  name  <span class=p>|</span> count <span class=p>|</span> min <span class=p>|</span> max <span class=p>|</span> sum <span class=p>|</span>        avg         <span class=p>|</span>
+--------+-------+-----+-----+-----+--------------------+
<span class=p>|</span> apple  <span class=p>|</span>     <span class=m>3</span> <span class=p>|</span>  <span class=m>90</span> <span class=p>|</span> <span class=m>100</span> <span class=p>|</span> <span class=m>280</span> <span class=p>|</span>  <span class=m>93</span>.33333333333333 <span class=p>|</span>
<span class=p>|</span> melon  <span class=p>|</span>     <span class=m>1</span> <span class=p>|</span> <span class=m>500</span> <span class=p>|</span> <span class=m>500</span> <span class=p>|</span> <span class=m>500</span> <span class=p>|</span>                <span class=m>500</span> <span class=p>|</span>
<span class=p>|</span> orange <span class=p>|</span>     <span class=m>3</span> <span class=p>|</span>  <span class=m>40</span> <span class=p>|</span>  <span class=m>50</span> <span class=p>|</span> <span class=m>130</span> <span class=p>|</span> <span class=m>43</span>.333333333333336 <span class=p>|</span>
+--------+-------+-----+-----+-----+--------------------+</code></pre></div><p>GROUP集計した結果をORDER BYで並べ替えることもできます。</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>trdsql -ih -oat <span class=s2>&#34;SELECT name, COUNT(name) as count, MIN(CAST(price AS INT)) AS min,MAX(CAST(price AS INT)) as max,SUM(CAST(price AS INT)) as sum,AVG(CAST(price AS INT)) as avg FROM sample.csv GROUP BY name ORDER BY sum DESC&#34;</span>
+--------+-------+-----+-----+-----+--------------------+
<span class=p>|</span>  name  <span class=p>|</span> count <span class=p>|</span> min <span class=p>|</span> max <span class=p>|</span> sum <span class=p>|</span>        avg         <span class=p>|</span>
+--------+-------+-----+-----+-----+--------------------+
<span class=p>|</span> melon  <span class=p>|</span>     <span class=m>1</span> <span class=p>|</span> <span class=m>500</span> <span class=p>|</span> <span class=m>500</span> <span class=p>|</span> <span class=m>500</span> <span class=p>|</span>                <span class=m>500</span> <span class=p>|</span>
<span class=p>|</span> apple  <span class=p>|</span>     <span class=m>3</span> <span class=p>|</span>  <span class=m>90</span> <span class=p>|</span> <span class=m>100</span> <span class=p>|</span> <span class=m>280</span> <span class=p>|</span>  <span class=m>93</span>.33333333333333 <span class=p>|</span>
<span class=p>|</span> orange <span class=p>|</span>     <span class=m>3</span> <span class=p>|</span>  <span class=m>40</span> <span class=p>|</span>  <span class=m>50</span> <span class=p>|</span> <span class=m>130</span> <span class=p>|</span> <span class=m>43</span>.333333333333336 <span class=p>|</span>
+--------+-------+-----+-----+-----+--------------------+</code></pre></div><p>GROUP集計した結果についてWHEREで条件を指定することはできません。そこからさらに絞るにはHAVINGを使用します。</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>trdsql -ih -oat <span class=s2>&#34;SELECT name, COUNT(name) as count, MIN(CAST(price AS INT)) AS min,MAX(CAST(price AS INT)) as max,SUM(CAST(price AS INT)) as sum,AVG(CAST(price AS INT)) as avg FROM sample.csv GROUP BY name HAVING count &gt; 1 ORDER BY sum DESC&#34;</span>
+--------+-------+-----+-----+-----+--------------------+
<span class=p>|</span>  name  <span class=p>|</span> count <span class=p>|</span> min <span class=p>|</span> max <span class=p>|</span> sum <span class=p>|</span>        avg         <span class=p>|</span>
+--------+-------+-----+-----+-----+--------------------+
<span class=p>|</span> apple  <span class=p>|</span>     <span class=m>3</span> <span class=p>|</span>  <span class=m>90</span> <span class=p>|</span> <span class=m>100</span> <span class=p>|</span> <span class=m>280</span> <span class=p>|</span>  <span class=m>93</span>.33333333333333 <span class=p>|</span>
<span class=p>|</span> orange <span class=p>|</span>     <span class=m>3</span> <span class=p>|</span>  <span class=m>40</span> <span class=p>|</span>  <span class=m>50</span> <span class=p>|</span> <span class=m>130</span> <span class=p>|</span> <span class=m>43</span>.333333333333336 <span class=p>|</span>
+--------+-------+-----+-----+-----+--------------------+</code></pre></div></section><section></section></article></div><div id=side class="pr-1 bg-white"><aside class=pr-3><div id=toc class="Box Box--blue mb-3"><b>trdsql GROUP集計</b></div><div></div></aside></div><div id=footer class="pt-2 pb-3 bg-white text-center"><span class="text-small text-gray">&copy;Noboru Saito 2019 &middot;
Powered by the
<a href=https://github.com/qqhann/hugo-primer class=link-gray-dark>Hugo-Primer</a> theme for
<a href=https://gohugo.io class=link-gray-dark>Hugo</a>.</span></div></div><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/x-mathjax-config>MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script></body></html>